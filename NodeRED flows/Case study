[{"id":"d9a0dcec.e2c7a8","type":"tab","label":"Flow 1"},{"id":"81cc33f0.fc5b8","type":"tab","label":"Flow 1"},{"id":"747cc965.eef66","type":"tab","label":"Flow 3"},{"id":"ddff9eb6.b851e","type":"tab","label":"Flow 2"},{"id":"3bbfbe90.4f002a","type":"tab","label":"Flow 4"},{"id":"f9c7b0fd.908c28","type":"tab","label":"Flow 5"},{"id":"68302af2.762da4","type":"tab","label":"Flow 6"},{"id":"ec6f79c6.e20fe8","type":"tab","label":"Flow 7"},{"id":"ec56a6c9.7576e8","type":"tab","label":"Flow 8"},{"id":"13320c0d.add27c","type":"tab","label":"Late Binding"},{"id":"8ef5a75.d4d39d8","type":"tab","label":"Flow 9"},{"id":"170e9371.3130f5","type":"tab","label":"Flow 10"},{"id":"54fb866.f5f9078","type":"tab","label":"Flow 11"},{"id":"f6817665.f5e3b","type":"tab","label":"Flow 12"},{"id":"17e92000.a81af","type":"tab","label":"Flow 13"},{"id":"425623ca.056c84","type":"tab","label":"Flow 5"},{"id":"950f5d4.eeb9c2","type":"tab","label":"Flow 4"},{"id":"5fdd0233.cacd64","type":"tab","label":"Flow 1"},{"id":"270ec0a5.892f9","type":"tab","label":"Flow 13"},{"id":"eb8d0c5a.8ab9e8","type":"tab","label":"Flow 13"},{"id":"3b713604.e73c82","type":"tab","label":"Flow 2"},{"id":"fe5d36ff.78a7d","type":"tab","label":"Flow 13"},{"id":"c72edaff.6f6a68","type":"tab","label":"Flow 13"},{"id":"4a234597.1adc84","type":"tab","label":"Flow 3"},{"id":"40347b9.eedc804","type":"tab","label":"Flow 5"},{"id":"6ef54a52.91d9bc","type":"tab","label":"Flow 14"},{"id":"43367d2.b055584","type":"tab","label":"Flow 13"},{"id":"489a23e7.80926c","type":"tab","label":"Flow 13"},{"id":"4488f8a4.67143","type":"tab","label":"Flow 15"},{"id":"e8e29b8f.f685e","type":"tab","label":"Flow 16"},{"id":"a626622d.9d5f9","type":"tab","label":"Flow 17"},{"id":"34765634.339aa2","type":"subflow","name":"Subflow 1","info":"","in":[],"out":[]},{"id":"f12e2cf8.9926f8","type":"subflow","name":"location_selector","info":"","in":[{"x":103.00000381469727,"y":88.00000190734863,"wires":[{"id":"e4cf01a6.ff0a"}]}],"out":[{"x":2165.0001220703125,"y":97.00003814697266,"wires":[{"id":"23e40111.e51fde","port":0}]}]},{"id":"29cbf52c.3e9352","type":"subflow","name":"first_selector","info":"","in":[{"x":198.9999918937683,"y":159.99999070167542,"wires":[{"id":"5f8b360d.7033c"}]}],"out":[{"x":946.9999694824219,"y":153.99999237060547,"wires":[{"id":"a5348e3a.2c10d8","port":0}]}]},{"id":"c24ee3f8.7e8628","type":"subflow","name":"speed_selector","info":"","in":[{"x":233.99999237060547,"y":192.99999237060547,"wires":[{"id":"ba974e58.8a7d88"}]}],"out":[{"x":999.9999389648438,"y":174,"wires":[{"id":"8b8b2577.e04d78","port":0}]}]},{"id":"478481c2.0790f","type":"subflow","name":"delay_selector","info":"","in":[{"x":297.00000858306885,"y":173,"wires":[{"id":"b81be499.29794"}]}],"out":[{"x":1048.0000219345093,"y":164.99999904632568,"wires":[{"id":"87e22f76.cf7ff8","port":0}]}]},{"id":"8a54edd3.917338","type":"subflow","name":"mapped_nodes","info":"","in":[{"x":198.99999237060547,"y":165.99999141693115,"wires":[{"id":"9c5f3451.cdafe8"}]}],"out":[{"x":1080.0000305175781,"y":165.99997901916504,"wires":[{"id":"a806d30d.32fe18","port":0}]}]},{"id":"137d5632.c1208a","type":"subflow","name":"available_nodes","info":"","in":[{"x":41,"y":189.99999237060547,"wires":[{"id":"364bf653.b217b2"}]}],"out":[{"x":2058.9999980926514,"y":156.9999942779541,"wires":[{"id":"ed9aef2c.335158","port":0}]}]},{"id":"3243bb64.94c7b4","type":"subflow","name":"fastest_filter","info":"","in":[{"x":616.9999713897705,"y":186,"wires":[{"id":"4194f039.d21318"}]}],"out":[{"x":915.9999694824219,"y":173.99999237060547,"wires":[{"id":"4194f039.d21318","port":0}]}]},{"id":"e7e3b95a.29da88","type":"subflow","name":"delay_filter","info":"","in":[{"x":566.9999160766602,"y":200.00000190734863,"wires":[{"id":"9fb826a7.16657"}]}],"out":[{"x":882.9999694824219,"y":197.99999237060547,"wires":[{"id":"9fb826a7.16657","port":0}]}]},{"id":"a98f15d5.fefb9","type":"subflow","name":"first_filter","info":"","in":[{"x":548.999963760376,"y":148.99999237060547,"wires":[{"id":"365f735.ff2130c"}]}],"out":[{"x":890.9999694824219,"y":160.99999237060547,"wires":[{"id":"365f735.ff2130c","port":0}]}]},{"id":"9e68f4fd.265c8","type":"subflow","name":"executor","info":"","in":[{"x":103,"y":213,"wires":[{"id":"1a180832.f096f"}]}],"out":[{"x":1442,"y":207,"wires":[{"id":"7a540b87.8045a4","port":1}]}]},{"id":"3e1a1dce.aa9ae2","type":"subflow","name":"executor_node","info":"","in":[{"x":28,"y":159,"wires":[{"id":"4f986bac.7e0fbc"}]}],"out":[{"x":1324,"y":221,"wires":[{"id":"f92ba1fd.daced","port":1}]}]},{"id":"e7ee6205.86ed88","type":"subflow","name":"troponin_proxy_node","info":"","in":[{"x":217,"y":188,"wires":[{"id":"ee726cb7.73e97"}]}],"out":[{"x":771,"y":190,"wires":[{"id":"bc519db5.b945a","port":0}]}]},{"id":"e1cc44b0.94d07","type":"subflow","name":"test_proxy_node","info":"","in":[{"x":212,"y":134,"wires":[{"id":"2beef833.d2fa5"}]}],"out":[{"x":716,"y":147,"wires":[{"id":"c4da57ae.f4f728","port":0}]}]},{"id":"7b8bf22.018668c","type":"subflow","name":"ecg_proxy_node","info":"","in":[{"x":170,"y":98,"wires":[{"id":"fa18fd67.8d74d"}]}],"out":[{"x":747,"y":98,"wires":[{"id":"2f5c7529.09c52a","port":0}]}]},{"id":"23596ae8.85d1ee","type":"subflow","name":"executor_proxy","info":"","in":[{"x":50,"y":30,"wires":[{"id":"5a7e70bf.ac343"}]}],"out":[{"x":1292,"y":284,"wires":[{"id":"e0815712.144868","port":0}]}]},{"id":"1068371a.e9f4b9","type":"subflow","name":"Subflow 2","info":"","in":[],"out":[]},{"id":"cf2bb8ae.3f55c","type":"subflow","name":"available_arm","info":"","in":[{"x":50,"y":30,"wires":[{"id":"b7c2eaa0.7f1548"}]}],"out":[{"x":2355,"y":147,"wires":[{"id":"702ccae3.2cded4","port":0}]}]},{"id":"827c720.ab2511","type":"subflow","name":"test_first_arm_proxy","info":"","in":[{"x":30,"y":173,"wires":[{"id":"f6d5e8c6.fd344"}]}],"out":[{"x":776,"y":150,"wires":[{"id":"ff802136.83e038","port":0}]}]},{"id":"1b2d92a9.df8475","type":"subflow","name":"ecg_rpi2_proxy","info":"","in":[{"x":63,"y":196,"wires":[{"id":"82fa4643.5d975"}]}],"out":[{"x":457,"y":180,"wires":[{"id":"e4aa8fe3.03856","port":0}]}]},{"id":"2548b4a6.0547d4","type":"subflow","name":"troponin_rpi3_proxy","info":"","in":[{"x":192,"y":144,"wires":[{"id":"7541aae2.1f15b4"}]}],"out":[{"x":579,"y":126,"wires":[{"id":"b080182f.f4b618","port":0}]}]},{"id":"90618516.f631e8","type":"subflow","name":"mongo_ecg_pc1_proxy","info":"","in":[{"x":180,"y":148,"wires":[{"id":"7120a3b8.cae804"}]}],"out":[{"x":588,"y":131,"wires":[{"id":"775983a7.4777a4","port":0}]}]},{"id":"350877f6.2a3f6","type":"subflow","name":"mongo_troponin_proxy","info":"","in":[{"x":102,"y":176,"wires":[{"id":"96b81e86.0cfed8"}]}],"out":[{"x":556,"y":141,"wires":[{"id":"c0a0916b.80741","port":0}]}]},{"id":"343d6003.5a8bc8","type":"subflow","name":"troponin_p2","info":"","in":[{"x":67,"y":160,"wires":[{"id":"1106a37.db8a75d"}]}],"out":[{"x":626,"y":161,"wires":[{"id":"339570da.f018f8","port":0}]}]},{"id":"ec360aba.4d64d","type":"subflow","name":"test_p2","info":"","in":[{"x":110,"y":167,"wires":[{"id":"ed57d373.c85c8"}]}],"out":[{"x":617,"y":160,"wires":[{"id":"7a7487c7.9d9c6","port":0}]}]},{"id":"31668910.58a7e6","type":"subflow","name":"ecg_p2","info":"","in":[{"x":50,"y":30,"wires":[{"id":"7a1cac3a.beb5bc"}]}],"out":[{"x":629,"y":185,"wires":[{"id":"328c1771.b5b3","port":0}]}]},{"id":"907219de.a6c27","type":"subflow","name":"Subflow 1 (2)","info":"","in":[],"out":[]},{"id":"76d94169.84f338","type":"subflow","name":"location_selector (2)","info":"","in":[{"x":103.00000381469727,"y":88.00000190734863,"wires":[{"id":"601a8d88.31e464"}]}],"out":[{"x":2165.0001220703125,"y":97.00003814697266,"wires":[{"id":"791aa3dd.ac34dc","port":0}]}]},{"id":"c54a6289.8d3238","type":"subflow","name":"first_selector (2)","info":"","in":[{"x":198.9999918937683,"y":159.99999070167542,"wires":[{"id":"a6b4816b.334878"}]}],"out":[{"x":946.9999694824219,"y":153.99999237060547,"wires":[{"id":"38858a75.8c3b3e","port":0}]}]},{"id":"36ed9192.7f36c6","type":"subflow","name":"speed_selector (2)","info":"","in":[{"x":233.99999237060547,"y":192.99999237060547,"wires":[{"id":"f7fcadd1.4fd5a8"}]}],"out":[{"x":999.9999389648438,"y":174,"wires":[{"id":"e25c568a.4969e","port":0}]}]},{"id":"200df9f8.42e816","type":"subflow","name":"delay_selector (2)","info":"","in":[{"x":297.00000858306885,"y":173,"wires":[{"id":"dbc61ece.298888"}]}],"out":[{"x":1048.0000219345093,"y":164.99999904632568,"wires":[{"id":"a1931fb0.c216d8","port":0}]}]},{"id":"12faade0.02bbba","type":"subflow","name":"mapped_nodes (2)","info":"","in":[{"x":198.99999237060547,"y":165.99999141693115,"wires":[{"id":"9ddc0f1a.cf4b68"}]}],"out":[{"x":1080.0000305175781,"y":165.99997901916504,"wires":[{"id":"97fc1252.eb09d8","port":0}]}]},{"id":"7f74fb69.f311d4","type":"subflow","name":"available_nodes (2)","info":"","in":[{"x":41,"y":189.99999237060547,"wires":[{"id":"2dc03fe2.4eff68"}]}],"out":[{"x":2058.9999980926514,"y":156.9999942779541,"wires":[{"id":"e3abdb7f.c1826","port":0}]}]},{"id":"ebf70977.5d99c8","type":"subflow","name":"executor (2)","info":"","in":[{"x":103,"y":213,"wires":[{"id":"f3f55ce8.0f55a"}]}],"out":[{"x":1442,"y":207,"wires":[{"id":"bc79b8e6.262f8","port":1}]}]},{"id":"3c2de136.d6797e","type":"subflow","name":"executor_node (2)","info":"","in":[{"x":28,"y":159,"wires":[{"id":"272c1673.44805a"}]}],"out":[{"x":1324,"y":221,"wires":[{"id":"f9af888e.982418","port":1}]}]},{"id":"45e9ae74.d7fc68","type":"subflow","name":"executor_proxy (2)","info":"","in":[{"x":50,"y":30,"wires":[{"id":"8a6ea1b2.9ff4d"}]}],"out":[{"x":1292,"y":284,"wires":[{"id":"15fdadf.1b66dd2","port":0}]}]},{"id":"1d95fe66.40b202","type":"subflow","name":"Subflow 2 (2)","info":"","in":[],"out":[]},{"id":"1f4965e1.25c3da","type":"subflow","name":"available_arm (2)","info":"","in":[{"x":50,"y":30,"wires":[{"id":"924a08cd.17dc88"}]}],"out":[{"x":2355,"y":147,"wires":[{"id":"b0ca9d22.0e0ee","port":0}]}]},{"id":"83de406b.6969a","type":"subflow","name":"test_first_arm_proxy (2)","info":"","in":[{"x":30,"y":173,"wires":[{"id":"2beacae2.bac596"}]}],"out":[{"x":776,"y":150,"wires":[{"id":"e9d0ec51.4bba58","port":0}]}]},{"id":"e512626a.4a0ca","type":"subflow","name":"ecg_rpi2_proxy (2)","info":"","in":[{"x":63,"y":196,"wires":[{"id":"f0a9c714.f48d8"}]}],"out":[{"x":457,"y":180,"wires":[{"id":"4e1c1965.97c","port":0}]}]},{"id":"c44dda19.9778b8","type":"subflow","name":"troponin_rpi3_proxy (2)","info":"","in":[{"x":192,"y":144,"wires":[{"id":"1680430e.769795"}]}],"out":[{"x":579,"y":126,"wires":[{"id":"ddd61daa.c23d88","port":0}]}]},{"id":"cbab08a8.84cc78","type":"subflow","name":"mongo_ecg_pc1_proxy (2)","info":"","in":[{"x":180,"y":148,"wires":[{"id":"784b48e9.25e2e"}]}],"out":[{"x":588,"y":131,"wires":[{"id":"8e21146c.a9143","port":0}]}]},{"id":"e4366e89.5e626","type":"subflow","name":"mongo_troponin_proxy (2)","info":"","in":[{"x":102,"y":176,"wires":[{"id":"aba7ee58.5bcc58"}]}],"out":[{"x":556,"y":141,"wires":[{"id":"a6c7bb37.9ac02","port":0}]}]},{"id":"f7801593.79cfb","type":"subflow","name":"ecg_p2 (2)","info":"","in":[{"x":50,"y":30,"wires":[{"id":"6b647b59.8cbfd4"}]}],"out":[{"x":629,"y":185,"wires":[{"id":"67dfbc96.ca70ac","port":0}]}]},{"id":"66c8be67.8c1c08","type":"subflow","name":"sql_result_proxy","info":"","in":[{"x":203,"y":135,"wires":[{"id":"30c1486f.06f478"}]}],"out":[{"x":686,"y":150,"wires":[{"id":"9776d9b7.1cfdb8","port":0}]}]},{"id":"975bdb89.be2788","type":"subflow","name":"allocator","info":"","in":[{"x":46,"y":182,"wires":[{"id":"ae0f379b.60a04"}]}],"out":[{"x":1492,"y":274,"wires":[{"id":"5f82d6f.5df7028","port":0}]}]},{"id":"5011493c.122c2","type":"subflow","name":"deallocator","info":"","in":[{"x":66.00001525878906,"y":214,"wires":[{"id":"92eaedc5.8afd7"}]}],"out":[{"x":1421,"y":258.0000305175781,"wires":[{"id":"2524c64e.f5877a","port":0}]}]},{"id":"5e730042.2cd008","type":"subflow","name":"allocator22","info":"","in":[{"x":90,"y":109,"wires":[{"id":"37af802c.91581"}]}],"out":[{"x":1507,"y":308,"wires":[{"id":"cb8cf6e7.ed5a1","port":0}]}]},{"id":"be250337.39add8","type":"subflow","name":"demolocator","info":"","in":[{"x":166.00001525878906,"y":210.99998474121094,"wires":[{"id":"83b0f6f8.6dae1"}]}],"out":[{"x":1282,"y":105,"wires":[{"id":"51eaa09e.93ee08","port":0}]}]},{"id":"ba0bb15e.7354e8","type":"subflow","name":"Subflow 3","info":"","in":[],"out":[]},{"id":"18e20988.4c4aa6","type":"subflow","name":"real_first","info":"","in":[{"x":49,"y":205,"wires":[{"id":"e9eda326.c91c38"}]}],"out":[{"x":2314,"y":196,"wires":[{"id":"284db5bb.d266ea","port":0}]}]},{"id":"ae2b9df3.28132","type":"subflow","name":"real_fastest","info":"","in":[{"x":53,"y":156,"wires":[{"id":"55e9f4b4.13eca4"}]}],"out":[{"x":2257.9998779296875,"y":144.00001525878906,"wires":[{"id":"e3cc0ea3.0eb178","port":0}]}]},{"id":"15baf860.7fdb18","type":"subflow","name":"real_arm","info":"","in":[{"x":1131,"y":186.00001525878906,"wires":[{"id":"242d8a29.f53196"}]}],"out":[{"x":3653,"y":163.00001525878906,"wires":[{"id":"b2363d59.e3a61","port":0}]}]},{"id":"f0da5b33.1135d8","type":"subflow","name":"real_x86","info":"","in":[{"x":57,"y":198,"wires":[{"id":"d98829f6.869b68"}]}],"out":[{"x":2384.9998779296875,"y":173,"wires":[{"id":"2a071559.d7b192","port":0}]}]},{"id":"8b87741a.739808","type":"subflow","name":"Subflow 4","info":"","in":[],"out":[]},{"id":"a4c6f2a3.7f305","type":"subflow","name":"fake_dealloc","info":"","in":[{"x":195,"y":198,"wires":[{"id":"e10854ef.89ff48"}]}],"out":[{"x":687,"y":317,"wires":[{"id":"2732fe8c.2c9e62","port":0}]}]},{"id":"3bf728d9.ffd948","type":"subflow","name":"real_ram","info":"","in":[{"x":1094.999984741211,"y":228,"wires":[{"id":"9b1c7193.5d0a68"}]}],"out":[{"x":3577,"y":337.99998474121094,"wires":[{"id":"55a07098.625ef","port":0}]}]},{"id":"bc3468b7.122e3","type":"subflow","name":"universal_proxy","info":"","in":[{"x":44,"y":480.99998474121094,"wires":[{"id":"934c5ec9.6f8e8"}]}],"out":[{"x":1190,"y":493.99998474121094,"wires":[{"id":"7ff879a0.dff78","port":0}]}]},{"id":"473afc0d.5d627c","type":"subflow","name":"t_read","info":"","in":[{"x":166,"y":162,"wires":[{"id":"43f8466f.9817b"}]}],"out":[{"x":874,"y":149,"wires":[{"id":"6f047a70.e7bb94","port":0}]}]},{"id":"7dd2ebc8.99663c","type":"subflow","name":"e_value","info":"","in":[{"x":65,"y":154,"wires":[{"id":"4ac5445f.677a54"}]}],"out":[{"x":620,"y":175,"wires":[{"id":"e54017f1.41b3a","port":0}]}]},{"id":"2e1eeacc.7da106","type":"subflow","name":"trop_test","info":"","in":[{"x":186,"y":181,"wires":[{"id":"2f7b897d.f08916"}]}],"out":[{"x":728,"y":176,"wires":[{"id":"f3b71e37.979ce8","port":0}]}]},{"id":"71066960.262a98","type":"subflow","name":"template_proxy","info":"","in":[{"x":91,"y":182,"wires":[{"id":"7aa20d2e.b17174"}]}],"out":[{"x":1171,"y":337,"wires":[{"id":"539c0521.eab1dc","port":0}]}]},{"id":"f3dfe9b7.36946","type":"subflow","name":"test_p2 (2)","info":"","in":[{"x":110,"y":167,"wires":[{"id":"ab69faf0.b5883"}]}],"out":[{"x":617,"y":160,"wires":[{"id":"bc07cb4.b7fe3b8","port":0}]}]},{"id":"165bcb8.b1bba35","type":"subflow","name":"demolocator (2)","info":"","in":[{"x":166.00001525878906,"y":210.99998474121094,"wires":[{"id":"d4c20650.77c19"}]}],"out":[{"x":1282,"y":105,"wires":[{"id":"a978ff7f.95b938","port":0}]}]},{"id":"ee71f539.5b312","type":"subflow","name":"demolocator (2) (2)","info":"","in":[{"x":166.00001525878906,"y":210.99998474121094,"wires":[{"id":"ebec502f.344b3"}]}],"out":[{"x":1282,"y":105,"wires":[{"id":"7eb31306.0c1b4c","port":0}]}]},{"id":"8eeb0d6c.0053c8","type":"subflow","name":"demolocator (3)","info":"","in":[{"x":166.00001525878906,"y":210.99998474121094,"wires":[{"id":"35646581.e63d9a"}]}],"out":[{"x":1282,"y":105,"wires":[{"id":"cd2d9e47.477a7","port":0}]}]},{"id":"a6e93be1.9b7248","type":"subflow","name":"demolocator (4)","info":"","in":[{"x":166.00001525878906,"y":210.99998474121094,"wires":[{"id":"984b87c6.bb3218"}]}],"out":[{"x":1282,"y":105,"wires":[{"id":"f7643e29.aec95","port":0}]}]},{"id":"83c04467.6d22a","type":"subflow","name":"template_proxy (2)","info":"","in":[{"x":91,"y":182,"wires":[{"id":"6b6e5e8b.891f98"}]}],"out":[{"x":1174.0000915527344,"y":316.0000228881836,"wires":[{"id":"8383ac1d.51d94","port":0}]}]},{"id":"19705119.354137","type":"subflow","name":"template_proxy (2) (2)","info":"","in":[{"x":91,"y":182,"wires":[{"id":"951a9d3b.f645d8"}]}],"out":[{"x":1171,"y":337,"wires":[{"id":"78cca8b0.640b5","port":0}]}]},{"id":"ea3f3c60.b142d8","type":"subflow","name":"template_proxy (3)","info":"","in":[{"x":91,"y":182,"wires":[{"id":"df1dd255.4c4468"}]}],"out":[{"x":1171,"y":337,"wires":[{"id":"21ffc37c.99ae4c","port":0}]}]},{"id":"7fadc2e8.117a4c","type":"subflow","name":"template_proxy (4)","info":"","in":[{"x":91,"y":182,"wires":[{"id":"3e72f1ce.05065e"}]}],"out":[{"x":1171,"y":337,"wires":[{"id":"8bcc6e23.b4aca8","port":0}]}]},{"id":"21498d8a.668072","type":"subflow","name":"template_proxy (5)","info":"","in":[{"x":91,"y":182,"wires":[{"id":"7346b941.be46a"}]}],"out":[{"x":931.0000286102295,"y":460.00000953674316,"wires":[{"id":"f3e1b4e3.3b48a","port":0}]}]},{"id":"6bd42a30.ed4904","type":"subflow","name":"template_proxy (6)","info":"","in":[{"x":91,"y":182,"wires":[{"id":"db158b64.8018a8"}]}],"out":[{"x":1171,"y":337,"wires":[{"id":"637ab8e9.808028","port":0}]}]},{"id":"833497e3.542838","type":"subflow","name":"template_proxy (7)","info":"","in":[{"x":91,"y":182,"wires":[{"id":"646afbc1.166dfc"}]}],"out":[{"x":1171,"y":337,"wires":[{"id":"54b25ada.91d54c","port":0}]}]},{"id":"aaffdbe5.cb86c","type":"subflow","name":"template_proxy (8)","info":"","in":[{"x":91,"y":182,"wires":[{"id":"591a694a.c6f72"}]}],"out":[{"x":1171,"y":337,"wires":[{"id":"b0cad03.35ec6b","port":0}]}]},{"id":"bf299af7.2f0f18","type":"subflow","name":"template_proxy (9)","info":"","in":[{"x":91,"y":182,"wires":[{"id":"a19744d7.21e37"}]}],"out":[{"x":1171,"y":337,"wires":[{"id":"fc807ad8.457668","port":0}]}]},{"id":"6a159280.568b7c","type":"subflow","name":"template_proxy (10)","info":"","in":[{"x":155,"y":564.9999694824219,"wires":[{"id":"8fde5d1d.21e8e"}]}],"out":[{"x":935.9999389648438,"y":576.9999694824219,"wires":[{"id":"c061f9b7.dcc1c","port":0}]}]},{"id":"8b34e9c3.b6805","type":"subflow","name":"test_processing","info":"","in":[{"x":91,"y":182,"wires":[{"id":"8d140929.7a39c"}]}],"out":[{"x":1197,"y":335,"wires":[{"id":"6498b1b5.3586d8","port":0}]}]},{"id":"a124b48b.51d33","type":"subflow","name":"demolocator (5)","info":"","in":[{"x":166.00001525878906,"y":210.99998474121094,"wires":[{"id":"1aa5848c.c84a83"}]}],"out":[{"x":1282,"y":105,"wires":[{"id":"3c25f25c.3e797e","port":0}]}]},{"id":"90fe7935.af7ab","type":"subflow","name":"service_creator","info":"","in":[{"x":68,"y":132,"wires":[{"id":"e7716749.e6df18"}]}],"out":[]},{"id":"9fbd62ed.065678","type":"subflow","name":"ecg_processing","info":"","in":[{"x":91,"y":182,"wires":[{"id":"3fbd58f8.8539b"}]}],"out":[{"x":1171,"y":337,"wires":[{"id":"60cd04f.9e64ffc","port":0}]}]},{"id":"3b87031f.7136b4","type":"subflow","name":"service_creator (2)","info":"","in":[{"x":68,"y":132,"wires":[{"id":"4330a1f1.9d8e9"}]}],"out":[]},{"id":"751e1e72.95dc1","type":"subflow","name":"lb_allocator","info":"","in":[],"out":[]},{"id":"ef218db9.bc2e9","type":"subflow","name":"Subflow 5","info":"","in":[],"out":[]},{"id":"30a31ce6.80785c","type":"subflow","name":"lb_node","info":"","in":[],"out":[]},{"id":"43424bb0.09203c","type":"subflow","name":"service_creator (2) (2)","info":"","in":[{"x":68,"y":132,"wires":[{"id":"b4a4ccb.d3641b"}]}],"out":[]},{"id":"902690ba.66ce9","type":"subflow","name":"lb_node (2)","info":"","in":[],"out":[]},{"id":"19ee3191.099ef6","type":"subflow","name":"test_processing (2)","info":"","in":[{"x":91,"y":182,"wires":[{"id":"42421c2a.71cd9c"}]}],"out":[{"x":1171,"y":337,"wires":[{"id":"e743f440.a671f","port":0}]}]},{"id":"a5f2e70.3b98f18","type":"subflow","name":"test_processing (3)","info":"","in":[{"x":91,"y":182,"wires":[{"id":"34279326.a3e9a4"}]}],"out":[{"x":1171,"y":337,"wires":[{"id":"bedec47f.b8ccb","port":0}]}]},{"id":"f7d6c10a.a5abe8","type":"subflow","name":"troponin_processing","info":"","in":[{"x":91,"y":182,"wires":[{"id":"29a6bf10.21844"}]}],"out":[{"x":1171,"y":337,"wires":[{"id":"ad4364e5.871f3","port":0}]}]},{"id":"8439eaa8.01c9a","type":"subflow","name":"arm2222","info":"","in":[{"x":82,"y":326.00000762939453,"wires":[{"id":"909d86bc.0a869"}]}],"out":[{"x":2907.0001220703125,"y":771,"wires":[{"id":"d79db8ca.14fef8","port":0}]}]},{"id":"9fbd61ac.7482f","type":"subflow","name":"arm_first_device","info":"","in":[{"x":192,"y":419.00000762939453,"wires":[{"id":"d0d5d072.bef3e"}]}],"out":[{"x":2769.0001220703125,"y":216.00003051757812,"wires":[{"id":"5c94f96.c936c88","port":0}]}]},{"id":"bd538ff1.ae6a08","type":"subflow","name":"x86_first_device","info":"","in":[{"x":25,"y":171.00000762939453,"wires":[{"id":"1b623a45.18abb6"}]}],"out":[{"x":2852.0001220703125,"y":356,"wires":[{"id":"258bd6fc.d34d9a","port":0}]}]},{"id":"3f28fc4e.fee994","type":"subflow","name":"binder_final","info":"","in":[],"out":[]},{"id":"906e6fb1.2d84d8","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"local","name":""},{"id":"3659fb19.a4c964","type":"mongodb","z":"","hostname":"192.168.99.100","port":"32770","db":"test","name":""},{"id":"47cecb18.586f84","type":"MySQLdatabase","z":"","host":"192.168.99.100","port":"3306","db":"patients2","tz":""},{"id":"a6de67d4.7656","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"f3eae632.dd606","type":"MySQLdatabase","z":"d9a0dcec.e2c7a8","host":"sql11.freemysqlhosting.net","port":"3306","db":"sql11172691","tz":""},{"id":"f728d3f8.4e5e28","type":"mongodb","z":"","hostname":"10.79.5.169","port":"28017","db":"base","name":""},{"id":"d997ca32.8966f8","type":"SSH_Credentials","z":"","host":"printenv ssh_host","port":"22","userlabel":"printenv ssh_user@printenv ssh_host"},{"id":"7cb0b0ed.03a338","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27018","db":"ecg","name":""},{"id":"ec71d3ad.09e2b","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"local","name":""},{"id":"e64652c8.967af8","type":"mongodb2","z":"","uri":"","name":"","options":"","parallelism":"-1"},{"id":"beb02224.29b348","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"local","name":""},{"id":"a2bac3b.78745c","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"troponin","name":""},{"id":"f07a7535.b5f8f","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27018","db":"ecg","name":""},{"id":"f257ebc5.4470b8","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"local","name":""},{"id":"edfa7605.5adcd8","type":"mongodb","z":"","hostname":"192.168.99.100","port":"32770","db":"test","name":""},{"id":"dc4fff69.708838","type":"MySQLdatabase","z":"","host":"192.168.99.100","port":"3306","db":"patients2","tz":""},{"id":"f03ed1a4.b25e5","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"609b94d8.9c989c","type":"MySQLdatabase","z":"81cc33f0.fc5b8","host":"sql11.freemysqlhosting.net","port":"3306","db":"sql11172691","tz":""},{"id":"5e998395.210904","type":"mongodb","z":"","hostname":"10.79.5.169","port":"28017","db":"base","name":""},{"id":"6847aabe.79e92c","type":"SSH_Credentials","z":"","host":"printenv ssh_host","port":"22","userlabel":"printenv ssh_user@printenv ssh_host"},{"id":"528ed43b.97578c","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27018","db":"ecg","name":""},{"id":"4d2ed169.a451a8","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"local","name":""},{"id":"9821bf2d.43f008","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"local","name":""},{"id":"d8e02658.904e9","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"troponin","name":""},{"id":"ade6f75b.4065c8","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27018","db":"ecg","name":""},{"id":"b0597493.f79608","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"","tz":""},{"id":"b43efa28.b858b8","type":"MySQLdatabase","z":"","host":"sql11.freemysqlhosting.net","port":"3306","db":"sql11172691","tz":""},{"id":"bd6224dc.241d78","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3307","db":"patients","tz":""},{"id":"7409cc1e.6f9ee4","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":"troponin2"},{"id":"66f99276.2bb9b4","type":"mongodb","z":"","hostname":"localhost","port":"27017","db":"test","name":""},{"id":"e4a159fc.52d01","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"joinme","tz":""},{"id":"3a196ee9.d5e3ba","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"joinme","tz":""},{"id":"57dd9546.d035a4","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"27017","db":"cloudtest","name":"ja"},{"id":"72bf3509.a45584","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"7894cbc2.4ac3dc","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"troponin","name":""},{"id":"4e34722e.24b29c","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27018","db":"ecg","name":""},{"id":"d102a349.e1c308","type":"MySQLdatabase","z":"","host":"sql11.freemysqlhosting.net","port":"3306","db":"sql11172691","tz":""},{"id":"aa238f23.3e5d2","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"79c3a251.fae494","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"5f2430b6.84e668","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"3b6435c9.85c04a","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"860ee023.9915f","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"6928c4d2.b31464","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"11c243dc.e27114","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"21ce8d9c.9aa3e2","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"2488ba70.4a3f2e","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"ed7ef282.b66678","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"930eac2b.7280d","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"7979e74f.afdd5","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"fc745c17.71d56","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"da97d0f8.c4c3c","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"a38c993e.77baa","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"6daf288f.08ccf8","type":"mongodb","z":"","hostname":"ds113841.mlab.com","port":"13841","db":"cloudtest","name":""},{"id":"22ab6e51.1eb2fa","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/infraction_test3","method":"get","swaggerDoc":"","x":159.66665649414062,"y":221.66650390625,"wires":[["d9c36b4c.fd5a9"]]},{"id":"55c02eb1.c382c8","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"3659fb19.a4c964","name":"","collection":"ecg","operation":"find","x":752.1669921875,"y":114.66719055175781,"wires":[["2cce97f5.55c788"]]},{"id":"d9c36b4c.fd5a9","type":"function","z":"d9a0dcec.e2c7a8","name":"query ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.req.query.patient_id; \nmsg.payload={ patient_id: patient};\nmsg.projection = {\"_id\":0, \"anomaly\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":489.6663475036621,"y":229.6669807434082,"wires":[["55c02eb1.c382c8"]]},{"id":"2cce97f5.55c788","type":"function","z":"d9a0dcec.e2c7a8","name":"processing1","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].anomaly);\n}\nmsg.payload=result[0];\nflow.set('db1',result[0]);\nreturn msg;\n","outputs":1,"noerr":0,"x":1009.666748046875,"y":190.66725158691406,"wires":[["aabc6115.a9f9c"]]},{"id":"aabc6115.a9f9c","type":"function","z":"d9a0dcec.e2c7a8","name":"query troponin","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.req.query.patient_id; \n\nmsg.payload={ patient_id: patient};\nmsg.projection = {\"_id\":0, \"increased\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1235.1664581298828,"y":331.0002555847168,"wires":[["d50df0aa.859"]]},{"id":"70f36fff.961268","type":"function","z":"d9a0dcec.e2c7a8","name":"processing2","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].increased);\n}\n\n\nmsg.payload=flow.get('db1')*result[0];\nflow.set('outcome',msg.payload);\nreturn msg;\n","outputs":1,"noerr":0,"x":1757.3336486816406,"y":121,"wires":[["cd679742.9d675"]]},{"id":"3c4820c5.1d1908","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":2459.8336486816406,"y":213.000244140625,"wires":[]},{"id":"cd679742.9d675","type":"function","z":"d9a0dcec.e2c7a8","name":"insert outcome","func":"var outcome=flow.get('outcome');\nvar patient=msg.req.query.patient_id; \nmsg.topic=\"INSERT INTO result values('\"+patient+\"',\"+outcome+\") \";\nreturn msg;","outputs":1,"noerr":0,"x":1999.3336486816406,"y":213,"wires":[["822b2ed3.718588"]]},{"id":"300e5078.bb51a","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/infraction_test4","method":"get","swaggerDoc":"","x":140.33335876464844,"y":488.3331604003906,"wires":[["5746bd95.14fcf4"]]},{"id":"8421c63f.98e6a8","type":"function","z":"d9a0dcec.e2c7a8","name":"query troponin","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.req.query.patient_id; \n\nmsg.payload={ patient_id: patient};\nmsg.projection = {\"_id\":0, \"increased\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1367.8331756591797,"y":548.6669006347656,"wires":[["29f58d0e.091eea"]]},{"id":"ef6a66f.bc63318","type":"function","z":"d9a0dcec.e2c7a8","name":"processing2","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].increased);\n}\n\n\nmsg.payload=flow.get('db1')*result[0];\nflow.set('outcome',msg.payload);\nreturn msg;\n","outputs":1,"noerr":0,"x":1965.0004425048828,"y":513.6666831970215,"wires":[["e26c4de6.50586"]]},{"id":"a86c52d3.e6f738","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":2394.500312805176,"y":463.66688537597656,"wires":[]},{"id":"e26c4de6.50586","type":"function","z":"d9a0dcec.e2c7a8","name":"insert outcome","func":"var outcome=flow.get('outcome');\nvar patient=msg.req.query.patient_id; \nmsg.topic=\"INSERT INTO result values('\"+patient+\"',\"+outcome+\") \";\nreturn msg;","outputs":1,"noerr":0,"x":2136.0004348754883,"y":474.6666522026062,"wires":[["adae3803.2955d8"]]},{"id":"822b2ed3.718588","type":"mysql","z":"d9a0dcec.e2c7a8","mydb":"47cecb18.586f84","name":"","x":2272.6666564941406,"y":178.66650390625,"wires":[["3c4820c5.1d1908"]]},{"id":"adae3803.2955d8","type":"mysql","z":"d9a0dcec.e2c7a8","mydb":"f3eae632.dd606","name":"","x":2285.667060852051,"y":399.6665439605713,"wires":[["a86c52d3.e6f738"]]},{"id":"d50df0aa.859","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"3659fb19.a4c964","name":"","collection":"troponin","operation":"find","x":1478.1666259765625,"y":196.66650390625,"wires":[["70f36fff.961268"]]},{"id":"29f58d0e.091eea","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"","collection":"troponin","operation":"find","x":1662.6666793823242,"y":522.6665325164795,"wires":[["ef6a66f.bc63318"]]},{"id":"2f4d4cb5.0cea04","type":"function","z":"d9a0dcec.e2c7a8","name":"processing1","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].anomaly);\n}\nmsg.payload=result[0];\nflow.set('db1',result[0]);\nreturn msg;\n","outputs":1,"noerr":0,"x":1134.333293914795,"y":539.3338890075684,"wires":[["8421c63f.98e6a8"]]},{"id":"a04803e9.3dfd28","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"","collection":"ecg","operation":"find","x":645.1666870117188,"y":483.6665344238281,"wires":[["2f4d4cb5.0cea04"]]},{"id":"5746bd95.14fcf4","type":"function","z":"d9a0dcec.e2c7a8","name":"query ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.req.query.patient_id; \nmsg.payload={ patient_id: patient};\nmsg.projection = {\"_id\":0, \"anomaly\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":368.3330383300781,"y":487.3336486816406,"wires":[["a04803e9.3dfd28"]]},{"id":"aac48eea.e2a1d8","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/first_selector","method":"get","swaggerDoc":"","x":183.00003051757812,"y":725.9999761581421,"wires":[["6a4d13da.4805a4"]]},{"id":"9c80b540.c1ce3","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":1115.1677570343018,"y":722.3337478637695,"wires":[]},{"id":"6786986c.fc0cc","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":626.8333740234375,"y":707.3334350585938,"wires":[["f5147237.7cc55"]]},{"id":"6a4d13da.4805a4","type":"function","z":"d9a0dcec.e2c7a8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":402.9997215270996,"y":725.0004653930664,"wires":[["6786986c.fc0cc"]]},{"id":"f5147237.7cc55","type":"function","z":"d9a0dcec.e2c7a8","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":850.008171081543,"y":720.5235252380371,"wires":[["9c80b540.c1ce3"]]},{"id":"af302767.e0d67","type":"http request","z":"d9a0dcec.e2c7a8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":684.5000228881836,"y":1291.0002069473267,"wires":[["2e27404a.459e48"]]},{"id":"be1a2662.db9ee","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/troponin_proxy","method":"get","swaggerDoc":"","x":181.50000762939453,"y":1293.0001649856567,"wires":[["e2e4597c.b6cf78"]]},{"id":"e2e4597c.b6cf78","type":"function","z":"d9a0dcec.e2c7a8","name":"url_maker_troponin","func":"msg.limit = 5;\nmsg.skip = 0;\nvar troponin_value=msg.req.query.troponin; \nvar service_location=\"192.168.99.100/troponin.php\"\nmsg.url=service_location+\"?troponin=\"+troponin_value;\nreturn msg;\n","outputs":1,"noerr":0,"x":448.00001525878906,"y":1280.0002069473267,"wires":[["af302767.e0d67"]]},{"id":"6f0f9b68.c7626c","type":"http request","z":"d9a0dcec.e2c7a8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":626,"y":1361.0001220703125,"wires":[["283ee4d9.47412c"]]},{"id":"4c911f5b.bb9b48","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/ecg_proxy","method":"get","swaggerDoc":"","x":178,"y":1369.0001220703125,"wires":[["ac32a11d.808ec8"]]},{"id":"ac32a11d.808ec8","type":"function","z":"d9a0dcec.e2c7a8","name":"url_maker_ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar ecg_value=msg.req.query.ecg; \nvar service_location=\"192.168.99.100/ecg.php\"\nmsg.url=service_location+\"?ecg=\"+ecg_value;\nreturn msg;\n","outputs":1,"noerr":0,"x":424.5,"y":1358.0001220703125,"wires":[["6f0f9b68.c7626c"]]},{"id":"283ee4d9.47412c","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":791.5,"y":1367.0001220703125,"wires":[]},{"id":"2e27404a.459e48","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":846.5000267028809,"y":1291.000147819519,"wires":[]},{"id":"7c954ef9.60564","type":"http request","z":"d9a0dcec.e2c7a8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":634.0000076293945,"y":1436.0001573562622,"wires":[["4735b059.de4088"]]},{"id":"3160e47b.e2d9ec","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/test_proxy","method":"get","swaggerDoc":"","x":180.00000762939453,"y":1474.0001573562622,"wires":[["3794ac9b.696fe4"]]},{"id":"3794ac9b.696fe4","type":"function","z":"d9a0dcec.e2c7a8","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar ecg=msg.req.query.ecg;\nvar troponin=msg.req.query.troponin;\nvar service_location=\"192.168.99.100/test.php\";\nmsg.url=service_location+\"?ecg=\"+ecg+\"&troponin=\"+troponin;\nreturn msg;\n","outputs":1,"noerr":0,"x":431.50000762939453,"y":1420.0001573562622,"wires":[["7c954ef9.60564"]]},{"id":"4735b059.de4088","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":804.5000076293945,"y":1435.0001573562622,"wires":[]},{"id":"40f73cda.692594","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/speed_selector","method":"get","swaggerDoc":"","x":189.5078125,"y":797.5234375,"wires":[["6fdf38d8.136568"]]},{"id":"48a81181.efb13","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":1111.6755390167236,"y":793.8572092056274,"wires":[]},{"id":"7817cceb.ce696c","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":630.3411712646484,"y":783.8568887710571,"wires":[["652ff4fe.962544"]]},{"id":"6fdf38d8.136568","type":"function","z":"d9a0dcec.e2c7a8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":399.5075035095215,"y":796.5239267349243,"wires":[["7817cceb.ce696c"]]},{"id":"652ff4fe.962544","type":"function","z":"d9a0dcec.e2c7a8","name":"fastest_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nvar max=0;\n\nfor(var i =0; i<keys.length;i++)\n{\n  if(msg.payload[keys[i]].processing_speed>max) \n  {\n      result=msg.payload[keys[i]].node;\n  }\n}\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":856.5159530639648,"y":792.046986579895,"wires":[["48a81181.efb13"]]},{"id":"7fba3c8c.6a73e4","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/delay_selector","method":"get","swaggerDoc":"","x":181.5078125,"y":859.5234375,"wires":[["8fecba5d.7f1ba8"]]},{"id":"9b27e46b.8ad2e","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":1113.6755390167236,"y":855.8572092056274,"wires":[]},{"id":"e707ed18.1101b","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":632.3411712646484,"y":845.8568887710571,"wires":[["fd1b3132.ead778"]]},{"id":"8fecba5d.7f1ba8","type":"function","z":"d9a0dcec.e2c7a8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":401.5075035095215,"y":858.5239267349243,"wires":[["e707ed18.1101b"]]},{"id":"fd1b3132.ead778","type":"function","z":"d9a0dcec.e2c7a8","name":"delay_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nvar min=6;\n\nfor(var i =0; i<keys.length;i++)\n{\n  if(msg.payload[keys[i]].network_delay<min) \n  {\n      result=msg.payload[keys[i]].node;\n  }\n}\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":848.5159530639648,"y":854.046986579895,"wires":[["9b27e46b.8ad2e"]]},{"id":"41f660e2.2d3ff8","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/location_selector1","method":"get","swaggerDoc":"","x":189.5078125,"y":935.0234174728394,"wires":[["decb5eb0.cd1128"]]},{"id":"a95e5615.efb23","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":1143.6755657196045,"y":931.3571891784668,"wires":[]},{"id":"d60423c0.5f41d","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"tasks","collection":"tasks","operation":"find","x":631.3412322998047,"y":947.3567924499512,"wires":[["e78daaf8.a4d63"]]},{"id":"decb5eb0.cd1128","type":"function","z":"d9a0dcec.e2c7a8","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":405.5075225830078,"y":935.0238447189331,"wires":[["d60423c0.5f41d"]]},{"id":"e78daaf8.a4d63","type":"function","z":"d9a0dcec.e2c7a8","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\nmsg.payload=result.execution;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":859.5078353881836,"y":931.0234189033508,"wires":[["a95e5615.efb23"]]},{"id":"605bb8dc.faa5a","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/location_selector2","method":"get","swaggerDoc":"","x":175.5078125,"y":1008.0234260559082,"wires":[["2ab2b915.b7c08e"]]},{"id":"fdc3b36e.b3ecd","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"tasks","collection":"tasks","operation":"find","x":645.3412933349609,"y":1031.3568229675293,"wires":[["e6f6ec5b.8d2818"]]},{"id":"2ab2b915.b7c08e","type":"function","z":"d9a0dcec.e2c7a8","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":390.5075225830078,"y":996.0238037109375,"wires":[["fdc3b36e.b3ecd"]]},{"id":"e6f6ec5b.8d2818","type":"function","z":"d9a0dcec.e2c7a8","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":857.5078735351562,"y":1019.0233879089355,"wires":[["9631e65.8cd4b98"]]},{"id":"9631e65.8cd4b98","type":"function","z":"d9a0dcec.e2c7a8","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1078.0079345703125,"y":1015.0234489440918,"wires":[["3c6c6a78.994e36"]]},{"id":"d2e5e3c3.74d6","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":1788.0080108642578,"y":1087.0237560272217,"wires":[["125ded74.4e77fb"]]},{"id":"f043fd00.5b0b1","type":"function","z":"d9a0dcec.e2c7a8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1621.1741409301758,"y":1088.6910228729248,"wires":[["d2e5e3c3.74d6"]]},{"id":"3c6c6a78.994e36","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"nodes","collection":"nodes","operation":"find","x":1260.0078468322754,"y":1018.0234184265137,"wires":[["c995f136.9e3e68"]]},{"id":"ca4ea06d.bbfd98","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":1608.0002346038818,"y":1021.9141960144043,"wires":[]},{"id":"c995f136.9e3e68","type":"function","z":"d9a0dcec.e2c7a8","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=flow.get('nodes');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1415.507984161377,"y":1009.0233864784241,"wires":[["ca4ea06d.bbfd98"]]},{"id":"430570f9.f80398","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/location_selector","method":"get","swaggerDoc":"","x":170.03125,"y":1095.0469188690186,"wires":[["c91a303.b27fad"]]},{"id":"ce6830c4.b9e8a8","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"tasks","collection":"tasks","operation":"find","x":668.8647308349609,"y":1094.380271911621,"wires":[["9ba6499d.aed6b8"]]},{"id":"c91a303.b27fad","type":"function","z":"d9a0dcec.e2c7a8","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":409.03099060058594,"y":1085.047285079956,"wires":[["ce6830c4.b9e8a8"]]},{"id":"9ba6499d.aed6b8","type":"function","z":"d9a0dcec.e2c7a8","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":881.0313110351562,"y":1082.0468368530273,"wires":[["131454b9.8ef5b3"]]},{"id":"131454b9.8ef5b3","type":"function","z":"d9a0dcec.e2c7a8","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1114.531494140625,"y":1090.0469493865967,"wires":[["856ec2f0.91fee8"]]},{"id":"856ec2f0.91fee8","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"nodes","collection":"nodes","operation":"find","x":1271.5313110351562,"y":1090.0469489097595,"wires":[["ff734fa.c0f50b"]]},{"id":"ff734fa.c0f50b","type":"function","z":"d9a0dcec.e2c7a8","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1423.0313186645508,"y":1090.0471019744873,"wires":[["f043fd00.5b0b1"]]},{"id":"125ded74.4e77fb","type":"function","z":"d9a0dcec.e2c7a8","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1956.5076904296875,"y":1087.5234375,"wires":[["7d648003.a479b"]]},{"id":"7d648003.a479b","type":"function","z":"d9a0dcec.e2c7a8","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=\" \";\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<mapped.length;j++)\n    {\n        if (mapped[j]==nodes[i])\n        {\n            result=mapped[j];\n        }\n    }\n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2112.0097045898438,"y":1093.523666381836,"wires":[["b370970e.9f7f1"]]},{"id":"b370970e.9f7f1","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":2263,"y":1099.390625,"wires":[]},{"id":"344f8019.e8d6e8","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":1723.9767684936523,"y":1234.046932220459,"wires":[["f536242a.851278"]]},{"id":"f67e654f.084ba8","type":"function","z":"d9a0dcec.e2c7a8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1566.1428909301758,"y":1195.7141418457031,"wires":[["344f8019.e8d6e8"]]},{"id":"b61348b2.b1e658","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/location_selector3","method":"get","swaggerDoc":"","x":105,"y":1202.0700378417969,"wires":[["6be82be1.815ddc"]]},{"id":"8ae39f2d.49062","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"tasks","collection":"tasks","operation":"find","x":623.8334808349609,"y":1201.4033908843994,"wires":[["7a32b8f6.3f29e8"]]},{"id":"6be82be1.815ddc","type":"function","z":"d9a0dcec.e2c7a8","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":363.99974060058594,"y":1192.0704040527344,"wires":[["8ae39f2d.49062"]]},{"id":"7a32b8f6.3f29e8","type":"function","z":"d9a0dcec.e2c7a8","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":836.0000610351562,"y":1189.0699558258057,"wires":[["1b8efd31.6c667b"]]},{"id":"1b8efd31.6c667b","type":"function","z":"d9a0dcec.e2c7a8","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1069.500244140625,"y":1197.070068359375,"wires":[["283a8ce7.bfafcc"]]},{"id":"283a8ce7.bfafcc","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"nodes","collection":"nodes","operation":"find","x":1226.5000610351562,"y":1197.0700678825378,"wires":[["95554b7f.5f426"]]},{"id":"95554b7f.5f426","type":"function","z":"d9a0dcec.e2c7a8","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1368.0000686645508,"y":1197.0702209472656,"wires":[["f67e654f.084ba8"]]},{"id":"f536242a.851278","type":"function","z":"d9a0dcec.e2c7a8","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1928.4764099121094,"y":1201.5466270446777,"wires":[["9f90e84d.fcbc2"]]},{"id":"9f90e84d.fcbc2","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":2217.96875,"y":1206.4137439727783,"wires":[]},{"id":"9197ec38.d8c568","type":"http in","z":"34765634.339aa2","name":"","url":"/first_selector","method":"get","swaggerDoc":"","x":185.5078125,"y":127.5390625,"wires":[["bbf98a5f.16e7b"]]},{"id":"8ad5890.d24c578","type":"http response","z":"34765634.339aa2","name":"","x":1117.6755390167236,"y":123.87283420562744,"wires":[]},{"id":"9b974e2f.8b67f8","type":"mongodb in","z":"34765634.339aa2","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":636.3411712646484,"y":113.87251377105713,"wires":[["f88e5a66.3feaf"]]},{"id":"bbf98a5f.16e7b","type":"function","z":"34765634.339aa2","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":405.5075225830078,"y":118.53955554962158,"wires":[["9b974e2f.8b67f8"]]},{"id":"f88e5a66.3feaf","type":"function","z":"34765634.339aa2","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":878.5159797668457,"y":122.06261444091797,"wires":[["8ad5890.d24c578"]]},{"id":"b55f435.94899c","type":"mongodb in","z":"f12e2cf8.9926f8","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":1722.9767608642578,"y":80.88888549804688,"wires":[["965a47b0.c3f67"]]},{"id":"c8cafe4a.c8b078","type":"function","z":"f12e2cf8.9926f8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1556.1428909301758,"y":82.55615234375,"wires":[["b55f435.94899c"]]},{"id":"9231e3e7.7fe338","type":"mongodb in","z":"f12e2cf8.9926f8","mongodb":"a6de67d4.7656","name":"tasks","collection":"tasks","operation":"find","x":520.8335113525391,"y":95.24540710449219,"wires":[["434b287d.3ddf"]]},{"id":"e4cf01a6.ff0a","type":"function","z":"f12e2cf8.9926f8","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":261.9997749328613,"y":83.91241788864136,"wires":[["9231e3e7.7fe338"]]},{"id":"434b287d.3ddf","type":"function","z":"f12e2cf8.9926f8","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":816.0000610351562,"y":75.91196632385254,"wires":[["319203ab.31693c"]]},{"id":"319203ab.31693c","type":"function","z":"f12e2cf8.9926f8","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1049.500244140625,"y":83.91207885742188,"wires":[["127d8fd6.f72c"]]},{"id":"127d8fd6.f72c","type":"mongodb in","z":"f12e2cf8.9926f8","mongodb":"a6de67d4.7656","name":"nodes","collection":"nodes","operation":"find","x":1206.5000610351562,"y":83.91207838058472,"wires":[["ac0e0d6c.95fcd8"]]},{"id":"ac0e0d6c.95fcd8","type":"function","z":"f12e2cf8.9926f8","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1358.0000686645508,"y":83.9122314453125,"wires":[["c8cafe4a.c8b078"]]},{"id":"965a47b0.c3f67","type":"function","z":"f12e2cf8.9926f8","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1891.4764404296875,"y":81.3885669708252,"wires":[["23e40111.e51fde"]]},{"id":"23e40111.e51fde","type":"function","z":"f12e2cf8.9926f8","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=\" \";\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<mapped.length;j++)\n    {\n        if (mapped[j]==nodes[i])\n        {\n            result=mapped[j];\n        }\n    }\n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2046.9784545898438,"y":87.38879585266113,"wires":[[]]},{"id":"f6a23d55.0c5ad","type":"inject","z":"d9a0dcec.e2c7a8","name":"","topic":"","payload":"troponin_processing","payloadType":"str","repeat":"10","crontab":"","once":true,"x":153.8333740234375,"y":1866.1741943359375,"wires":[[]]},{"id":"6a464e27.aad73","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":1004.2742614746094,"y":1923.2641868591309,"wires":[]},{"id":"47025e1e.7b9fd","type":"subflow:f12e2cf8.9926f8","z":"d9a0dcec.e2c7a8","x":413.8367919921875,"y":1534.288330078125,"wires":[[]]},{"id":"5bb2833d.22d194","type":"mongodb in","z":"29cbf52c.3e9352","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":594.5000152587891,"y":146.00010776519775,"wires":[["a5348e3a.2c10d8"]]},{"id":"5f8b360d.7033c","type":"function","z":"29cbf52c.3e9352","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload;\n\nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":363.6663475036621,"y":158.66714572906494,"wires":[["5bb2833d.22d194"]]},{"id":"a5348e3a.2c10d8","type":"function","z":"29cbf52c.3e9352","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":810.6747970581055,"y":154.19020557403564,"wires":[[]]},{"id":"531cdf4d.a41578","type":"subflow:29cbf52c.3e9352","z":"d9a0dcec.e2c7a8","x":777.5000305175781,"y":1576.6666259765625,"wires":[[]]},{"id":"c75057cb.84076","type":"mongodb in","z":"c24ee3f8.7e8628","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":626.5000152587891,"y":152.00010776519775,"wires":[["8b8b2577.e04d78"]]},{"id":"ba974e58.8a7d88","type":"function","z":"c24ee3f8.7e8628","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":395.6663475036621,"y":164.66714572906494,"wires":[["c75057cb.84076"]]},{"id":"8b8b2577.e04d78","type":"function","z":"c24ee3f8.7e8628","name":"fastest_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nvar max=0;\n\nfor(var i =0; i<keys.length;i++)\n{\n  if(msg.payload[keys[i]].processing_speed>max) \n  {\n      result=msg.payload[keys[i]].node;\n  }\n}\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":852.6747970581055,"y":160.19020557403564,"wires":[[]]},{"id":"fbd6886e.e1997","type":"mongodb in","z":"478481c2.0790f","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":693.5,"y":160.00010108947754,"wires":[["87e22f76.cf7ff8"]]},{"id":"b81be499.29794","type":"function","z":"478481c2.0790f","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":467.6663589477539,"y":166.6671440601349,"wires":[["fbd6886e.e1997"]]},{"id":"87e22f76.cf7ff8","type":"function","z":"478481c2.0790f","name":"delay_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nvar min=6;\n\nfor(var i =0; i<keys.length;i++)\n{\n  if(msg.payload[keys[i]].network_delay<min) \n  {\n      result=msg.payload[keys[i]].node;\n  }\n}\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":891.6748161315918,"y":160.19020557403564,"wires":[[]]},{"id":"1182ccd2.20ed73","type":"subflow:478481c2.0790f","z":"d9a0dcec.e2c7a8","x":421.5,"y":1806,"wires":[[]]},{"id":"47b24aac.8457dc","type":"mongodb in","z":"8a54edd3.917338","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":604.5000152587891,"y":155.00010776519775,"wires":[["a806d30d.32fe18"]]},{"id":"9c5f3451.cdafe8","type":"function","z":"8a54edd3.917338","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":373.6663475036621,"y":167.66714572906494,"wires":[["47b24aac.8457dc"]]},{"id":"a806d30d.32fe18","type":"function","z":"8a54edd3.917338","name":"save node ids","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":883.6748123168945,"y":160.19020557403564,"wires":[[]]},{"id":"76efd45e.56ab94","type":"mongodb in","z":"137d5632.c1208a","mongodb":"a6de67d4.7656","name":"tasks","collection":"tasks","operation":"find","x":415.6666564941406,"y":157.66665649414062,"wires":[["8fdea9df.6d265"]]},{"id":"364bf653.b217b2","type":"function","z":"137d5632.c1208a","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":156.8329200744629,"y":146.3336672782898,"wires":[["76efd45e.56ab94"]]},{"id":"8fdea9df.6d265","type":"function","z":"137d5632.c1208a","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":710.8332061767578,"y":138.33321571350098,"wires":[["81582a14.88e3a8"]]},{"id":"71494a34.d1fabc","type":"mongodb in","z":"137d5632.c1208a","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":1617.8099060058594,"y":143.3101348876953,"wires":[["2ed90c0e.9dfedc"]]},{"id":"cc37876d.73f008","type":"function","z":"137d5632.c1208a","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1450.9760360717773,"y":144.97740173339844,"wires":[["71494a34.d1fabc"]]},{"id":"81582a14.88e3a8","type":"function","z":"137d5632.c1208a","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":944.3333892822266,"y":146.3333282470703,"wires":[["ea62a2d0.cc0158"]]},{"id":"ea62a2d0.cc0158","type":"mongodb in","z":"137d5632.c1208a","mongodb":"a6de67d4.7656","name":"nodes","collection":"nodes","operation":"find","x":1101.3332061767578,"y":146.33332777023315,"wires":[["73d6529b.db1194"]]},{"id":"73d6529b.db1194","type":"function","z":"137d5632.c1208a","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1252.8332138061523,"y":146.33348083496094,"wires":[["cc37876d.73f008"]]},{"id":"2ed90c0e.9dfedc","type":"function","z":"137d5632.c1208a","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1786.309585571289,"y":143.80981636047363,"wires":[["ed9aef2c.335158"]]},{"id":"ed9aef2c.335158","type":"function","z":"137d5632.c1208a","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=[];\n\nvar keys = Object.keys(mapped);\n\n\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<keys.length;j++)\n    {\n        if (mapped[j].node==nodes[i])\n        {\n             result.push(mapped[keys[j]]);\n        }\n    }\n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1941.8115997314453,"y":149.81004524230957,"wires":[[]]},{"id":"bbcd4bc7.c17c68","type":"subflow:137d5632.c1208a","z":"d9a0dcec.e2c7a8","name":"","x":484.50006103515625,"y":1882.666748046875,"wires":[["a8ac7bef.c133c"]]},{"id":"4194f039.d21318","type":"function","z":"3243bb64.94c7b4","name":"fastest_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nvar max=0;\n\nfor(var i =0; i<keys.length;i++)\n{\n  if(msg.payload[keys[i]].processing_speed>max) \n  {\n      result.push(msg.payload[keys[i]]);\n  }\n}\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":779.8414077758789,"y":175.85675430297852,"wires":[[]]},{"id":"9fb826a7.16657","type":"function","z":"e7e3b95a.29da88","name":"delay_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nvar min=6;\n\nfor(var i =0; i<keys.length;i++)\n{\n  if(msg.payload[keys[i]].network_delay<min) \n  {\n      result.push(msg.payload[keys[i]]);\n  }\n}\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":711.8414306640625,"y":257.8567714691162,"wires":[[]]},{"id":"365f735.ff2130c","type":"function","z":"a98f15d5.fefb9","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":725.841438293457,"y":143.85675430297852,"wires":[[]]},{"id":"1899782d.cee7e","type":"subflow:a98f15d5.fefb9","z":"d9a0dcec.e2c7a8","x":949.5000076293945,"y":1828.0000324249268,"wires":[["6a464e27.aad73"]]},{"id":"a8ac7bef.c133c","type":"subflow:3243bb64.94c7b4","z":"d9a0dcec.e2c7a8","x":716.5000305175781,"y":1878.666633605957,"wires":[["89be8829.f8018"]]},{"id":"89be8829.f8018","type":"subflow:e7e3b95a.29da88","z":"d9a0dcec.e2c7a8","x":804.5,"y":1755.333251953125,"wires":[["1899782d.cee7e"]]},{"id":"fab4346a.e7273","type":"function","z":"d9a0dcec.e2c7a8","name":"asfasf","func":"msg.task=\"task1\";\nmsg.payload=\"pay1\";\nreturn msg;","outputs":1,"noerr":0,"x":447.5,"y":2201,"wires":[["7e6da803.689818"]]},{"id":"7e6da803.689818","type":"function","z":"d9a0dcec.e2c7a8","name":"mas","func":"msg.task=msg.task+\"fsfs\";\nmsg.payload=msg.task;\nreturn msg;","outputs":1,"noerr":0,"x":583.5,"y":2190,"wires":[["a18d9099.6bcfd8"]]},{"id":"4bfbec15.d40354","type":"inject","z":"d9a0dcec.e2c7a8","name":"","topic":"","payload":"rpi1","payloadType":"str","repeat":"20","crontab":"","once":false,"x":216.5,"y":2274,"wires":[["8bb0d082.c9ee98"]]},{"id":"a18d9099.6bcfd8","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":724.5,"y":2191,"wires":[]},{"id":"82424b17.117788","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"tasks","collection":"tasks","operation":"find","x":534,"y":2315,"wires":[["53d5bde3.821d94"]]},{"id":"8bb0d082.c9ee98","type":"function","z":"d9a0dcec.e2c7a8","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',\"troponin_processing\");\nflow.set('nodename',msg.payload);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":383.1662902832031,"y":2284.6669921875,"wires":[[]]},{"id":"53d5bde3.821d94","type":"function","z":"d9a0dcec.e2c7a8","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":726.1666259765625,"y":2317.666748046875,"wires":[["8ae6c486.5ac89"]]},{"id":"8ae6c486.5ac89","type":"function","z":"d9a0dcec.e2c7a8","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"arch\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":886,"y":2282,"wires":[["1c470ba6.0fa354"]]},{"id":"1c470ba6.0fa354","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a6de67d4.7656","name":"nodes","collection":"nodes","operation":"find","x":1037,"y":2289,"wires":[["c418b721.1f52f8"]]},{"id":"c418b721.1f52f8","type":"function","z":"d9a0dcec.e2c7a8","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]].arch;\n}\n\nflow.set('nodearch',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1204,"y":2287,"wires":[["35c383cf.e978dc"]]},{"id":"35c383cf.e978dc","type":"function","z":"d9a0dcec.e2c7a8","name":"maker","func":"var arch=flow.get('nodearch');\nvar taski=flow.get('taskinfo');\n\nif (arch==\"x86\")\n{\nmsg.payload=\"sudo docker service create --name \"+ \"service1 --replicas=1 --publish \"+ taski.external_port+\":\"+taski.internal_port+\" \"+taski.image_x86;    \n}\nelse\n{\n    \nmsg.payload=\"sudo docker service create --name \"+ \"service1 --replicas=1 --publish \"+ taski.external_port+\":\"+taski.interrnal_port+\" \"+taski.image_arm;    \n    \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1361.5,"y":2283,"wires":[["e5379166.c16ed"]]},{"id":"e5379166.c16ed","type":"exec","z":"d9a0dcec.e2c7a8","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1514.5,"y":2273.5,"wires":[[],["6a62e42.5f4ef9c"],[]]},{"id":"6a62e42.5f4ef9c","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":1666.5,"y":2286,"wires":[]},{"id":"b5af032e.25d8","type":"mongodb in","z":"9e68f4fd.265c8","mongodb":"a6de67d4.7656","name":"tasks","collection":"tasks","operation":"find","x":411.833740234375,"y":145,"wires":[["5c31927f.5c23d4"]]},{"id":"1a180832.f096f","type":"function","z":"9e68f4fd.265c8","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":250,"y":150.6669921875,"wires":[["b5af032e.25d8"]]},{"id":"5c31927f.5c23d4","type":"function","z":"9e68f4fd.265c8","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":543,"y":242,"wires":[["d82d7ee3.11b898"]]},{"id":"d82d7ee3.11b898","type":"function","z":"9e68f4fd.265c8","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"arch\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":691.8333740234375,"y":180.333251953125,"wires":[["3a195eb2.40a49a"]]},{"id":"3a195eb2.40a49a","type":"mongodb in","z":"9e68f4fd.265c8","mongodb":"a6de67d4.7656","name":"nodes","collection":"nodes","operation":"find","x":837.8333740234375,"y":222.333251953125,"wires":[["f427de3c.cf6da"]]},{"id":"f427de3c.cf6da","type":"function","z":"9e68f4fd.265c8","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]].arch;\n}\n\nflow.set('nodearch',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1004.8333740234375,"y":220.333251953125,"wires":[["ec5c3b10.3f81c8"]]},{"id":"ec5c3b10.3f81c8","type":"function","z":"9e68f4fd.265c8","name":"maker","func":"var arch=flow.get('nodearch');\nvar taski=flow.get('taskinfo');\n\nif (arch==\"x86\")\n{\nmsg.payload=\"sudo docker service create --name \"+ taski.id + \" --replicas=1 --publish \"+ taski.external_port+\":\"+taski.internal_port+\" \"+taski.image_x86;    \n}\nelse\n{\n    \nmsg.payload=\"sudo docker service create --name \"+ taski.id + \"--replicas=1 --publish \"+ taski.external_port+\":\"+taski.interrnal_port+\" \"+taski.image_arm;    \n    \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1170,"y":221,"wires":[["7a540b87.8045a4"]]},{"id":"7a540b87.8045a4","type":"exec","z":"9e68f4fd.265c8","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1323,"y":211.5,"wires":[[],[],[]]},{"id":"374b9003.9372","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"f728d3f8.4e5e28","name":"","collection":"","operation":"find","x":1455.5,"y":2087,"wires":[[]]},{"id":"f6860eac.914cd","type":"inject","z":"d9a0dcec.e2c7a8","name":"","topic":"","payload":"rpi1","payloadType":"str","repeat":"20","crontab":"","once":false,"x":1087,"y":2377,"wires":[[]]},{"id":"9158a741.d534b","type":"subflow:9e68f4fd.265c8","z":"d9a0dcec.e2c7a8","name":"","x":448.5,"y":1996,"wires":[["5eebf7c1.286458"]]},{"id":"5eebf7c1.286458","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"payload","x":624.5,"y":2007,"wires":[]},{"id":"8bdc18e1.089778","type":"function","z":"d9a0dcec.e2c7a8","name":"","func":"sg.nodename=\"rpi1\";\nmsg.taskname=\"test_processing\";\nreturn msg;","outputs":1,"noerr":0,"x":286.5,"y":1972,"wires":[["9158a741.d534b"]]},{"id":"264f5bd0.48cc14","type":"bigssh","z":"d9a0dcec.e2c7a8","name":"","commandLine":"","commandArgs":"","minError":1,"minWarning":1,"noStdin":false,"format":"","payloadIsArg":false,"myssh":"d997ca32.8966f8","x":309.5,"y":2138.5,"wires":[[],[],[]]},{"id":"3351aa1f.3a5696","type":"inject","z":"d9a0dcec.e2c7a8","name":"","topic":"","payload":"docker run -d -p 80:80 vicviper/phparmnew","payloadType":"str","repeat":"10","crontab":"","once":false,"x":55,"y":2150,"wires":[[]]},{"id":"c50faf20.b257b8","type":"inject","z":"d9a0dcec.e2c7a8","name":"","topic":"","payload":" ssh pirate@10.79.4.153 'docker run -d -p 27017:27017 nonoroazoro/rpi-mongo'","payloadType":"str","repeat":"10","crontab":"","once":false,"x":179.5,"y":2545,"wires":[[]]},{"id":"1a5d8f0e.18e271","type":"exec","z":"d9a0dcec.e2c7a8","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":335.5,"y":2541.5,"wires":[[],["ab296e3b.379438"],[]]},{"id":"6a67ca1f.7dede4","type":"http request","z":"d9a0dcec.e2c7a8","name":"","method":"GET","ret":"txt","url":"http://127.0.0.1:81/troponin.php?troponin=0.00001","tls":"","x":375.5,"y":2670,"wires":[["e70ca808.eda1d8"]]},{"id":"4890180e.9e07f","type":"inject","z":"d9a0dcec.e2c7a8","name":"","topic":"","payload":" ssh pirate@10.79.4.153 'docker run -d -p 80:80 vicviper/phparmnew'","payloadType":"str","repeat":"10","crontab":"","once":false,"x":164.5,"y":2610,"wires":[[]]},{"id":"ab296e3b.379438","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":481.5,"y":2578,"wires":[]},{"id":"c5b5c95b.2dbfc","type":"inject","z":"d9a0dcec.e2c7a8","name":"","topic":"","payload":"ja","payloadType":"str","repeat":"10","crontab":"","once":false,"x":244,"y":2839,"wires":[[]]},{"id":"a21acc36.10883","type":"function","z":"d9a0dcec.e2c7a8","name":"query ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.payload; \nmsg.payload={ rid: patient};\nmsg.projection = {\"_id\":0, \"rid\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":178,"y":2736,"wires":[[]]},{"id":"c819aade.dedfa","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":709.5,"y":2749,"wires":[]},{"id":"d39ff829.823328","type":"function","z":"d9a0dcec.e2c7a8","name":"msaf","func":"msg.mongodb.hostname=\"10.79.4.159\"\nreturn msg;","outputs":1,"noerr":0,"x":262.5,"y":2931,"wires":[[]]},{"id":"3b80c93f.1d7aae","type":"function","z":"d9a0dcec.e2c7a8","name":"","func":"msg.payload=msg.mongodb.hostname;\nreturn msg;","outputs":1,"noerr":0,"x":648.5,"y":2850,"wires":[[]]},{"id":"d8221db7.bfed18","type":"inject","z":"d9a0dcec.e2c7a8","name":"","topic":"","payload":"http://127.0.0.1:80/troponin.php?troponin=0.02","payloadType":"str","repeat":"1","crontab":"","once":false,"x":175.5,"y":2677,"wires":[[]]},{"id":"e70ca808.eda1d8","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"payload","x":543.5,"y":2673,"wires":[]},{"id":"a57ac07f.356f1","type":"mongodb in","z":"3e1a1dce.aa9ae2","mongodb":"a6de67d4.7656","name":"tasks","collection":"tasks","operation":"find","x":313.833740234375,"y":141,"wires":[["e72fc5cf.3b2dd"]]},{"id":"4f986bac.7e0fbc","type":"function","z":"3e1a1dce.aa9ae2","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":152,"y":155.6669921875,"wires":[["a57ac07f.356f1"]]},{"id":"e72fc5cf.3b2dd","type":"function","z":"3e1a1dce.aa9ae2","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":445,"y":247,"wires":[["705a6de2.146824"]]},{"id":"705a6de2.146824","type":"function","z":"3e1a1dce.aa9ae2","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"arch\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":593.8333740234375,"y":185.333251953125,"wires":[["c08b1f17.48b46"]]},{"id":"c08b1f17.48b46","type":"mongodb in","z":"3e1a1dce.aa9ae2","mongodb":"a6de67d4.7656","name":"nodes","collection":"nodes","operation":"find","x":739.8333740234375,"y":227.333251953125,"wires":[["5fcc190c.daaf"]]},{"id":"5fcc190c.daaf","type":"function","z":"3e1a1dce.aa9ae2","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]].arch;\n}\n\nflow.set('nodearch',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":906.8333740234375,"y":225.333251953125,"wires":[["143e05bb.9069da"]]},{"id":"143e05bb.9069da","type":"function","z":"3e1a1dce.aa9ae2","name":"maker","func":"var arch=flow.get('nodearch');\nvar taski=flow.get('taskinfo');\n\nif (arch==\"x86\")\n{\nmsg.payload=\"docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+  \" \"+taski.image_x86;\n}\nelse\n{\n    \nmsg.payload=\"docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+  \" \"+taski.image_arm;\n    \n    \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1072,"y":226,"wires":[["f92ba1fd.daced"]]},{"id":"dbbde249.d8c978","type":"subflow:3e1a1dce.aa9ae2","z":"d9a0dcec.e2c7a8","name":"","x":467.5,"y":3124,"wires":[["14b71c59.e58edc"]]},{"id":"ce9063ca.8fcf6","type":"function","z":"d9a0dcec.e2c7a8","name":"tasker","func":"msg.taskname=flow.get('zadatak');\nmsg.nodename=msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":525.5,"y":3520,"wires":[["edd3f3d7.c85b"]]},{"id":"14b71c59.e58edc","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":661.5,"y":3073,"wires":[]},{"id":"f92ba1fd.daced","type":"exec","z":"3e1a1dce.aa9ae2","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1198.5,"y":278.5,"wires":[[],[],[]]},{"id":"a78d42e5.3fad78","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"beb02224.29b348","name":"","collection":"ecg","operation":"find","x":486.5,"y":2934,"wires":[[]]},{"id":"bc519db5.b945a","type":"http request","z":"e7ee6205.86ed88","name":"","method":"GET","ret":"txt","url":"","tls":"","x":649.0000152587891,"y":184,"wires":[[]]},{"id":"ee726cb7.73e97","type":"function","z":"e7ee6205.86ed88","name":"url_maker_troponin","func":"msg.limit = 5;\nmsg.skip = 0;\nvar troponin_value=msg.req.query.troponin; \nvar service_location=\"127.0.0.1:82/troponin.php\"\nmsg.url=service_location+\"?troponin=\"+troponin_value;\nreturn msg;\n","outputs":1,"noerr":0,"x":412.50000762939453,"y":173,"wires":[["bc519db5.b945a"]]},{"id":"ac4e3c53.a4ba3","type":"subflow:e7ee6205.86ed88","z":"d9a0dcec.e2c7a8","name":"","x":354.5,"y":1617,"wires":[["11144894.71bac7"]]},{"id":"6e17d6b8.292c38","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/troponin_proxy2","method":"get","swaggerDoc":"","x":105,"y":1608,"wires":[["ac4e3c53.a4ba3"]]},{"id":"11144894.71bac7","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":582,"y":1602,"wires":[]},{"id":"c4da57ae.f4f728","type":"http request","z":"e1cc44b0.94d07","name":"","method":"GET","ret":"txt","url":"","tls":"","x":586,"y":144,"wires":[[]]},{"id":"2beef833.d2fa5","type":"function","z":"e1cc44b0.94d07","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar ecg=msg.req.query.ecg;\nvar troponin=msg.req.query.troponin;\nvar service_location=\"127.0.0.1:83/test.php\";\nmsg.url=service_location+\"?ecg=\"+ecg+\"&troponin=\"+troponin;\nreturn msg;\n","outputs":1,"noerr":0,"x":383.5,"y":128,"wires":[["c4da57ae.f4f728"]]},{"id":"aa694614.8393f8","type":"subflow:e1cc44b0.94d07","z":"d9a0dcec.e2c7a8","name":"","x":317.5,"y":1667,"wires":[["b6bff6f.f581188"]]},{"id":"7c17357.971364c","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/test_proxy2","method":"get","swaggerDoc":"","x":126,"y":1667,"wires":[["aa694614.8393f8"]]},{"id":"b6bff6f.f581188","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":530.5,"y":1658,"wires":[]},{"id":"dcb151d0.624df","type":"inject","z":"d9a0dcec.e2c7a8","name":"","topic":"","payload":"","payloadType":"str","repeat":"10","crontab":"","once":false,"x":107.5,"y":1982,"wires":[[]]},{"id":"2f5c7529.09c52a","type":"http request","z":"7b8bf22.018668c","name":"","method":"GET","ret":"txt","url":"","tls":"","x":598,"y":69,"wires":[[]]},{"id":"fa18fd67.8d74d","type":"function","z":"7b8bf22.018668c","name":"url_maker_ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar ecg_value=msg.req.query.ecg; \nvar service_location=\"127.0.0.1:81/ecg.php\"\nmsg.url=service_location+\"?ecg=\"+ecg_value;\nreturn msg;\n","outputs":1,"noerr":0,"x":396.5,"y":66,"wires":[["2f5c7529.09c52a"]]},{"id":"ae87313a.c1d6e8","type":"subflow:7b8bf22.018668c","z":"d9a0dcec.e2c7a8","name":"","x":315.5,"y":1732,"wires":[["57199e3f.15e048"]]},{"id":"bd7359e9.2129c","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/ecg_proxy2","method":"get","swaggerDoc":"","x":129,"y":1735,"wires":[["ae87313a.c1d6e8"]]},{"id":"57199e3f.15e048","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":498.5,"y":1728,"wires":[]},{"id":"4f9adef.49d66a","type":"subflow:29cbf52c.3e9352","z":"d9a0dcec.e2c7a8","name":"","x":391.5,"y":3284,"wires":[[]]},{"id":"57185250.bc29dc","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":732.5,"y":3215,"wires":[]},{"id":"f8b67d12.9512f8","type":"mongodb in","z":"23596ae8.85d1ee","mongodb":"a6de67d4.7656","name":"tasks","collection":"tasks","operation":"find","x":280,"y":138,"wires":[["cb444678.030988"]]},{"id":"5a7e70bf.ac343","type":"function","z":"23596ae8.85d1ee","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":118.166259765625,"y":152.6669921875,"wires":[["f8b67d12.9512f8"]]},{"id":"cb444678.030988","type":"function","z":"23596ae8.85d1ee","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":411.166259765625,"y":244,"wires":[["cde077fb.55824"]]},{"id":"cde077fb.55824","type":"function","z":"23596ae8.85d1ee","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":559.9996337890625,"y":182.333251953125,"wires":[["252e8465.670bac"]]},{"id":"252e8465.670bac","type":"mongodb in","z":"23596ae8.85d1ee","mongodb":"a6de67d4.7656","name":"nodes","collection":"nodes","operation":"find","x":705.9996337890625,"y":224.333251953125,"wires":[["56888b17.61db9c"]]},{"id":"56888b17.61db9c","type":"function","z":"23596ae8.85d1ee","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":872.9996337890625,"y":222.333251953125,"wires":[["eda7e492.70f3c8"]]},{"id":"eda7e492.70f3c8","type":"function","z":"23596ae8.85d1ee","name":"maker","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif (nodei.arch==\"x86\")\n{\nmsg.payload=\"docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n}\nelse\n{\n    \nmsg.payload=\"docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n    \n    \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1038.166259765625,"y":223,"wires":[["e0815712.144868"]]},{"id":"edd3f3d7.c85b","type":"subflow:23596ae8.85d1ee","z":"d9a0dcec.e2c7a8","name":"","x":675.5,"y":3516,"wires":[["2e82fd4f.0320e2"]]},{"id":"c1c78260.463d08","type":"inject","z":"d9a0dcec.e2c7a8","name":"","topic":"","payload":"","payloadType":"str","repeat":"10","crontab":"","once":false,"x":130,"y":3781,"wires":[[]]},{"id":"9358e154.6928f8","type":"subflow:23596ae8.85d1ee","z":"d9a0dcec.e2c7a8","name":"","x":364.5,"y":3408,"wires":[["b69b2885.35edc8"]]},{"id":"b69b2885.35edc8","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":572.5,"y":3413,"wires":[]},{"id":"e0815712.144868","type":"exec","z":"23596ae8.85d1ee","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1182.5,"y":231.5,"wires":[[],[],[]]},{"id":"6740ddef.d6135c","type":"mongodb in","z":"1068371a.e9f4b9","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":369,"y":135,"wires":[["3b7bf162.bb3b1e"]]},{"id":"db1cb31d.0bda3","type":"function","z":"1068371a.e9f4b9","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload;\n\nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":138.16633224487305,"y":147.6670379638672,"wires":[["6740ddef.d6135c"]]},{"id":"3b7bf162.bb3b1e","type":"function","z":"1068371a.e9f4b9","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":585.1747817993164,"y":143.1900978088379,"wires":[[]]},{"id":"fde2f059.119fa8","type":"mongodb in","z":"cf2bb8ae.3f55c","mongodb":"a6de67d4.7656","name":"tasks","collection":"tasks","operation":"find","x":697,"y":155,"wires":[["ef18cdbf.1e9c88"]]},{"id":"b7c2eaa0.7f1548","type":"function","z":"cf2bb8ae.3f55c","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":438.16626358032227,"y":143.66701078414917,"wires":[["fde2f059.119fa8"]]},{"id":"ef18cdbf.1e9c88","type":"function","z":"cf2bb8ae.3f55c","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":992.1665496826172,"y":135.66655921936035,"wires":[["f60df191.278558"]]},{"id":"c677cef7.2cf628","type":"mongodb in","z":"cf2bb8ae.3f55c","mongodb":"a6de67d4.7656","name":"mappings","collection":"mappings","operation":"find","x":1899.1432495117188,"y":140.6434783935547,"wires":[["2d26d5d1.f77b7a"]]},{"id":"3683610d.f7a956","type":"function","z":"cf2bb8ae.3f55c","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1732.3093795776367,"y":142.3107452392578,"wires":[["c677cef7.2cf628"]]},{"id":"f60df191.278558","type":"function","z":"cf2bb8ae.3f55c","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par, arch:\"arm\"};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1225.666732788086,"y":143.6666717529297,"wires":[["34ff3450.d9bfc4"]]},{"id":"34ff3450.d9bfc4","type":"mongodb in","z":"cf2bb8ae.3f55c","mongodb":"a6de67d4.7656","name":"nodes","collection":"nodes","operation":"find","x":1382.6665496826172,"y":143.66667127609253,"wires":[["7864fb9b.2a6664"]]},{"id":"7864fb9b.2a6664","type":"function","z":"cf2bb8ae.3f55c","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1534.1665573120117,"y":143.6668243408203,"wires":[["3683610d.f7a956"]]},{"id":"2d26d5d1.f77b7a","type":"function","z":"cf2bb8ae.3f55c","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2067.6429290771484,"y":141.143159866333,"wires":[["702ccae3.2cded4"]]},{"id":"702ccae3.2cded4","type":"function","z":"cf2bb8ae.3f55c","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=[];\n\nvar keys = Object.keys(mapped);\n\n\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<keys.length;j++)\n    {\n        if (mapped[j].node==nodes[i])\n        {\n             result.push(mapped[keys[j]]);\n        }\n    }\n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2223.1449432373047,"y":147.14338874816895,"wires":[[]]},{"id":"9555c919.97664","type":"subflow:cf2bb8ae.3f55c","z":"d9a0dcec.e2c7a8","name":"","x":341.5,"y":3498,"wires":[["795b853f.62b1fc"]]},{"id":"2e82fd4f.0320e2","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":930.5,"y":3520,"wires":[]},{"id":"795b853f.62b1fc","type":"subflow:a98f15d5.fefb9","z":"d9a0dcec.e2c7a8","name":"","x":420.5,"y":3593,"wires":[["ce9063ca.8fcf6"]]},{"id":"ead864b3.c7a8e8","type":"function","z":"d9a0dcec.e2c7a8","name":"parameter_setting","func":"flow.set('zadatak',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":222.5,"y":3686,"wires":[["9555c919.97664"]]},{"id":"76a691ed.8213b8","type":"function","z":"827c720.ab2511","name":"tasker","func":"msg.taskname=flow.get('zadatak');\nmsg.nodename=msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":463,"y":51,"wires":[["ff802136.83e038"]]},{"id":"ff802136.83e038","type":"subflow:23596ae8.85d1ee","z":"827c720.ab2511","name":"","x":613,"y":47,"wires":[[]]},{"id":"8fd8810b.825988","type":"subflow:cf2bb8ae.3f55c","z":"827c720.ab2511","name":"","x":279,"y":29,"wires":[["e59c4a77.096488"]]},{"id":"e59c4a77.096488","type":"subflow:a98f15d5.fefb9","z":"827c720.ab2511","name":"","x":358,"y":124,"wires":[["76a691ed.8213b8"]]},{"id":"f6d5e8c6.fd344","type":"function","z":"827c720.ab2511","name":"parameter_setting","func":"msg.payload=\"test_processing\";\nflow.set('zadatak',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":160,"y":217,"wires":[["8fd8810b.825988"]]},{"id":"2ba0838e.5868f4","type":"subflow:827c720.ab2511","z":"d9a0dcec.e2c7a8","name":"","x":437.5,"y":3862,"wires":[["785f8caf.a71e2c"]]},{"id":"785f8caf.a71e2c","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":666.5,"y":3838,"wires":[]},{"id":"e4aa8fe3.03856","type":"subflow:23596ae8.85d1ee","z":"1b2d92a9.df8475","x":317.5,"y":177,"wires":[[]]},{"id":"82fa4643.5d975","type":"function","z":"1b2d92a9.df8475","name":"tasker","func":"msg.taskname=\"ecg_processing\";\nmsg.nodename=\"rpi2\";\nreturn msg;","outputs":1,"noerr":0,"x":165,"y":185,"wires":[["e4aa8fe3.03856"]]},{"id":"e68867bc.370ed","type":"inject","z":"d9a0dcec.e2c7a8","name":"","topic":"","payload":"patient1","payloadType":"str","repeat":"3","crontab":"","once":false,"x":96.5,"y":4655,"wires":[[]]},{"id":"4c2ca8b8.2697a","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":635.5,"y":3964,"wires":[]},{"id":"546c7ea.291ca","type":"subflow:1b2d92a9.df8475","z":"d9a0dcec.e2c7a8","name":"","x":427.5,"y":3966,"wires":[["4c2ca8b8.2697a"]]},{"id":"b080182f.f4b618","type":"subflow:23596ae8.85d1ee","z":"2548b4a6.0547d4","name":"","x":461,"y":124,"wires":[[]]},{"id":"7541aae2.1f15b4","type":"function","z":"2548b4a6.0547d4","name":"tasker","func":"msg.taskname=\"troponin_processing\";\nmsg.nodename=\"rpi3\";\nreturn msg;","outputs":1,"noerr":0,"x":301.5,"y":139,"wires":[["b080182f.f4b618"]]},{"id":"5bccbf61.03c7c8","type":"subflow:2548b4a6.0547d4","z":"d9a0dcec.e2c7a8","name":"","x":417.5,"y":4055,"wires":[["4f2955e.c42c12c"]]},{"id":"4f2955e.c42c12c","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":628.5,"y":4058,"wires":[]},{"id":"775983a7.4777a4","type":"subflow:23596ae8.85d1ee","z":"90618516.f631e8","name":"","x":453,"y":128,"wires":[[]]},{"id":"7120a3b8.cae804","type":"function","z":"90618516.f631e8","name":"tasker","func":"msg.taskname=\"mongo_ecg\";\nmsg.nodename=\"pc1\";\nreturn msg;","outputs":1,"noerr":0,"x":287.5,"y":149,"wires":[["775983a7.4777a4"]]},{"id":"c0a0916b.80741","type":"subflow:23596ae8.85d1ee","z":"350877f6.2a3f6","name":"","x":410,"y":113,"wires":[[]]},{"id":"96b81e86.0cfed8","type":"function","z":"350877f6.2a3f6","name":"tasker","func":"msg.taskname=\"mongo_troponin\";\nmsg.nodename=\"rpi3\";\nreturn msg;","outputs":1,"noerr":0,"x":236.5,"y":147,"wires":[["c0a0916b.80741"]]},{"id":"7bec0d76.dff00c","type":"subflow:90618516.f631e8","z":"d9a0dcec.e2c7a8","name":"","x":411.5,"y":4130,"wires":[["67352c46.791c34"]]},{"id":"9842f51e.48d0c8","type":"subflow:350877f6.2a3f6","z":"d9a0dcec.e2c7a8","x":417.5,"y":4212,"wires":[[]]},{"id":"67352c46.791c34","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":645.5,"y":4132,"wires":[]},{"id":"7007b132.387678","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"7cb0b0ed.03a338","name":"","collection":"ecg","operation":"find","x":193.5,"y":3974,"wires":[[]]},{"id":"7c0569b2.d97ad8","type":"subflow:e7ee6205.86ed88","z":"d9a0dcec.e2c7a8","name":"","x":444,"y":4314,"wires":[["bb461c8f.8cbe18"]]},{"id":"4fb2e6f3.1444f","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/troponin_proxy3","method":"get","swaggerDoc":"","x":194.5,"y":4305,"wires":[["7c0569b2.d97ad8"]]},{"id":"bb461c8f.8cbe18","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":671.5,"y":4299,"wires":[]},{"id":"ed88314b.b67058","type":"subflow:e1cc44b0.94d07","z":"d9a0dcec.e2c7a8","name":"","x":407,"y":4364,"wires":[["73703f26.133108"]]},{"id":"fa8bdd50.982ce","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/test_proxy3","method":"get","swaggerDoc":"","x":215.5,"y":4364,"wires":[["ed88314b.b67058"]]},{"id":"73703f26.133108","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":620,"y":4355,"wires":[]},{"id":"cfe05c7a.9f3438","type":"subflow:7b8bf22.018668c","z":"d9a0dcec.e2c7a8","name":"","x":405,"y":4429,"wires":[["db068b8d.d106d"]]},{"id":"e8f53b06.cfe1f8","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/ecg_proxy3","method":"get","swaggerDoc":"","x":218.5,"y":4432,"wires":[["cfe05c7a.9f3438"]]},{"id":"db068b8d.d106d","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":588,"y":4425,"wires":[]},{"id":"339570da.f018f8","type":"http request","z":"343d6003.5a8bc8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":492,"y":143,"wires":[[]]},{"id":"1106a37.db8a75d","type":"function","z":"343d6003.5a8bc8","name":"url_maker_troponin","func":"msg.limit = 5;\nmsg.skip = 0;\nvar troponin_value=msg.troponin; \nvar service_location=\"127.0.0.1:82/troponin.php\"\nmsg.url=service_location+\"?troponin=\"+troponin_value;\nreturn msg;\n","outputs":1,"noerr":0,"x":255.49999237060547,"y":132,"wires":[["339570da.f018f8"]]},{"id":"7a7487c7.9d9c6","type":"http request","z":"ec360aba.4d64d","name":"","method":"GET","ret":"txt","url":"","tls":"","x":490,"y":202,"wires":[[]]},{"id":"ed57d373.c85c8","type":"function","z":"ec360aba.4d64d","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar ecg=msg.ec;\nvar troponin=msg.tr;\nvar service_location=\"127.0.0.1:83/test.php\";\nmsg.url=service_location+\"?ecg=\"+ecg+\"&troponin=\"+troponin;\nreturn msg;\n","outputs":1,"noerr":0,"x":278.5,"y":200,"wires":[["7a7487c7.9d9c6"]]},{"id":"328c1771.b5b3","type":"http request","z":"31668910.58a7e6","name":"","method":"GET","ret":"txt","url":"","tls":"","x":464,"y":179,"wires":[[]]},{"id":"7a1cac3a.beb5bc","type":"function","z":"31668910.58a7e6","name":"url_maker_ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar ecg_value=msg.ecg; \nvar service_location=\"127.0.0.1:81/ecg.php\"\nmsg.url=service_location+\"?ecg=\"+ecg_value;\nreturn msg;\n","outputs":1,"noerr":0,"x":262.5,"y":176,"wires":[["328c1771.b5b3"]]},{"id":"f2d2be0a.4d017","type":"subflow:343d6003.5a8bc8","z":"d9a0dcec.e2c7a8","x":374.5,"y":4514,"wires":[["9d10190d.aea13"]]},{"id":"9d10190d.aea13","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":530.5,"y":4520,"wires":[]},{"id":"8f90901b.8b96a","type":"function","z":"d9a0dcec.e2c7a8","name":"troponin_input","func":"msg.troponin=0.1\nreturn msg;","outputs":1,"noerr":0,"x":168.5,"y":4548,"wires":[["f2d2be0a.4d017"]]},{"id":"59172dd9.377474","type":"subflow:ec360aba.4d64d","z":"d9a0dcec.e2c7a8","x":796.5,"y":4391,"wires":[["25b7efc2.e04a78"]]},{"id":"25b7efc2.e04a78","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":943.5,"y":4401,"wires":[]},{"id":"16f5b98c.d1b436","type":"function","z":"d9a0dcec.e2c7a8","name":"test_input","func":"msg.ec=0;\nmsg.tr=1;\nreturn msg;","outputs":1,"noerr":0,"x":721.5,"y":4463,"wires":[["59172dd9.377474"]]},{"id":"5290d7e9.755df8","type":"subflow:31668910.58a7e6","z":"d9a0dcec.e2c7a8","x":904.5,"y":4521,"wires":[["e5df7733.a611e"]]},{"id":"29cff1ae.620aee","type":"function","z":"d9a0dcec.e2c7a8","name":"ecg_input","func":"msg.ecg=\"slika.jpg\";\nreturn msg;","outputs":1,"noerr":0,"x":758.5,"y":4523,"wires":[["5290d7e9.755df8"]]},{"id":"e5df7733.a611e","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":1042.5,"y":4516,"wires":[]},{"id":"b9c34319.d7b1c","type":"subflow:343d6003.5a8bc8","z":"d9a0dcec.e2c7a8","name":"","x":660.5,"y":4744,"wires":[["63f23f64.6656f8"]]},{"id":"eaa76ce7.73755","type":"subflow:31668910.58a7e6","z":"d9a0dcec.e2c7a8","name":"","x":1608.5,"y":4901,"wires":[["b7a6cb2e.fc8ba8"]]},{"id":"b7a6cb2e.fc8ba8","type":"function","z":"d9a0dcec.e2c7a8","name":"ecg_output","func":"flow.set('ec',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":1662.5,"y":4722,"wires":[[]]},{"id":"63f23f64.6656f8","type":"function","z":"d9a0dcec.e2c7a8","name":"troponin_output","func":"flow.set('tr',msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":837.5,"y":4845,"wires":[["8f8497b4.35962"]]},{"id":"559fe37d.23fc34","type":"subflow:ec360aba.4d64d","z":"d9a0dcec.e2c7a8","name":"","x":1968.5,"y":4749,"wires":[["6b6d5590.c99984"]]},{"id":"a4945c9c.40e588","type":"function","z":"d9a0dcec.e2c7a8","name":"test_input","func":"msg.tr=flow.get(\"tr\");\nmsg.ec=flow.get(\"ec\");\nreturn msg;","outputs":1,"noerr":0,"x":1819.5,"y":4686,"wires":[["559fe37d.23fc34"]]},{"id":"88709965.d3955","type":"function","z":"d9a0dcec.e2c7a8","name":"query_troponin","func":"msg.limit = 5;\nmsg.skip = 0;\n\nvar patient=msg.req.query.patient; \n\nflow.set('patient',patient);\nmsg.payload={ patient: patient};\nmsg.projection = {\"_id\":0, \"value\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":272.5,"y":4860,"wires":[["a46532e3.aa394"]]},{"id":"a46532e3.aa394","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"a2bac3b.78745c","name":"","collection":"troponin","operation":"find","x":389.5,"y":4691,"wires":[["d11fce2a.961188"]]},{"id":"d11fce2a.961188","type":"function","z":"d9a0dcec.e2c7a8","name":"trop_results","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].value);\n}\nmsg.payload=result[0];\nmsg.troponin=result[0];\nreturn msg;","outputs":1,"noerr":0,"x":575.5,"y":4876,"wires":[["b9c34319.d7b1c"]]},{"id":"8f8497b4.35962","type":"function","z":"d9a0dcec.e2c7a8","name":"query_ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=flow.get('patient');\nmsg.payload={ patient: patient};\nmsg.projection = {\"_id\":0, \"image\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":968,"y":4728,"wires":[["fdcaf725.1848b"]]},{"id":"fdcaf725.1848b","type":"mongodb in","z":"d9a0dcec.e2c7a8","mongodb":"f07a7535.b5f8f","name":"","collection":"ecg","operation":"find","x":1159.5,"y":4815,"wires":[["53bac9d9.92278"]]},{"id":"53bac9d9.92278","type":"function","z":"d9a0dcec.e2c7a8","name":"ecg_results","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].image);\n}\n\n\nmsg.ecg=result[0];\nmsg.payload=msg.ecg;\nreturn msg;","outputs":1,"noerr":0,"x":1360,"y":4713,"wires":[["493bd0ee.a74308"]]},{"id":"6b6d5590.c99984","type":"debug","z":"d9a0dcec.e2c7a8","name":"","active":true,"console":"false","complete":"false","x":2202.5,"y":4747,"wires":[]},{"id":"1f0cb82c.52209","type":"http in","z":"d9a0dcec.e2c7a8","name":"","url":"/patient","method":"get","swaggerDoc":"","x":76.5,"y":4910,"wires":[["88709965.d3955"]]},{"id":"493bd0ee.a74308","type":"http response","z":"d9a0dcec.e2c7a8","name":"","x":1558.5,"y":4671,"wires":[]},{"id":"8f35e888.0f7b98","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/infraction_test3","method":"get","swaggerDoc":"","x":162.66665649414062,"y":246.66650390625,"wires":[["a1659f39.2d5e38"]]},{"id":"65506841.e9ece","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"7cb0b0ed.03a338","name":"","collection":"ecg","operation":"find","x":770.1670227050781,"y":287.6671600341797,"wires":[["5965e6b1.23abf"]]},{"id":"a1659f39.2d5e38","type":"function","z":"81cc33f0.fc5b8","name":"query ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.req.query.patient_id; \nmsg.payload={ patient_id: patient};\nmsg.projection = {\"_id\":0, \"anomaly\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":489.6663475036621,"y":229.6669807434082,"wires":[["65506841.e9ece"]]},{"id":"5965e6b1.23abf","type":"function","z":"81cc33f0.fc5b8","name":"processing1","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].anomaly);\n}\nmsg.payload=result[0];\nflow.set('db1',result[0]);\nreturn msg;\n","outputs":1,"noerr":0,"x":1019.6667709350586,"y":204.6672396659851,"wires":[["1131cb7d.e585dd"]]},{"id":"1131cb7d.e585dd","type":"function","z":"81cc33f0.fc5b8","name":"query troponin","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.req.query.patient_id; \n\nmsg.payload={ patient_id: patient};\nmsg.projection = {\"_id\":0, \"increased\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1235.1664581298828,"y":331.0002555847168,"wires":[["f794aa0.726b8d8"]]},{"id":"5f7bf043.1686b","type":"function","z":"81cc33f0.fc5b8","name":"processing2","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].increased);\n}\n\n\nmsg.payload=flow.get('db1')*result[0];\nflow.set('outcome',msg.payload);\nreturn msg;\n","outputs":1,"noerr":0,"x":1757.3336486816406,"y":121,"wires":[["51fae9af.a6165"]]},{"id":"90e5f37c.cad238","type":"http response","z":"81cc33f0.fc5b8","name":"","x":2459.8336486816406,"y":213.000244140625,"wires":[]},{"id":"51fae9af.a6165","type":"function","z":"81cc33f0.fc5b8","name":"insert outcome","func":"var outcome=flow.get('outcome');\nvar patient=msg.req.query.patient_id; \nmsg.topic=\"INSERT INTO result values('\"+patient+\"',\"+outcome+\") \";\nreturn msg;","outputs":1,"noerr":0,"x":1999.3336486816406,"y":213,"wires":[["9133425a.8a87f"]]},{"id":"40c6cd6.1e40bb4","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/infraction_test4","method":"get","swaggerDoc":"","x":140.33335876464844,"y":488.3331604003906,"wires":[["c389d478.90cb4"]]},{"id":"e7636eda.ca79d8","type":"function","z":"81cc33f0.fc5b8","name":"query troponin","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.req.query.patient_id; \n\nmsg.payload={ patient_id: patient};\nmsg.projection = {\"_id\":0, \"increased\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1367.8331756591797,"y":548.6669006347656,"wires":[["b2671e86.d11608"]]},{"id":"4afcdd56.47ec3c","type":"function","z":"81cc33f0.fc5b8","name":"processing2","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].increased);\n}\n\n\nmsg.payload=flow.get('db1')*result[0];\nflow.set('outcome',msg.payload);\nreturn msg;\n","outputs":1,"noerr":0,"x":1965.0004425048828,"y":513.6666831970215,"wires":[["d512ac8c.77f61"]]},{"id":"eca91c44.70f1c","type":"http response","z":"81cc33f0.fc5b8","name":"","x":2394.500312805176,"y":463.66688537597656,"wires":[]},{"id":"d512ac8c.77f61","type":"function","z":"81cc33f0.fc5b8","name":"insert outcome","func":"var outcome=flow.get('outcome');\nvar patient=msg.req.query.patient_id; \nmsg.topic=\"INSERT INTO result values('\"+patient+\"',\"+outcome+\") \";\nreturn msg;","outputs":1,"noerr":0,"x":2136.0004348754883,"y":474.6666522026062,"wires":[["f275680b.9b0fd8"]]},{"id":"9133425a.8a87f","type":"mysql","z":"81cc33f0.fc5b8","mydb":"dc4fff69.708838","name":"","x":2272.6666564941406,"y":178.66650390625,"wires":[["90e5f37c.cad238"]]},{"id":"f275680b.9b0fd8","type":"mysql","z":"81cc33f0.fc5b8","mydb":"609b94d8.9c989c","name":"","x":2285.667060852051,"y":399.6665439605713,"wires":[["eca91c44.70f1c"]]},{"id":"f794aa0.726b8d8","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"7cb0b0ed.03a338","name":"","collection":"troponin","operation":"find","x":1485.1666564941406,"y":216.66650390625,"wires":[["5f7bf043.1686b"]]},{"id":"b2671e86.d11608","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"","collection":"troponin","operation":"find","x":1662.6666793823242,"y":522.6665325164795,"wires":[["4afcdd56.47ec3c"]]},{"id":"33b8aa9c.20cdc6","type":"function","z":"81cc33f0.fc5b8","name":"processing1","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].anomaly);\n}\nmsg.payload=result[0];\nflow.set('db1',result[0]);\nreturn msg;\n","outputs":1,"noerr":0,"x":1134.333293914795,"y":539.3338890075684,"wires":[["e7636eda.ca79d8"]]},{"id":"c6fa61ae.eaaa3","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"","collection":"ecg","operation":"find","x":645.1666870117188,"y":483.6665344238281,"wires":[["33b8aa9c.20cdc6"]]},{"id":"c389d478.90cb4","type":"function","z":"81cc33f0.fc5b8","name":"query ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.req.query.patient_id; \nmsg.payload={ patient_id: patient};\nmsg.projection = {\"_id\":0, \"anomaly\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":368.3330383300781,"y":487.3336486816406,"wires":[["c6fa61ae.eaaa3"]]},{"id":"26100738.49f278","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/first_selector","method":"get","swaggerDoc":"","x":183.00003051757812,"y":725.9999761581421,"wires":[["1697a1cf.3a280e"]]},{"id":"219a6ecc.7a937a","type":"http response","z":"81cc33f0.fc5b8","name":"","x":1115.1677570343018,"y":722.3337478637695,"wires":[]},{"id":"9f9b4359.202ff8","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":619.8333740234375,"y":693.3334350585938,"wires":[["a7766c2d.d8f358"]]},{"id":"1697a1cf.3a280e","type":"function","z":"81cc33f0.fc5b8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":402.9997215270996,"y":725.0004653930664,"wires":[["9f9b4359.202ff8"]]},{"id":"a7766c2d.d8f358","type":"function","z":"81cc33f0.fc5b8","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":850.008171081543,"y":720.5235252380371,"wires":[["219a6ecc.7a937a"]]},{"id":"77a376cd.6bd11","type":"http request","z":"81cc33f0.fc5b8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":684.5000228881836,"y":1291.0002069473267,"wires":[["77c82a6e.5db4f4"]]},{"id":"dc5f6198.4f868","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/troponin_proxy","method":"get","swaggerDoc":"","x":181.50000762939453,"y":1293.0001649856567,"wires":[["c706e056.a8996"]]},{"id":"c706e056.a8996","type":"function","z":"81cc33f0.fc5b8","name":"url_maker_troponin","func":"msg.limit = 5;\nmsg.skip = 0;\nvar troponin_value=msg.req.query.troponin; \nvar service_location=\"192.168.99.100/troponin.php\"\nmsg.url=service_location+\"?troponin=\"+troponin_value;\nreturn msg;\n","outputs":1,"noerr":0,"x":448.00001525878906,"y":1280.0002069473267,"wires":[["77a376cd.6bd11"]]},{"id":"aea94e36.079008","type":"http request","z":"81cc33f0.fc5b8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":626,"y":1361.0001220703125,"wires":[["8a12fbc7.9e4b6"]]},{"id":"f9ef2866.3a3a5","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/ecg_proxy","method":"get","swaggerDoc":"","x":178,"y":1369.0001220703125,"wires":[["3832c553.76cde2"]]},{"id":"3832c553.76cde2","type":"function","z":"81cc33f0.fc5b8","name":"url_maker_ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar ecg_value=msg.req.query.ecg; \nvar service_location=\"192.168.99.100/ecg.php\"\nmsg.url=service_location+\"?ecg=\"+ecg_value;\nreturn msg;\n","outputs":1,"noerr":0,"x":424.5,"y":1358.0001220703125,"wires":[["aea94e36.079008"]]},{"id":"8a12fbc7.9e4b6","type":"http response","z":"81cc33f0.fc5b8","name":"","x":791.5,"y":1367.0001220703125,"wires":[]},{"id":"77c82a6e.5db4f4","type":"http response","z":"81cc33f0.fc5b8","name":"","x":846.5000267028809,"y":1291.000147819519,"wires":[]},{"id":"fa499f40.481398","type":"http request","z":"81cc33f0.fc5b8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":634.0000076293945,"y":1436.0001573562622,"wires":[["c490180b.66bcc"]]},{"id":"3b0f36bb.6beada","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/test_proxy","method":"get","swaggerDoc":"","x":180.00000762939453,"y":1474.0001573562622,"wires":[["9ed4b274.046748"]]},{"id":"9ed4b274.046748","type":"function","z":"81cc33f0.fc5b8","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar ecg=msg.req.query.ecg;\nvar troponin=msg.req.query.troponin;\nvar service_location=\"192.168.99.100/test.php\";\nmsg.url=service_location+\"?ecg=\"+ecg+\"&troponin=\"+troponin;\nreturn msg;\n","outputs":1,"noerr":0,"x":431.50000762939453,"y":1420.0001573562622,"wires":[["fa499f40.481398"]]},{"id":"c490180b.66bcc","type":"http response","z":"81cc33f0.fc5b8","name":"","x":804.5000076293945,"y":1435.0001573562622,"wires":[]},{"id":"5ed94a8a.37a564","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/speed_selector","method":"get","swaggerDoc":"","x":189.5078125,"y":797.5234375,"wires":[["d20fd66.c0b9928"]]},{"id":"96547a8b.1d8ec8","type":"http response","z":"81cc33f0.fc5b8","name":"","x":1111.6755390167236,"y":793.8572092056274,"wires":[]},{"id":"fb2dd71b.a6652","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":630.3411712646484,"y":783.8568887710571,"wires":[["65029412.dfd8bc"]]},{"id":"d20fd66.c0b9928","type":"function","z":"81cc33f0.fc5b8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":399.5075035095215,"y":796.5239267349243,"wires":[["fb2dd71b.a6652"]]},{"id":"65029412.dfd8bc","type":"function","z":"81cc33f0.fc5b8","name":"fastest_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nvar max=0;\n\nfor(var i =0; i<keys.length;i++)\n{\n  if(msg.payload[keys[i]].processing_speed>max) \n  {\n      result=msg.payload[keys[i]].node;\n  }\n}\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":856.5159530639648,"y":792.046986579895,"wires":[["96547a8b.1d8ec8"]]},{"id":"2cb143e1.90727c","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/delay_selector","method":"get","swaggerDoc":"","x":181.5078125,"y":859.5234375,"wires":[["f4eeb97f.ae497"]]},{"id":"ef2c1ba3.9fbd88","type":"http response","z":"81cc33f0.fc5b8","name":"","x":1113.6755390167236,"y":855.8572092056274,"wires":[]},{"id":"b2cc5012.7a6388","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":632.3411712646484,"y":845.8568887710571,"wires":[["2b478442.e2af94"]]},{"id":"f4eeb97f.ae497","type":"function","z":"81cc33f0.fc5b8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":401.5075035095215,"y":858.5239267349243,"wires":[["b2cc5012.7a6388"]]},{"id":"2b478442.e2af94","type":"function","z":"81cc33f0.fc5b8","name":"delay_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nvar min=6;\n\nfor(var i =0; i<keys.length;i++)\n{\n  if(msg.payload[keys[i]].network_delay<min) \n  {\n      result=msg.payload[keys[i]].node;\n  }\n}\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":848.5159530639648,"y":854.046986579895,"wires":[["ef2c1ba3.9fbd88"]]},{"id":"7323e4be.80742c","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/location_selector1","method":"get","swaggerDoc":"","x":189.5078125,"y":935.0234174728394,"wires":[["9dac2c5a.ce314"]]},{"id":"674df754.9574b8","type":"http response","z":"81cc33f0.fc5b8","name":"","x":1143.6755657196045,"y":931.3571891784668,"wires":[]},{"id":"557d7018.4782c8","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":631.3412322998047,"y":947.3567924499512,"wires":[["3474ee76.ab6692"]]},{"id":"9dac2c5a.ce314","type":"function","z":"81cc33f0.fc5b8","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":405.5075225830078,"y":935.0238447189331,"wires":[["557d7018.4782c8"]]},{"id":"3474ee76.ab6692","type":"function","z":"81cc33f0.fc5b8","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\nmsg.payload=result.execution;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":859.5078353881836,"y":931.0234189033508,"wires":[["674df754.9574b8"]]},{"id":"e2e9687b.72733","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/location_selector2","method":"get","swaggerDoc":"","x":175.5078125,"y":1008.0234260559082,"wires":[["47d8eccd.4181d4"]]},{"id":"6d93d649.61782","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":645.3412933349609,"y":1031.3568229675293,"wires":[["22eb8528.7ce232"]]},{"id":"47d8eccd.4181d4","type":"function","z":"81cc33f0.fc5b8","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":390.5075225830078,"y":996.0238037109375,"wires":[["6d93d649.61782"]]},{"id":"22eb8528.7ce232","type":"function","z":"81cc33f0.fc5b8","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":857.5078735351562,"y":1019.0233879089355,"wires":[["34c79274.d592b6"]]},{"id":"34c79274.d592b6","type":"function","z":"81cc33f0.fc5b8","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1078.0079345703125,"y":1015.0234489440918,"wires":[["911c9251.da874"]]},{"id":"a28f84b1.47bd1","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":1788.0080108642578,"y":1087.0237560272217,"wires":[["f737310a.763df8"]]},{"id":"78b32b03.edbe34","type":"function","z":"81cc33f0.fc5b8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1621.1741409301758,"y":1088.6910228729248,"wires":[["a28f84b1.47bd1"]]},{"id":"911c9251.da874","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1260.0078468322754,"y":1018.0234184265137,"wires":[["b05f2d07.0b4df8"]]},{"id":"9c0f3ff4.5f5048","type":"http response","z":"81cc33f0.fc5b8","name":"","x":1608.0002346038818,"y":1021.9141960144043,"wires":[]},{"id":"b05f2d07.0b4df8","type":"function","z":"81cc33f0.fc5b8","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=flow.get('nodes');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1415.507984161377,"y":1009.0233864784241,"wires":[["9c0f3ff4.5f5048"]]},{"id":"19e4da51.b70fce","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/location_selector","method":"get","swaggerDoc":"","x":170.03125,"y":1095.0469188690186,"wires":[["6fe81b77.ac207c"]]},{"id":"f0c6d8d0.069bc","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":668.8647308349609,"y":1094.380271911621,"wires":[["e4d8a3c4.7b1508"]]},{"id":"6fe81b77.ac207c","type":"function","z":"81cc33f0.fc5b8","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":409.03099060058594,"y":1085.047285079956,"wires":[["f0c6d8d0.069bc"]]},{"id":"e4d8a3c4.7b1508","type":"function","z":"81cc33f0.fc5b8","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":881.0313110351562,"y":1082.0468368530273,"wires":[["c39f10ad.7643a"]]},{"id":"c39f10ad.7643a","type":"function","z":"81cc33f0.fc5b8","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1114.531494140625,"y":1090.0469493865967,"wires":[["82b6c3e2.60c978"]]},{"id":"82b6c3e2.60c978","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1271.5313110351562,"y":1090.0469489097595,"wires":[["682334fa.ae367c"]]},{"id":"682334fa.ae367c","type":"function","z":"81cc33f0.fc5b8","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1423.0313186645508,"y":1090.0471019744873,"wires":[["78b32b03.edbe34"]]},{"id":"f737310a.763df8","type":"function","z":"81cc33f0.fc5b8","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1956.5076904296875,"y":1087.5234375,"wires":[["122ce69a.986661"]]},{"id":"122ce69a.986661","type":"function","z":"81cc33f0.fc5b8","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=\" \";\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<mapped.length;j++)\n    {\n        if (mapped[j]==nodes[i])\n        {\n            result=mapped[j];\n        }\n    }\n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2112.0097045898438,"y":1093.523666381836,"wires":[["afcb3db3.ec536"]]},{"id":"afcb3db3.ec536","type":"http response","z":"81cc33f0.fc5b8","name":"","x":2263,"y":1099.390625,"wires":[]},{"id":"7438a39d.d4333c","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":1723.9767684936523,"y":1234.046932220459,"wires":[["33fab016.9945e"]]},{"id":"9d336dcd.677f58","type":"function","z":"81cc33f0.fc5b8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1566.1428909301758,"y":1195.7141418457031,"wires":[["7438a39d.d4333c"]]},{"id":"96674a01.27dc8","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/location_selector3","method":"get","swaggerDoc":"","x":105,"y":1202.0700378417969,"wires":[["cd5602f3.6ddcd"]]},{"id":"62fc894e.c96208","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":623.8334808349609,"y":1201.4033908843994,"wires":[["30e9ee22.50882a"]]},{"id":"cd5602f3.6ddcd","type":"function","z":"81cc33f0.fc5b8","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":363.99974060058594,"y":1192.0704040527344,"wires":[["62fc894e.c96208"]]},{"id":"30e9ee22.50882a","type":"function","z":"81cc33f0.fc5b8","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":836.0000610351562,"y":1189.0699558258057,"wires":[["e6a54cd6.60d6a"]]},{"id":"e6a54cd6.60d6a","type":"function","z":"81cc33f0.fc5b8","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1069.500244140625,"y":1197.070068359375,"wires":[["c5317256.ebc2a"]]},{"id":"c5317256.ebc2a","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1226.5000610351562,"y":1197.0700678825378,"wires":[["6f76382.2f54b48"]]},{"id":"6f76382.2f54b48","type":"function","z":"81cc33f0.fc5b8","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1368.0000686645508,"y":1197.0702209472656,"wires":[["9d336dcd.677f58"]]},{"id":"33fab016.9945e","type":"function","z":"81cc33f0.fc5b8","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1928.4764099121094,"y":1201.5466270446777,"wires":[["ddb30d2e.16ec"]]},{"id":"ddb30d2e.16ec","type":"http response","z":"81cc33f0.fc5b8","name":"","x":2217.96875,"y":1206.4137439727783,"wires":[]},{"id":"5f90da7f.ae1fbc","type":"http in","z":"907219de.a6c27","name":"","url":"/first_selector","method":"get","swaggerDoc":"","x":185.5078125,"y":127.5390625,"wires":[["b26255db.6a54f"]]},{"id":"a96d1e5d.04734","type":"http response","z":"907219de.a6c27","name":"","x":1117.6755390167236,"y":123.87283420562744,"wires":[]},{"id":"875236e3.77ae4","type":"mongodb in","z":"907219de.a6c27","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":636.3411712646484,"y":113.87251377105713,"wires":[["9c37fe90.5545"]]},{"id":"b26255db.6a54f","type":"function","z":"907219de.a6c27","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.req.query.task; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":405.5075225830078,"y":118.53955554962158,"wires":[["875236e3.77ae4"]]},{"id":"9c37fe90.5545","type":"function","z":"907219de.a6c27","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":878.5159797668457,"y":122.06261444091797,"wires":[["a96d1e5d.04734"]]},{"id":"55177f65.ab32b8","type":"mongodb in","z":"76d94169.84f338","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":1722.9767608642578,"y":80.88888549804688,"wires":[["33b91e64.99c452"]]},{"id":"f155fd13.484a08","type":"function","z":"76d94169.84f338","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1556.1428909301758,"y":82.55615234375,"wires":[["55177f65.ab32b8"]]},{"id":"caf75dba.a90ab","type":"mongodb in","z":"76d94169.84f338","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":520.8335113525391,"y":95.24540710449219,"wires":[["b8a9808c.30592"]]},{"id":"601a8d88.31e464","type":"function","z":"76d94169.84f338","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":261.9997749328613,"y":83.91241788864136,"wires":[["caf75dba.a90ab"]]},{"id":"b8a9808c.30592","type":"function","z":"76d94169.84f338","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":816.0000610351562,"y":75.91196632385254,"wires":[["20243d9f.f780ca"]]},{"id":"20243d9f.f780ca","type":"function","z":"76d94169.84f338","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1049.500244140625,"y":83.91207885742188,"wires":[["227bd1c4.884e06"]]},{"id":"227bd1c4.884e06","type":"mongodb in","z":"76d94169.84f338","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1206.5000610351562,"y":83.91207838058472,"wires":[["33dec0f1.f440e8"]]},{"id":"33dec0f1.f440e8","type":"function","z":"76d94169.84f338","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1358.0000686645508,"y":83.9122314453125,"wires":[["f155fd13.484a08"]]},{"id":"33b91e64.99c452","type":"function","z":"76d94169.84f338","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1891.4764404296875,"y":81.3885669708252,"wires":[["791aa3dd.ac34dc"]]},{"id":"791aa3dd.ac34dc","type":"function","z":"76d94169.84f338","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=\" \";\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<mapped.length;j++)\n    {\n        if (mapped[j]==nodes[i])\n        {\n            result=mapped[j];\n        }\n    }\n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2046.9784545898438,"y":87.38879585266113,"wires":[[]]},{"id":"16895a12.707ca6","type":"inject","z":"81cc33f0.fc5b8","name":"","topic":"","payload":"troponin_processing","payloadType":"str","repeat":"10","crontab":"","once":true,"x":153.8333740234375,"y":1866.1741943359375,"wires":[[]]},{"id":"89b5a910.53c208","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":1004.2742614746094,"y":1923.2641868591309,"wires":[]},{"id":"5b9126c6.430068","type":"subflow:76d94169.84f338","z":"81cc33f0.fc5b8","x":413.8367919921875,"y":1534.288330078125,"wires":[[]]},{"id":"8d9d293d.0969b","type":"mongodb in","z":"c54a6289.8d3238","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":594.5000152587891,"y":146.00010776519775,"wires":[["38858a75.8c3b3e"]]},{"id":"a6b4816b.334878","type":"function","z":"c54a6289.8d3238","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload;\n\nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":363.6663475036621,"y":158.66714572906494,"wires":[["8d9d293d.0969b"]]},{"id":"38858a75.8c3b3e","type":"function","z":"c54a6289.8d3238","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nmsg.nodename=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":810.6747970581055,"y":154.19020557403564,"wires":[[]]},{"id":"80ddf935.49d6a8","type":"subflow:c54a6289.8d3238","z":"81cc33f0.fc5b8","x":777.5000305175781,"y":1576.6666259765625,"wires":[[]]},{"id":"fddadf6.d590aa","type":"mongodb in","z":"36ed9192.7f36c6","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":626.5000152587891,"y":152.00010776519775,"wires":[["e25c568a.4969e"]]},{"id":"f7fcadd1.4fd5a8","type":"function","z":"36ed9192.7f36c6","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":395.6663475036621,"y":164.66714572906494,"wires":[["fddadf6.d590aa"]]},{"id":"e25c568a.4969e","type":"function","z":"36ed9192.7f36c6","name":"fastest_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nvar max=0;\n\nfor(var i =0; i<keys.length;i++)\n{\n  if(msg.payload[keys[i]].processing_speed>max) \n  {\n      result=msg.payload[keys[i]].node;\n  }\n}\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":852.6747970581055,"y":160.19020557403564,"wires":[[]]},{"id":"343b8a.5a261476","type":"mongodb in","z":"200df9f8.42e816","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":693.5,"y":160.00010108947754,"wires":[["a1931fb0.c216d8"]]},{"id":"dbc61ece.298888","type":"function","z":"200df9f8.42e816","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":467.6663589477539,"y":166.6671440601349,"wires":[["343b8a.5a261476"]]},{"id":"a1931fb0.c216d8","type":"function","z":"200df9f8.42e816","name":"delay_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nvar min=6;\n\nfor(var i =0; i<keys.length;i++)\n{\n  if(msg.payload[keys[i]].network_delay<min) \n  {\n      result=msg.payload[keys[i]].node;\n  }\n}\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":891.6748161315918,"y":160.19020557403564,"wires":[[]]},{"id":"5cbccfcb.1b7a6","type":"subflow:200df9f8.42e816","z":"81cc33f0.fc5b8","x":421.5,"y":1806,"wires":[[]]},{"id":"d55d1e65.d2ca18","type":"mongodb in","z":"12faade0.02bbba","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":604.5000152587891,"y":155.00010776519775,"wires":[["97fc1252.eb09d8"]]},{"id":"9ddc0f1a.cf4b68","type":"function","z":"12faade0.02bbba","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":373.6663475036621,"y":167.66714572906494,"wires":[["d55d1e65.d2ca18"]]},{"id":"97fc1252.eb09d8","type":"function","z":"12faade0.02bbba","name":"save node ids","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":883.6748123168945,"y":160.19020557403564,"wires":[[]]},{"id":"ae3715d0.18f7c","type":"mongodb in","z":"7f74fb69.f311d4","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":415.6666564941406,"y":157.66665649414062,"wires":[["d5600e9b.4f412"]]},{"id":"2dc03fe2.4eff68","type":"function","z":"7f74fb69.f311d4","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":156.8329200744629,"y":146.3336672782898,"wires":[["ae3715d0.18f7c"]]},{"id":"d5600e9b.4f412","type":"function","z":"7f74fb69.f311d4","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":710.8332061767578,"y":138.33321571350098,"wires":[["9a62ba42.739ac8"]]},{"id":"c032807c.2fcd2","type":"mongodb in","z":"7f74fb69.f311d4","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":1617.8099060058594,"y":143.3101348876953,"wires":[["97c00c89.2de32"]]},{"id":"9bd9c4f0.1be458","type":"function","z":"7f74fb69.f311d4","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1450.9760360717773,"y":144.97740173339844,"wires":[["c032807c.2fcd2"]]},{"id":"9a62ba42.739ac8","type":"function","z":"7f74fb69.f311d4","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":944.3333892822266,"y":146.3333282470703,"wires":[["b2f4c1e4.4c681"]]},{"id":"b2f4c1e4.4c681","type":"mongodb in","z":"7f74fb69.f311d4","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1101.3332061767578,"y":146.33332777023315,"wires":[["39ed7110.d6908e"]]},{"id":"39ed7110.d6908e","type":"function","z":"7f74fb69.f311d4","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1252.8332138061523,"y":146.33348083496094,"wires":[["9bd9c4f0.1be458"]]},{"id":"97c00c89.2de32","type":"function","z":"7f74fb69.f311d4","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1786.309585571289,"y":143.80981636047363,"wires":[["e3abdb7f.c1826"]]},{"id":"e3abdb7f.c1826","type":"function","z":"7f74fb69.f311d4","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=[];\n\nvar keys = Object.keys(mapped);\n\n\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<keys.length;j++)\n    {\n        if (mapped[j].node==nodes[i])\n        {\n             result.push(mapped[keys[j]]);\n        }\n    }\n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1941.8115997314453,"y":149.81004524230957,"wires":[[]]},{"id":"83ce76e5.091f7","type":"subflow:7f74fb69.f311d4","z":"81cc33f0.fc5b8","name":"","x":484.50006103515625,"y":1882.666748046875,"wires":[["2e73dee9.c6ccaa"]]},{"id":"e1c7af5c.ec2ba8","type":"subflow:a98f15d5.fefb9","z":"81cc33f0.fc5b8","x":949.5000076293945,"y":1828.0000324249268,"wires":[["89b5a910.53c208"]]},{"id":"2e73dee9.c6ccaa","type":"subflow:3243bb64.94c7b4","z":"81cc33f0.fc5b8","x":716.5000305175781,"y":1878.666633605957,"wires":[["a8ac4a74.9471a8"]]},{"id":"a8ac4a74.9471a8","type":"subflow:e7e3b95a.29da88","z":"81cc33f0.fc5b8","x":804.5,"y":1755.333251953125,"wires":[["e1c7af5c.ec2ba8"]]},{"id":"e9936b82.6e0518","type":"function","z":"81cc33f0.fc5b8","name":"asfasf","func":"msg.task=\"task1\";\nmsg.payload=\"pay1\";\nreturn msg;","outputs":1,"noerr":0,"x":447.5,"y":2201,"wires":[["f4232b5f.2eee68"]]},{"id":"f4232b5f.2eee68","type":"function","z":"81cc33f0.fc5b8","name":"mas","func":"msg.task=msg.task+\"fsfs\";\nmsg.payload=msg.task;\nreturn msg;","outputs":1,"noerr":0,"x":583.5,"y":2190,"wires":[["3beb348.27ff9cc"]]},{"id":"496c6d50.067a1c","type":"inject","z":"81cc33f0.fc5b8","name":"","topic":"","payload":"rpi1","payloadType":"str","repeat":"20","crontab":"","once":false,"x":216.5,"y":2274,"wires":[["56d8eb09.1a71bc"]]},{"id":"3beb348.27ff9cc","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":724.5,"y":2191,"wires":[]},{"id":"fc64369c.9e0278","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":534,"y":2315,"wires":[["9dd195a2.88ccf8"]]},{"id":"56d8eb09.1a71bc","type":"function","z":"81cc33f0.fc5b8","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',\"troponin_processing\");\nflow.set('nodename',msg.payload);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":383.1662902832031,"y":2284.6669921875,"wires":[[]]},{"id":"9dd195a2.88ccf8","type":"function","z":"81cc33f0.fc5b8","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":726.1666259765625,"y":2317.666748046875,"wires":[["c3e5af1c.b11268"]]},{"id":"c3e5af1c.b11268","type":"function","z":"81cc33f0.fc5b8","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"arch\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":886,"y":2282,"wires":[["d65055e8.23da1"]]},{"id":"d65055e8.23da1","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1037,"y":2289,"wires":[["9e8d33e5.5b5b08"]]},{"id":"9e8d33e5.5b5b08","type":"function","z":"81cc33f0.fc5b8","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]].arch;\n}\n\nflow.set('nodearch',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1204,"y":2287,"wires":[["cbfe23cc.365b38"]]},{"id":"cbfe23cc.365b38","type":"function","z":"81cc33f0.fc5b8","name":"maker","func":"var arch=flow.get('nodearch');\nvar taski=flow.get('taskinfo');\n\nif (arch==\"x86\")\n{\nmsg.payload=\"sudo docker service create --name \"+ \"service1 --replicas=1 --publish \"+ taski.external_port+\":\"+taski.internal_port+\" \"+taski.image_x86;    \n}\nelse\n{\n    \nmsg.payload=\"sudo docker service create --name \"+ \"service1 --replicas=1 --publish \"+ taski.external_port+\":\"+taski.interrnal_port+\" \"+taski.image_arm;    \n    \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1361.5,"y":2283,"wires":[["331c613e.f52b8e"]]},{"id":"331c613e.f52b8e","type":"exec","z":"81cc33f0.fc5b8","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1514.5,"y":2273.5,"wires":[[],["4eaf6195.18e638"],[]]},{"id":"4eaf6195.18e638","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":1666.5,"y":2286,"wires":[]},{"id":"f8794a06.48ba58","type":"mongodb in","z":"ebf70977.5d99c8","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":411.833740234375,"y":145,"wires":[["f92aeeba.7b5e2"]]},{"id":"f3f55ce8.0f55a","type":"function","z":"ebf70977.5d99c8","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":250,"y":150.6669921875,"wires":[["f8794a06.48ba58"]]},{"id":"f92aeeba.7b5e2","type":"function","z":"ebf70977.5d99c8","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":543,"y":242,"wires":[["7eb9d8e6.68f2f8"]]},{"id":"7eb9d8e6.68f2f8","type":"function","z":"ebf70977.5d99c8","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"arch\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":691.8333740234375,"y":180.333251953125,"wires":[["28a05396.e0e5f4"]]},{"id":"28a05396.e0e5f4","type":"mongodb in","z":"ebf70977.5d99c8","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":837.8333740234375,"y":222.333251953125,"wires":[["151fa7ed.a2597"]]},{"id":"151fa7ed.a2597","type":"function","z":"ebf70977.5d99c8","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]].arch;\n}\n\nflow.set('nodearch',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1004.8333740234375,"y":220.333251953125,"wires":[["d9792d16.448eb8"]]},{"id":"d9792d16.448eb8","type":"function","z":"ebf70977.5d99c8","name":"maker","func":"var arch=flow.get('nodearch');\nvar taski=flow.get('taskinfo');\n\nif (arch==\"x86\")\n{\nmsg.payload=\"sudo docker service create --name \"+ taski.id + \" --replicas=1 --publish \"+ taski.external_port+\":\"+taski.internal_port+\" \"+taski.image_x86;    \n}\nelse\n{\n    \nmsg.payload=\"sudo docker service create --name \"+ taski.id + \"--replicas=1 --publish \"+ taski.external_port+\":\"+taski.interrnal_port+\" \"+taski.image_arm;    \n    \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1170,"y":221,"wires":[["bc79b8e6.262f8"]]},{"id":"bc79b8e6.262f8","type":"exec","z":"ebf70977.5d99c8","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1323,"y":211.5,"wires":[[],[],[]]},{"id":"4e366a03.5b742c","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"5e998395.210904","name":"","collection":"","operation":"find","x":1455.5,"y":2087,"wires":[[]]},{"id":"fec4244a.c7e3c8","type":"inject","z":"81cc33f0.fc5b8","name":"","topic":"","payload":"rpi1","payloadType":"str","repeat":"20","crontab":"","once":false,"x":1087,"y":2377,"wires":[[]]},{"id":"b1263fbd.39b808","type":"subflow:ebf70977.5d99c8","z":"81cc33f0.fc5b8","name":"","x":448.5,"y":1996,"wires":[["cc8eff48.f95968"]]},{"id":"cc8eff48.f95968","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"payload","x":624.5,"y":2007,"wires":[]},{"id":"ba3bf607.8c52f8","type":"function","z":"81cc33f0.fc5b8","name":"","func":"sg.nodename=\"rpi1\";\nmsg.taskname=\"test_processing\";\nreturn msg;","outputs":1,"noerr":0,"x":286.5,"y":1972,"wires":[["b1263fbd.39b808"]]},{"id":"c274d6e4.6b2e18","type":"bigssh","z":"81cc33f0.fc5b8","name":"","commandLine":"","commandArgs":"","minError":1,"minWarning":1,"noStdin":false,"format":"","payloadIsArg":false,"myssh":"6847aabe.79e92c","x":309.5,"y":2138.5,"wires":[[],[],[]]},{"id":"7227fc8.e184d04","type":"inject","z":"81cc33f0.fc5b8","name":"","topic":"","payload":"docker run -d -p 80:80 vicviper/phparmnew","payloadType":"str","repeat":"10","crontab":"","once":false,"x":55,"y":2150,"wires":[[]]},{"id":"d31113e0.8f61d","type":"inject","z":"81cc33f0.fc5b8","name":"","topic":"","payload":" ssh pirate@10.79.4.153 'docker run -d -p 27017:27017 nonoroazoro/rpi-mongo'","payloadType":"str","repeat":"10","crontab":"","once":false,"x":179.5,"y":2545,"wires":[[]]},{"id":"3eb9d655.0dd642","type":"exec","z":"81cc33f0.fc5b8","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":335.5,"y":2541.5,"wires":[[],["d376f660.2eb988"],[]]},{"id":"fd74ea37.789c5","type":"http request","z":"81cc33f0.fc5b8","name":"","method":"GET","ret":"txt","url":"http://127.0.0.1:81/troponin.php?troponin=0.00001","tls":"","x":375.5,"y":2670,"wires":[["a03fee6e.91293"]]},{"id":"9785cdc4.c05e4","type":"inject","z":"81cc33f0.fc5b8","name":"","topic":"","payload":" ssh pirate@10.79.4.153 'docker run -d -p 80:80 vicviper/phparmnew'","payloadType":"str","repeat":"10","crontab":"","once":false,"x":164.5,"y":2610,"wires":[[]]},{"id":"d376f660.2eb988","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":481.5,"y":2578,"wires":[]},{"id":"dde53205.8bf37","type":"inject","z":"81cc33f0.fc5b8","name":"","topic":"","payload":"ja","payloadType":"str","repeat":"10","crontab":"","once":false,"x":244,"y":2839,"wires":[[]]},{"id":"fc10d629.f09048","type":"function","z":"81cc33f0.fc5b8","name":"query ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.payload; \nmsg.payload={ rid: patient};\nmsg.projection = {\"_id\":0, \"rid\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":178,"y":2736,"wires":[[]]},{"id":"256c2d88.f3c2ca","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":709.5,"y":2749,"wires":[]},{"id":"833b07e1.f6ff9","type":"function","z":"81cc33f0.fc5b8","name":"msaf","func":"msg.mongodb.hostname=\"10.79.4.159\"\nreturn msg;","outputs":1,"noerr":0,"x":262.5,"y":2931,"wires":[[]]},{"id":"f460b418.72a0e","type":"function","z":"81cc33f0.fc5b8","name":"","func":"msg.payload=msg.mongodb.hostname;\nreturn msg;","outputs":1,"noerr":0,"x":718.5,"y":2894,"wires":[[]]},{"id":"5eb87258.916a4c","type":"inject","z":"81cc33f0.fc5b8","name":"","topic":"","payload":"http://127.0.0.1:80/troponin.php?troponin=0.02","payloadType":"str","repeat":"1","crontab":"","once":false,"x":175.5,"y":2677,"wires":[[]]},{"id":"a03fee6e.91293","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"payload","x":543.5,"y":2673,"wires":[]},{"id":"143f7cbf.0bb583","type":"mongodb in","z":"3c2de136.d6797e","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":313.833740234375,"y":141,"wires":[["877cd056.bdf1f8"]]},{"id":"272c1673.44805a","type":"function","z":"3c2de136.d6797e","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":152,"y":155.6669921875,"wires":[["143f7cbf.0bb583"]]},{"id":"877cd056.bdf1f8","type":"function","z":"3c2de136.d6797e","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":445,"y":247,"wires":[["379971b3.0f96d6"]]},{"id":"379971b3.0f96d6","type":"function","z":"3c2de136.d6797e","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"arch\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":593.8333740234375,"y":185.333251953125,"wires":[["64e22cf5.4a3964"]]},{"id":"64e22cf5.4a3964","type":"mongodb in","z":"3c2de136.d6797e","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":739.8333740234375,"y":227.333251953125,"wires":[["14249d3b.60b7fb"]]},{"id":"14249d3b.60b7fb","type":"function","z":"3c2de136.d6797e","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]].arch;\n}\n\nflow.set('nodearch',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":906.8333740234375,"y":225.333251953125,"wires":[["3a2244ee.e2b66c"]]},{"id":"3a2244ee.e2b66c","type":"function","z":"3c2de136.d6797e","name":"maker","func":"var arch=flow.get('nodearch');\nvar taski=flow.get('taskinfo');\n\nif (arch==\"x86\")\n{\nmsg.payload=\"docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+  \" \"+taski.image_x86;\n}\nelse\n{\n    \nmsg.payload=\"docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+  \" \"+taski.image_arm;\n    \n    \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1072,"y":226,"wires":[["f9af888e.982418"]]},{"id":"ae01bd2.99fbfc","type":"subflow:3c2de136.d6797e","z":"81cc33f0.fc5b8","name":"","x":467.5,"y":3124,"wires":[["44b664c2.63915c"]]},{"id":"69b29df1.2de064","type":"function","z":"81cc33f0.fc5b8","name":"tasker","func":"msg.taskname=flow.get('zadatak');\nmsg.nodename=msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":525.5,"y":3520,"wires":[["8d632eb3.72bac"]]},{"id":"44b664c2.63915c","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":661.5,"y":3073,"wires":[]},{"id":"f9af888e.982418","type":"exec","z":"3c2de136.d6797e","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1198.5,"y":278.5,"wires":[[],[],[]]},{"id":"6eec519a.f10be","type":"subflow:e7ee6205.86ed88","z":"81cc33f0.fc5b8","name":"","x":354.5,"y":1617,"wires":[["b34c0ea7.3f3f28"]]},{"id":"6c3b4d4f.08ae3c","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/troponin_proxy2","method":"get","swaggerDoc":"","x":105,"y":1608,"wires":[["6eec519a.f10be"]]},{"id":"b34c0ea7.3f3f28","type":"http response","z":"81cc33f0.fc5b8","name":"","x":582,"y":1602,"wires":[]},{"id":"29f343aa.045014","type":"subflow:e1cc44b0.94d07","z":"81cc33f0.fc5b8","name":"","x":317.5,"y":1667,"wires":[["4117aa4e.2b7b8c"]]},{"id":"c4ed2c0e.6959b","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/test_proxy2","method":"get","swaggerDoc":"","x":126,"y":1667,"wires":[["29f343aa.045014"]]},{"id":"4117aa4e.2b7b8c","type":"http response","z":"81cc33f0.fc5b8","name":"","x":530.5,"y":1658,"wires":[]},{"id":"750b1f87.1f7ce8","type":"inject","z":"81cc33f0.fc5b8","name":"","topic":"","payload":"","payloadType":"str","repeat":"10","crontab":"","once":false,"x":107.5,"y":1982,"wires":[[]]},{"id":"1d5ec57a.cff60b","type":"subflow:7b8bf22.018668c","z":"81cc33f0.fc5b8","name":"","x":315.5,"y":1732,"wires":[["7abfbda9.ea0bbc"]]},{"id":"5d31b076.21783","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/ecg_proxy2","method":"get","swaggerDoc":"","x":129,"y":1735,"wires":[["1d5ec57a.cff60b"]]},{"id":"7abfbda9.ea0bbc","type":"http response","z":"81cc33f0.fc5b8","name":"","x":498.5,"y":1728,"wires":[]},{"id":"da50ad82.e7044","type":"subflow:c54a6289.8d3238","z":"81cc33f0.fc5b8","name":"","x":391.5,"y":3284,"wires":[[]]},{"id":"4451f94c.d647c","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":732.5,"y":3215,"wires":[]},{"id":"28ba4050.a60ac","type":"mongodb in","z":"45e9ae74.d7fc68","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":280,"y":138,"wires":[["48c63983.4fcbc"]]},{"id":"8a6ea1b2.9ff4d","type":"function","z":"45e9ae74.d7fc68","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":118.166259765625,"y":152.6669921875,"wires":[["28ba4050.a60ac"]]},{"id":"48c63983.4fcbc","type":"function","z":"45e9ae74.d7fc68","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":411.166259765625,"y":244,"wires":[["576f580b.ac12d8"]]},{"id":"576f580b.ac12d8","type":"function","z":"45e9ae74.d7fc68","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":559.9996337890625,"y":182.333251953125,"wires":[["4cee2ce1.b1abcc"]]},{"id":"4cee2ce1.b1abcc","type":"mongodb in","z":"45e9ae74.d7fc68","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":705.9996337890625,"y":224.333251953125,"wires":[["f9b8d4d2.718078"]]},{"id":"f9b8d4d2.718078","type":"function","z":"45e9ae74.d7fc68","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":872.9996337890625,"y":222.333251953125,"wires":[["1e2d8205.a63d26"]]},{"id":"1e2d8205.a63d26","type":"function","z":"45e9ae74.d7fc68","name":"maker","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif (nodei.arch==\"x86\")\n{\nmsg.payload=\"docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n}\nelse\n{\n    \nmsg.payload=\"docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n    \n    \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1038.166259765625,"y":223,"wires":[["15fdadf.1b66dd2"]]},{"id":"8d632eb3.72bac","type":"subflow:45e9ae74.d7fc68","z":"81cc33f0.fc5b8","name":"","x":675.5,"y":3516,"wires":[["bc66685e.24a86"]]},{"id":"726035cb.6659b4","type":"subflow:45e9ae74.d7fc68","z":"81cc33f0.fc5b8","name":"","x":364.5,"y":3408,"wires":[["cd5fe07f.561088"]]},{"id":"cd5fe07f.561088","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":572.5,"y":3413,"wires":[]},{"id":"15fdadf.1b66dd2","type":"exec","z":"45e9ae74.d7fc68","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1182.5,"y":231.5,"wires":[[],[],[]]},{"id":"faab7f8b.7a726","type":"mongodb in","z":"1d95fe66.40b202","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":369,"y":135,"wires":[["e68889b1.949988"]]},{"id":"9c18b9d7.478c38","type":"function","z":"1d95fe66.40b202","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload;\n\nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":138.16633224487305,"y":147.6670379638672,"wires":[["faab7f8b.7a726"]]},{"id":"e68889b1.949988","type":"function","z":"1d95fe66.40b202","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":585.1747817993164,"y":143.1900978088379,"wires":[[]]},{"id":"5145070c.a0a868","type":"mongodb in","z":"1f4965e1.25c3da","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":697,"y":155,"wires":[["dec3176e.5f5948"]]},{"id":"924a08cd.17dc88","type":"function","z":"1f4965e1.25c3da","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":438.16626358032227,"y":143.66701078414917,"wires":[["5145070c.a0a868"]]},{"id":"dec3176e.5f5948","type":"function","z":"1f4965e1.25c3da","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":992.1665496826172,"y":135.66655921936035,"wires":[["be5334d5.b22ae8"]]},{"id":"76aa595c.26552","type":"mongodb in","z":"1f4965e1.25c3da","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":1899.1432495117188,"y":140.6434783935547,"wires":[["1ddfb2e0.bd08d5"]]},{"id":"e0d53fd8.cd228","type":"function","z":"1f4965e1.25c3da","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1732.3093795776367,"y":142.3107452392578,"wires":[["76aa595c.26552"]]},{"id":"be5334d5.b22ae8","type":"function","z":"1f4965e1.25c3da","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par, arch:\"arm\"};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1225.666732788086,"y":143.6666717529297,"wires":[["f21c2f93.523a7"]]},{"id":"f21c2f93.523a7","type":"mongodb in","z":"1f4965e1.25c3da","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1382.6665496826172,"y":143.66667127609253,"wires":[["9e60ae1b.e67c"]]},{"id":"9e60ae1b.e67c","type":"function","z":"1f4965e1.25c3da","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1534.1665573120117,"y":143.6668243408203,"wires":[["e0d53fd8.cd228"]]},{"id":"1ddfb2e0.bd08d5","type":"function","z":"1f4965e1.25c3da","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2067.6429290771484,"y":141.143159866333,"wires":[["b0ca9d22.0e0ee"]]},{"id":"b0ca9d22.0e0ee","type":"function","z":"1f4965e1.25c3da","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=[];\n\nvar keys = Object.keys(mapped);\n\n\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<keys.length;j++)\n    {\n        if (mapped[j].node==nodes[i])\n        {\n             result.push(mapped[keys[j]]);\n        }\n    }\n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2223.1449432373047,"y":147.14338874816895,"wires":[[]]},{"id":"ffa78c61.516db","type":"subflow:1f4965e1.25c3da","z":"81cc33f0.fc5b8","name":"","x":341.5,"y":3498,"wires":[["ef23aed.95914d"]]},{"id":"bc66685e.24a86","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":870.5,"y":3566,"wires":[]},{"id":"ef23aed.95914d","type":"subflow:a98f15d5.fefb9","z":"81cc33f0.fc5b8","name":"","x":420.5,"y":3593,"wires":[["69b29df1.2de064"]]},{"id":"1633b1a.a20f9ce","type":"function","z":"81cc33f0.fc5b8","name":"parameter_setting","func":"flow.set('zadatak',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":222.5,"y":3686,"wires":[["ffa78c61.516db"]]},{"id":"785f450b.00f3b4","type":"function","z":"83de406b.6969a","name":"tasker","func":"msg.taskname=flow.get('zadatak');\nmsg.nodename=msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":463,"y":51,"wires":[["e9d0ec51.4bba58"]]},{"id":"e9d0ec51.4bba58","type":"subflow:45e9ae74.d7fc68","z":"83de406b.6969a","name":"","x":613,"y":120,"wires":[[]]},{"id":"f43d0e62.462ef","type":"subflow:1f4965e1.25c3da","z":"83de406b.6969a","name":"","x":238.00001525878906,"y":66,"wires":[["d34fbc5d.724418"]]},{"id":"d34fbc5d.724418","type":"subflow:a98f15d5.fefb9","z":"83de406b.6969a","name":"","x":358,"y":124,"wires":[["785f450b.00f3b4"]]},{"id":"2beacae2.bac596","type":"function","z":"83de406b.6969a","name":"parameter_setting","func":"msg.payload=\"test_processing\";\nflow.set('zadatak',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":198,"y":226.00001525878906,"wires":[["f43d0e62.462ef"]]},{"id":"57354a7.0cffe34","type":"subflow:83de406b.6969a","z":"81cc33f0.fc5b8","name":"","x":437.5,"y":3862,"wires":[["686d99fc.82bc"]]},{"id":"686d99fc.82bc","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":666.5,"y":3838,"wires":[]},{"id":"4e1c1965.97c","type":"subflow:45e9ae74.d7fc68","z":"e512626a.4a0ca","x":317.5,"y":177,"wires":[[]]},{"id":"f0a9c714.f48d8","type":"function","z":"e512626a.4a0ca","name":"tasker","func":"msg.taskname=\"ecg_processing\";\nmsg.nodename=\"pc1\";\nreturn msg;","outputs":1,"noerr":0,"x":165,"y":185,"wires":[["4e1c1965.97c"]]},{"id":"53bc43dd.75a20c","type":"inject","z":"81cc33f0.fc5b8","name":"","topic":"","payload":"patient1","payloadType":"str","repeat":"3","crontab":"","once":false,"x":92.5,"y":4601,"wires":[[]]},{"id":"dc52228a.2d6ce8","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":635.5,"y":3964,"wires":[]},{"id":"f4e4c658.cabd2","type":"subflow:e512626a.4a0ca","z":"81cc33f0.fc5b8","name":"","x":427.5,"y":3966,"wires":[["dc52228a.2d6ce8"]]},{"id":"ddd61daa.c23d88","type":"subflow:45e9ae74.d7fc68","z":"c44dda19.9778b8","name":"","x":461,"y":124,"wires":[[]]},{"id":"1680430e.769795","type":"function","z":"c44dda19.9778b8","name":"tasker","func":"msg.taskname=\"troponin_processing\";\nmsg.nodename=\"rpi3\";\nreturn msg;","outputs":1,"noerr":0,"x":301.5,"y":139,"wires":[["ddd61daa.c23d88"]]},{"id":"8c5aa1b9.ee42b","type":"subflow:c44dda19.9778b8","z":"81cc33f0.fc5b8","name":"","x":417.5,"y":4055,"wires":[["fc9cdbd2.843cf8"]]},{"id":"fc9cdbd2.843cf8","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":628.5,"y":4058,"wires":[]},{"id":"8e21146c.a9143","type":"subflow:45e9ae74.d7fc68","z":"cbab08a8.84cc78","name":"","x":453,"y":128,"wires":[[]]},{"id":"784b48e9.25e2e","type":"function","z":"cbab08a8.84cc78","name":"tasker","func":"msg.taskname=\"mongo_ecg\";\nmsg.nodename=\"pc1\";\nreturn msg;","outputs":1,"noerr":0,"x":287.5,"y":149,"wires":[["8e21146c.a9143"]]},{"id":"a6c7bb37.9ac02","type":"subflow:45e9ae74.d7fc68","z":"e4366e89.5e626","name":"","x":410,"y":113,"wires":[[]]},{"id":"aba7ee58.5bcc58","type":"function","z":"e4366e89.5e626","name":"tasker","func":"msg.taskname=\"mongo_troponin\";\nmsg.nodename=\"rpi3\";\nreturn msg;","outputs":1,"noerr":0,"x":236.5,"y":147,"wires":[["a6c7bb37.9ac02"]]},{"id":"60d20831.f67b6","type":"subflow:cbab08a8.84cc78","z":"81cc33f0.fc5b8","name":"","x":411.5,"y":4130,"wires":[["4200a1b4.5a21d"]]},{"id":"caaf512e.b5a6d8","type":"subflow:e4366e89.5e626","z":"81cc33f0.fc5b8","x":417.5,"y":4212,"wires":[[]]},{"id":"4200a1b4.5a21d","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":645.5,"y":4132,"wires":[]},{"id":"4900ffa.f89198","type":"subflow:e7ee6205.86ed88","z":"81cc33f0.fc5b8","name":"","x":444,"y":4314,"wires":[["a5530719.9dab"]]},{"id":"aae31321.9cd788","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/troponin_proxy3","method":"get","swaggerDoc":"","x":194.5,"y":4305,"wires":[["4900ffa.f89198"]]},{"id":"a5530719.9dab","type":"http response","z":"81cc33f0.fc5b8","name":"","x":671.5,"y":4299,"wires":[]},{"id":"aa9644a2.5ce398","type":"subflow:e1cc44b0.94d07","z":"81cc33f0.fc5b8","name":"","x":407,"y":4364,"wires":[["e26142e2.69afd"]]},{"id":"bac7d1bf.11512","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/test_proxy3","method":"get","swaggerDoc":"","x":215.5,"y":4364,"wires":[["aa9644a2.5ce398"]]},{"id":"e26142e2.69afd","type":"http response","z":"81cc33f0.fc5b8","name":"","x":620,"y":4355,"wires":[]},{"id":"b5011cd.32105e","type":"subflow:7b8bf22.018668c","z":"81cc33f0.fc5b8","name":"","x":405,"y":4429,"wires":[["66d97aed.9d13fc"]]},{"id":"1909364a.25d3b2","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/ecg_proxy3","method":"get","swaggerDoc":"","x":218.5,"y":4432,"wires":[["b5011cd.32105e"]]},{"id":"66d97aed.9d13fc","type":"http response","z":"81cc33f0.fc5b8","name":"","x":588,"y":4425,"wires":[]},{"id":"67dfbc96.ca70ac","type":"http request","z":"f7801593.79cfb","name":"","method":"GET","ret":"txt","url":"","tls":"","x":464,"y":179,"wires":[[]]},{"id":"6b647b59.8cbfd4","type":"function","z":"f7801593.79cfb","name":"url_maker_ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar ecg_value=msg.ecg; \nvar service_location=\"127.0.0.1:81/ecg.php\"\nmsg.url=service_location+\"?ecg=\"+ecg_value;\nreturn msg;\n","outputs":1,"noerr":0,"x":258.5,"y":225.00001525878906,"wires":[["67dfbc96.ca70ac"]]},{"id":"41bd31f8.a90518","type":"subflow:343d6003.5a8bc8","z":"81cc33f0.fc5b8","x":374.5,"y":4514,"wires":[["a78bf5bb.52a258"]]},{"id":"a78bf5bb.52a258","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":530.5,"y":4520,"wires":[]},{"id":"625db38c.43c714","type":"function","z":"81cc33f0.fc5b8","name":"troponin_input","func":"msg.troponin=0.1\nreturn msg;","outputs":1,"noerr":0,"x":168.5,"y":4548,"wires":[["41bd31f8.a90518"]]},{"id":"a19c2436.39973","type":"subflow:ec360aba.4d64d","z":"81cc33f0.fc5b8","x":796.5,"y":4391,"wires":[["37e64268.2549be"]]},{"id":"37e64268.2549be","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":991.5,"y":4383,"wires":[]},{"id":"a9c341e8.f8bc7","type":"function","z":"81cc33f0.fc5b8","name":"test_input","func":"msg.ec=0;\nmsg.tr=1;\nreturn msg;","outputs":1,"noerr":0,"x":721.5,"y":4463,"wires":[["a19c2436.39973"]]},{"id":"a56f0ec2.95c5e8","type":"subflow:f7801593.79cfb","z":"81cc33f0.fc5b8","x":904.5,"y":4521,"wires":[["9dd857bc.be7e58"]]},{"id":"e68eeb76.50e17","type":"function","z":"81cc33f0.fc5b8","name":"ecg_input","func":"msg.ecg=\"slika.jpg\";\nreturn msg;","outputs":1,"noerr":0,"x":758.5,"y":4523,"wires":[["a56f0ec2.95c5e8"]]},{"id":"9dd857bc.be7e58","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":1042.5,"y":4516,"wires":[]},{"id":"79233d2d.dd5aac","type":"subflow:343d6003.5a8bc8","z":"81cc33f0.fc5b8","name":"","x":660.5,"y":4727,"wires":[["9431b4d.2b596c8"]]},{"id":"fa7f9363.940e5","type":"subflow:f7801593.79cfb","z":"81cc33f0.fc5b8","name":"","x":1608.5,"y":4901,"wires":[["d60b5964.b44ab"]]},{"id":"d60b5964.b44ab","type":"function","z":"81cc33f0.fc5b8","name":"ecg_output","func":"flow.set('ec',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":1662.5,"y":4722,"wires":[[]]},{"id":"9431b4d.2b596c8","type":"function","z":"81cc33f0.fc5b8","name":"troponin_output","func":"flow.set('tr',msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":837.5,"y":4845,"wires":[["6fc8f45e.ded99c"]]},{"id":"e2702eab.3bbaa8","type":"subflow:ec360aba.4d64d","z":"81cc33f0.fc5b8","name":"","x":1968.5,"y":4749,"wires":[["f36ac906.ed35b"]]},{"id":"3b589048.ac58e","type":"function","z":"81cc33f0.fc5b8","name":"test_input","func":"msg.tr=flow.get(\"tr\");\nmsg.ec=flow.get(\"ec\");\nreturn msg;","outputs":1,"noerr":0,"x":1819.5,"y":4686,"wires":[["e2702eab.3bbaa8"]]},{"id":"7c7b34a8.f58b64","type":"function","z":"81cc33f0.fc5b8","name":"query_troponin","func":"msg.limit = 5;\nmsg.skip = 0;\n\nvar patient=msg.req.query.patient; \n\nflow.set('patient',patient);\nmsg.payload={ patient: patient};\nmsg.projection = {\"_id\":0, \"value\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":272.5,"y":4860,"wires":[["13f2f914.049fcf"]]},{"id":"13f2f914.049fcf","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"d8e02658.904e9","name":"","collection":"troponin","operation":"find","x":364.5,"y":4706,"wires":[["bde83ee.f9e614"]]},{"id":"bde83ee.f9e614","type":"function","z":"81cc33f0.fc5b8","name":"trop_results","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].value);\n}\nmsg.payload=result[0];\nmsg.troponin=result[0];\nreturn msg;","outputs":1,"noerr":0,"x":575.5,"y":4876,"wires":[["79233d2d.dd5aac"]]},{"id":"6fc8f45e.ded99c","type":"function","z":"81cc33f0.fc5b8","name":"query_ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=flow.get('patient');\nmsg.payload={ patient: patient};\nmsg.projection = {\"_id\":0, \"image\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":968,"y":4728,"wires":[["ce9d5b61.de98f8"]]},{"id":"ce9d5b61.de98f8","type":"mongodb in","z":"81cc33f0.fc5b8","mongodb":"ade6f75b.4065c8","name":"","collection":"ecg","operation":"find","x":1159.5,"y":4815,"wires":[["53337c76.94b8b4"]]},{"id":"53337c76.94b8b4","type":"function","z":"81cc33f0.fc5b8","name":"ecg_results","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].image);\n}\n\n\nmsg.ecg=result[0];\nmsg.payload=msg.ecg;\nreturn msg;","outputs":1,"noerr":0,"x":1360,"y":4713,"wires":[[]]},{"id":"f36ac906.ed35b","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":2202.5,"y":4747,"wires":[]},{"id":"59f89f0e.25f93","type":"http in","z":"81cc33f0.fc5b8","name":"","url":"/patient","method":"get","swaggerDoc":"","x":75,"y":4860,"wires":[["7c7b34a8.f58b64"]]},{"id":"99a25361.cf1b7","type":"subflow:343d6003.5a8bc8","z":"747cc965.eef66","name":"","x":848.5,"y":202,"wires":[["f0781d3f.8e8f88"]]},{"id":"f5b37bf2.2528c","type":"function","z":"747cc965.eef66","name":"query_troponin","func":"msg.limit = 5;\nmsg.skip = 0;\n\nvar patient=msg.req.query.patient; \n\n\nmsg.payload={ patient: patient};\nmsg.projection = {\"_id\":0, \"value\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":272.5,"y":245,"wires":[["89f7b846.bae338"]]},{"id":"89f7b846.bae338","type":"mongodb in","z":"747cc965.eef66","mongodb":"d8e02658.904e9","name":"","collection":"troponin","operation":"find","x":493.5,"y":187,"wires":[["ab0d8150.162628"]]},{"id":"ab0d8150.162628","type":"function","z":"747cc965.eef66","name":"trop_results","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].value);\n}\nmsg.payload=result[0];\nmsg.troponin=result[0];\nreturn msg;","outputs":1,"noerr":0,"x":731.5,"y":88.00001525878906,"wires":[["99a25361.cf1b7"]]},{"id":"c40e0bd9.04c7d","type":"http in","z":"747cc965.eef66","name":"","url":"/troponin_test1","method":"get","swaggerDoc":"","x":105,"y":180.00001525878906,"wires":[["f5b37bf2.2528c"]]},{"id":"f0781d3f.8e8f88","type":"http response","z":"747cc965.eef66","name":"","x":985.5,"y":136,"wires":[]},{"id":"5e6f7817.286d78","type":"subflow:f7801593.79cfb","z":"747cc965.eef66","name":"","x":840.5,"y":365,"wires":[["61b503de.2b2414"]]},{"id":"d9c75d7.d0ef4a","type":"function","z":"747cc965.eef66","name":"query_ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.req.query.patient; \nmsg.payload={ patient: patient};\nmsg.projection = {\"_id\":0, \"image\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":315,"y":373,"wires":[["849bc539.edc078"]]},{"id":"849bc539.edc078","type":"mongodb in","z":"747cc965.eef66","mongodb":"ade6f75b.4065c8","name":"","collection":"ecg","operation":"find","x":507.5,"y":314,"wires":[["829dfbf2.9840d8"]]},{"id":"829dfbf2.9840d8","type":"function","z":"747cc965.eef66","name":"ecg_results","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].image);\n}\n\nmsg.payload=result[0];\nmsg.ecg=msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":657,"y":385,"wires":[["5e6f7817.286d78"]]},{"id":"61b503de.2b2414","type":"http response","z":"747cc965.eef66","name":"","x":1041.5,"y":435,"wires":[]},{"id":"e8a99afa.dd32a8","type":"inject","z":"81cc33f0.fc5b8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":144.5,"y":3978,"wires":[[]]},{"id":"9776d9b7.1cfdb8","type":"subflow:45e9ae74.d7fc68","z":"66c8be67.8c1c08","name":"","x":537.5,"y":145,"wires":[[]]},{"id":"30c1486f.06f478","type":"function","z":"66c8be67.8c1c08","name":"tasker","func":"msg.taskname=\"sql_result\";\nmsg.nodename=\"pc1\";\nreturn msg;","outputs":1,"noerr":0,"x":332,"y":141,"wires":[["9776d9b7.1cfdb8"]]},{"id":"7bc0d9e2.05b058","type":"http in","z":"747cc965.eef66","name":"","url":"/ecg_test1","method":"get","swaggerDoc":"","x":210,"y":444,"wires":[["d9c75d7.d0ef4a"]]},{"id":"23d24d38.b757e2","type":"subflow:66c8be67.8c1c08","z":"81cc33f0.fc5b8","x":312.5,"y":3808,"wires":[["bb2a4db5.e09e2"]]},{"id":"bb2a4db5.e09e2","type":"debug","z":"81cc33f0.fc5b8","name":"","active":true,"console":"false","complete":"false","x":487.5,"y":3773,"wires":[]},{"id":"31e402c9.46c4de","type":"subflow:343d6003.5a8bc8","z":"747cc965.eef66","name":"","x":796.5,"y":607,"wires":[["4da2f2f7.6abaac"]]},{"id":"5dfd564d.ad2db","type":"function","z":"747cc965.eef66","name":"query_troponin","func":"msg.limit = 5;\nmsg.skip = 0;\n\nvar patient=msg.req.query.patient; \n\n\nmsg.payload={ patient: patient};\nmsg.projection = {\"_id\":0, \"value\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":275.5,"y":597,"wires":[["c5bed21c.62d7"]]},{"id":"c5bed21c.62d7","type":"mongodb in","z":"747cc965.eef66","mongodb":"d8e02658.904e9","name":"","collection":"troponin","operation":"find","x":505.5,"y":608,"wires":[["b11b6f44.ef39d8"]]},{"id":"b11b6f44.ef39d8","type":"function","z":"747cc965.eef66","name":"trop_results","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].value);\n}\nmsg.payload=result[0];\nmsg.troponin=result[0];\nreturn msg;","outputs":1,"noerr":0,"x":597.5,"y":677,"wires":[["31e402c9.46c4de"]]},{"id":"7b711522.77873c","type":"http in","z":"747cc965.eef66","name":"","url":"/troponin_test","method":"get","swaggerDoc":"","x":95,"y":553,"wires":[["5dfd564d.ad2db"]]},{"id":"35c088a1.4d5e18","type":"http response","z":"747cc965.eef66","name":"","x":1270.5,"y":601,"wires":[]},{"id":"4da2f2f7.6abaac","type":"function","z":"747cc965.eef66","name":"insert troponin_result","func":"var troponin=msg.payload;\nvar patient=msg.req.query.patient; \nmsg.topic=\"INSERT INTO troponin_result(patient,result) values('\"+patient+\"',\"+troponin+\") \";\nreturn msg;","outputs":1,"noerr":0,"x":1027,"y":554,"wires":[["49df2188.cafe8"]]},{"id":"49df2188.cafe8","type":"mysql","z":"747cc965.eef66","mydb":"b43efa28.b858b8","name":"troponin_result","x":1101.3330078125,"y":667.66650390625,"wires":[["35c088a1.4d5e18"]]},{"id":"7ef51f3b.74887","type":"subflow:f7801593.79cfb","z":"747cc965.eef66","name":"","x":703.5,"y":776,"wires":[["1e532d4f.47fac3"]]},{"id":"73e268fc.4051f","type":"function","z":"747cc965.eef66","name":"query_ecg","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.req.query.patient; \nmsg.payload={ patient: patient};\nmsg.projection = {\"_id\":0, \"image\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":215,"y":768,"wires":[["9052461a.1993e8"]]},{"id":"9052461a.1993e8","type":"mongodb in","z":"747cc965.eef66","mongodb":"ade6f75b.4065c8","name":"","collection":"ecg","operation":"find","x":362.5,"y":848,"wires":[["9f5dccbb.68aa58"]]},{"id":"9f5dccbb.68aa58","type":"function","z":"747cc965.eef66","name":"ecg_results","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].image);\n}\n\nmsg.payload=result[0];\nmsg.ecg=msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":532,"y":753,"wires":[["7ef51f3b.74887"]]},{"id":"c2bdafb8.1e7ff8","type":"http response","z":"747cc965.eef66","name":"","x":1144.5,"y":844,"wires":[]},{"id":"bed4785d.d23ea8","type":"http in","z":"747cc965.eef66","name":"","url":"/ecg_test","method":"get","swaggerDoc":"","x":93,"y":862,"wires":[["73e268fc.4051f"]]},{"id":"1e532d4f.47fac3","type":"function","z":"747cc965.eef66","name":"insert ecg_result","func":"var ecg=msg.payload;\nvar patient=msg.req.query.patient; \nmsg.topic=\"INSERT INTO ecg_result(patient,result) values('\"+patient+\"',\"+ecg+\") \";\nreturn msg;","outputs":1,"noerr":0,"x":811,"y":839,"wires":[["2ce48de4.6b1252"]]},{"id":"2ce48de4.6b1252","type":"mysql","z":"747cc965.eef66","mydb":"b43efa28.b858b8","name":"ecg_result","x":991.9999389648438,"y":834,"wires":[["c2bdafb8.1e7ff8"]]},{"id":"47dd4539.7fcc2c","type":"function","z":"747cc965.eef66","name":"final_res","func":"\nmsg.topic=\"SELECT * from troponin_result \";\nreturn msg;","outputs":1,"noerr":0,"x":836,"y":958,"wires":[["16e0398e.bc8e1e"]]},{"id":"16e0398e.bc8e1e","type":"mysql","z":"747cc965.eef66","mydb":"b43efa28.b858b8","name":"ecg_result","x":998,"y":991,"wires":[["a02da90a.6afb1"]]},{"id":"6d8d4fb7.0d0548","type":"http in","z":"747cc965.eef66","name":"","url":"/all","method":"get","swaggerDoc":"","x":651.5,"y":904,"wires":[["47dd4539.7fcc2c"]]},{"id":"a02da90a.6afb1","type":"http response","z":"747cc965.eef66","name":"","x":1151.5,"y":1027,"wires":[]},{"id":"191e21f0.81e636","type":"http in","z":"747cc965.eef66","name":"","url":"/troponin_result","method":"get","swaggerDoc":"","x":105,"y":1055,"wires":[["bfe55a06.fd03c"]]},{"id":"bfe55a06.fd03c","type":"function","z":"747cc965.eef66","name":"query_troponin","func":"var patient=msg.req.query.patient; \nmsg.topic=\"SELECT result from troponin_result where patient='\"+patient+\"'\";\nreturn msg;","outputs":1,"noerr":0,"x":304.5,"y":1122,"wires":[["ac162e9.f32855"]]},{"id":"af573342.fbcc48","type":"http response","z":"747cc965.eef66","name":"","x":898.5,"y":1088,"wires":[]},{"id":"ac162e9.f32855","type":"mysql","z":"747cc965.eef66","mydb":"b43efa28.b858b8","name":"troponin_result","x":480.5,"y":1047,"wires":[["f14c46de.19d788"]]},{"id":"9fe825e0.01fe8","type":"http in","z":"747cc965.eef66","name":"","url":"/ecg_result","method":"get","swaggerDoc":"","x":514,"y":1206,"wires":[["2153d2a5.19bf86"]]},{"id":"2153d2a5.19bf86","type":"function","z":"747cc965.eef66","name":"query_ecg","func":"var patient=msg.req.query.patient; \nmsg.topic=\"SELECT result from ecg_result where patient='\"+patient+\"'\";\nreturn msg;","outputs":1,"noerr":0,"x":724.5,"y":1261,"wires":[["fdd5abcd.48ee5"]]},{"id":"90351d0c.dae198","type":"http response","z":"747cc965.eef66","name":"","x":1152.5,"y":1210,"wires":[]},{"id":"fdd5abcd.48ee5","type":"mysql","z":"747cc965.eef66","mydb":"b43efa28.b858b8","name":"ecg_result","x":820.5,"y":1176,"wires":[["e533b52f.c0bd98"]]},{"id":"e533b52f.c0bd98","type":"function","z":"747cc965.eef66","name":"ecg_result_extract","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nmsg.payload=result[0].result;\nmsg.ec=result[0].result;\nreturn msg;","outputs":1,"noerr":0,"x":972,"y":1234,"wires":[["90351d0c.dae198"]]},{"id":"f14c46de.19d788","type":"function","z":"747cc965.eef66","name":"troponin_result_format","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nmsg.payload=result[0].result;\nmsg.tr=result[0].result;\nreturn msg;","outputs":1,"noerr":0,"x":664,"y":1088,"wires":[["af573342.fbcc48"]]},{"id":"b7a718c2.ca49a8","type":"http in","z":"747cc965.eef66","name":"","url":"/final_test","method":"get","swaggerDoc":"","x":105,"y":1445,"wires":[["b7fa544c.82219"]]},{"id":"b7fa544c.82219","type":"function","z":"747cc965.eef66","name":"query_troponin","func":"var patient=msg.req.query.patient; \nmsg.topic=\"SELECT result from troponin_result where patient='\"+patient+\"'\";\nreturn msg;","outputs":1,"noerr":0,"x":258,"y":1328,"wires":[["e7baea50.606a08"]]},{"id":"e7baea50.606a08","type":"mysql","z":"747cc965.eef66","mydb":"b43efa28.b858b8","name":"troponin_result","x":352,"y":1405,"wires":[["8af9c4ef.909e6"]]},{"id":"8af9c4ef.909e6","type":"function","z":"747cc965.eef66","name":"troponin_result_format","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nmsg.payload=\"\";\nflow.set('tr',result[0].result);\nreturn msg;","outputs":1,"noerr":0,"x":560.5,"y":1414,"wires":[["6c32ac79.1dbadc"]]},{"id":"6c32ac79.1dbadc","type":"function","z":"747cc965.eef66","name":"query_ecg","func":"var patient=msg.req.query.patient; \nmsg.topic=\"SELECT result from ecg_result where patient='\"+patient+\"'\";\nreturn msg;","outputs":1,"noerr":0,"x":793,"y":1430,"wires":[["69ba3184.cb617"]]},{"id":"69ba3184.cb617","type":"mysql","z":"747cc965.eef66","mydb":"b43efa28.b858b8","name":"ecg_result","x":975,"y":1381,"wires":[["ba98631f.a8aa7"]]},{"id":"ba98631f.a8aa7","type":"function","z":"747cc965.eef66","name":"ecg_result_extract","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nmsg.payload=\"\";\nflow.set('ec',result[0].result);\nreturn msg;","outputs":1,"noerr":0,"x":1116.5,"y":1488,"wires":[["e36d9701.967488"]]},{"id":"fe65fb2.84cfa08","type":"subflow:ec360aba.4d64d","z":"747cc965.eef66","name":"","x":1478,"y":1349,"wires":[["ae02c037.a7e7c"]]},{"id":"e36d9701.967488","type":"function","z":"747cc965.eef66","name":"test_input","func":"msg.tr=flow.get(\"tr\");\nmsg.ec=flow.get(\"ec\");\nreturn msg;","outputs":1,"noerr":0,"x":1330,"y":1489,"wires":[["fe65fb2.84cfa08"]]},{"id":"ae02c037.a7e7c","type":"function","z":"747cc965.eef66","name":"insert troponin_result","func":"var final=msg.payload;\nvar patient=msg.req.query.patient; \nmsg.topic=\"INSERT INTO final_result(patient,result) values('\"+patient+\"',\"+final+\") \";\nreturn msg;","outputs":1,"noerr":0,"x":1681,"y":1514,"wires":[["685e2374.611e44"]]},{"id":"685e2374.611e44","type":"mysql","z":"747cc965.eef66","mydb":"b43efa28.b858b8","name":"final_result","x":1878,"y":1544,"wires":[["df2d2046.6f4908"]]},{"id":"df2d2046.6f4908","type":"http response","z":"747cc965.eef66","name":"","x":1996.5,"y":1439,"wires":[]},{"id":"2e7f9441.ed87ec","type":"http in","z":"747cc965.eef66","name":"","url":"/final_result","method":"get","swaggerDoc":"","x":85,"y":1611,"wires":[["752aaef8.aafb98"]]},{"id":"752aaef8.aafb98","type":"function","z":"747cc965.eef66","name":"query_final","func":"var patient=msg.req.query.patient; \nmsg.topic=\"SELECT result from final_result where patient='\"+patient+\"'\";\nreturn msg;","outputs":1,"noerr":0,"x":262.5,"y":1664,"wires":[["775948e4.9ccd98"]]},{"id":"68ba0b54.ca2e64","type":"http response","z":"747cc965.eef66","name":"","x":758.5,"y":1602,"wires":[]},{"id":"775948e4.9ccd98","type":"mysql","z":"747cc965.eef66","mydb":"b43efa28.b858b8","name":"final_result","x":358.5,"y":1579,"wires":[["62c63506.9c7c64"]]},{"id":"62c63506.9c7c64","type":"function","z":"747cc965.eef66","name":"final_result_extract","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nmsg.payload=result[0].result;\nreturn msg;","outputs":1,"noerr":0,"x":536,"y":1623,"wires":[["68ba0b54.ca2e64"]]},{"id":"6f12150b.cd7b54","type":"subflow:45e9ae74.d7fc68","z":"ddff9eb6.b851e","name":"","x":399.5,"y":253.99998474121094,"wires":[["2cce2a91.a5d04e"]]},{"id":"87340de3.2477e","type":"function","z":"ddff9eb6.b851e","name":"input_format","func":"var task=msg.req.query.task;\nvar node=msg.req.query.node;\n\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":205.5,"y":222,"wires":[["6f12150b.cd7b54"]]},{"id":"a4bb533e.1aba6","type":"http in","z":"ddff9eb6.b851e","name":"","url":"/mapperi","method":"get","swaggerDoc":"","x":98.5,"y":354,"wires":[["87340de3.2477e"]]},{"id":"2cce2a91.a5d04e","type":"http response","z":"ddff9eb6.b851e","name":"","x":544.5,"y":186,"wires":[]},{"id":"276f9595.51155a","type":"mongodb in","z":"975bdb89.be2788","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":392.75,"y":154.75,"wires":[["5a775dd5.37eacc"]]},{"id":"ae0f379b.60a04","type":"function","z":"975bdb89.be2788","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1,\"url\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":230.916259765625,"y":169.4169921875,"wires":[["276f9595.51155a"]]},{"id":"5a775dd5.37eacc","type":"function","z":"975bdb89.be2788","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":523.916259765625,"y":260.75,"wires":[["d8ff8304.21481"]]},{"id":"d8ff8304.21481","type":"function","z":"975bdb89.be2788","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1,\"location\":1,\"ip\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":672.7496337890625,"y":199.083251953125,"wires":[["4518e855.8c2a88"]]},{"id":"4518e855.8c2a88","type":"mongodb in","z":"975bdb89.be2788","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":798.7496337890625,"y":317.083251953125,"wires":[["ec229d21.a4a8a8"]]},{"id":"ec229d21.a4a8a8","type":"function","z":"975bdb89.be2788","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":995.7496337890625,"y":239.083251953125,"wires":[["81911ea0.02d468"]]},{"id":"81911ea0.02d468","type":"function","z":"975bdb89.be2788","name":"creator","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif(nodei.location==\"external\")\n{\n    \n    msg.url=nodei.ip+\":\"+taski.port_external+   \"/\"+taski.url;\n    msg.payload=\"echo '\"+ msg.url+\"'\";\n\n}\nelse\n    {\n    \n        \n        if (nodei.arch==\"x86\")\n        {\n            msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n        }\n        else    \n        {\n        \n        msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n        }\n    \n            msg.url=\"127.0.0.1\"+\":\"+taski.port_external+   \"/\"+taski.url;\n\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":1127.916259765625,"y":116.75001525878906,"wires":[["5f82d6f.5df7028"]]},{"id":"5f82d6f.5df7028","type":"exec","z":"975bdb89.be2788","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"service creator","x":1335.25,"y":323.25,"wires":[[],[],[]]},{"id":"3309aa94.9a6096","type":"subflow:975bdb89.be2788","z":"3bbfbe90.4f002a","name":"","x":847.4666748046875,"y":285.11663818359375,"wires":[["996cb361.2f2ed"]]},{"id":"982f1aac.094ab","type":"function","z":"3bbfbe90.4f002a","name":"","func":"msg.taskname=\"ecg_processing\";\nmsg.nodename=\"external1\";\nreturn msg;","outputs":1,"noerr":0,"x":680.63330078125,"y":280.1666564941406,"wires":[["3309aa94.9a6096"]]},{"id":"996cb361.2f2ed","type":"http response","z":"3bbfbe90.4f002a","name":"","x":1012.63330078125,"y":280.88330078125,"wires":[]},{"id":"58b29d38.ed5ad4","type":"http in","z":"3bbfbe90.4f002a","name":"","url":"/testing1","method":"get","swaggerDoc":"","x":459.63330078125,"y":283.86663818359375,"wires":[["982f1aac.094ab"]]},{"id":"fc878c7.19f427","type":"subflow:7f74fb69.f311d4","z":"f9c7b0fd.908c28","name":"","x":258.46665954589844,"y":172.9166717529297,"wires":[[]]},{"id":"1976a943.e957df","type":"subflow:83de406b.6969a","z":"68302af2.762da4","name":"","x":270.46665954589844,"y":275.0166778564453,"wires":[[]]},{"id":"aed3d684.a51e9","type":"subflow:c54a6289.8d3238","z":"ec6f79c6.e20fe8","name":"","x":368.46661376953125,"y":247.4499969482422,"wires":[["b87d1517.6b4b7"]]},{"id":"34f2f656.b1598a","type":"inject","z":"ec6f79c6.e20fe8","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"x":167.63333129882812,"y":118.86666870117188,"wires":[[]]},{"id":"c4ea64c1.a6072","type":"subflow:975bdb89.be2788","z":"ec6f79c6.e20fe8","x":582.63330078125,"y":125.71665954589844,"wires":[[]]},{"id":"b87d1517.6b4b7","type":"debug","z":"ec6f79c6.e20fe8","name":"","active":true,"console":"false","complete":"false","x":546.6333160400391,"y":187.01666259765625,"wires":[]},{"id":"92eaedc5.8afd7","type":"function","z":"5011493c.122c2","name":"command creator","func":"var task=msg.req.query.task;\nmsg.payload=\"sudo docker service rm \"+task;\nreturn msg;","outputs":1,"noerr":0,"x":664.73291015625,"y":149.56666564941406,"wires":[["2524c64e.f5877a"]]},{"id":"2524c64e.f5877a","type":"exec","z":"5011493c.122c2","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"service removal","x":1194.066650390625,"y":152.06666564941406,"wires":[[],[],[]]},{"id":"7244bb3c.ce46a4","type":"http in","z":"ec56a6c9.7576e8","name":"","url":"/destroyer","method":"get","swaggerDoc":"","x":275.63330078125,"y":200.8666534423828,"wires":[["55528e5f.67045"]]},{"id":"2e19b07d.28ce78","type":"http response","z":"ec56a6c9.7576e8","name":"","x":779.63330078125,"y":219.88331604003906,"wires":[]},{"id":"a0821af2.406ff","type":"mongodb in","z":"5e730042.2cd008","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":421.566650390625,"y":89.56666564941406,"wires":[["c0a32e9.8f17a5"]]},{"id":"37af802c.91581","type":"function","z":"5e730042.2cd008","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.req.query.task);\nflow.set('nodename',msg.req.query.node);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1,\"url\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":259.73291015625,"y":104.23365783691406,"wires":[["a0821af2.406ff"]]},{"id":"c0a32e9.8f17a5","type":"function","z":"5e730042.2cd008","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":552.73291015625,"y":195.56666564941406,"wires":[["be4f835c.13c7a8"]]},{"id":"be4f835c.13c7a8","type":"function","z":"5e730042.2cd008","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1,\"location\":1,\"ip\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":701.5662841796875,"y":133.89991760253906,"wires":[["3d75006d.4f9dd"]]},{"id":"3d75006d.4f9dd","type":"mongodb in","z":"5e730042.2cd008","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":827.5662841796875,"y":251.89991760253906,"wires":[["ef1a8758.f03cb"]]},{"id":"ef1a8758.f03cb","type":"function","z":"5e730042.2cd008","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1024.5662841796875,"y":173.89991760253906,"wires":[["cb8cf6e7.ed5a1"]]},{"id":"cb8cf6e7.ed5a1","type":"function","z":"5e730042.2cd008","name":"creator","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif(nodei.location==\"external\")\n{\n    \n    msg.url=nodei.ip+\":\"+taski.port_external+   \"/\"+taski.url;\n    msg.payload=\"echo '\"+ msg.url+\"'\";\n\n}\nelse\n    {\n    \n        \n        if (nodei.arch==\"x86\")\n        {\n            msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n        }\n        else    \n        {\n        \n        msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n        }\n    \n            msg.url=\"127.0.0.1\"+\":\"+taski.port_external+   \"/\"+taski.url;\n\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":1156.73291015625,"y":51.566680908203125,"wires":[[]]},{"id":"2cb7ecff.a337ec","type":"http in","z":"ec56a6c9.7576e8","name":"","url":"/alloc_test_p","method":"get","swaggerDoc":"","x":118.63330078125,"y":530.8666381835938,"wires":[["7eaaf9fc.24588"]]},{"id":"9802d34a.aedad8","type":"http in","z":"ec56a6c9.7576e8","name":"","url":"/alloc_ecg_p","method":"get","swaggerDoc":"","x":127.56666564941406,"y":630.2999877929688,"wires":[["4eca34e6.d6511c"]]},{"id":"c1934019.af6178","type":"mongodb in","z":"be250337.39add8","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":437.566650390625,"y":239.56666564941406,"wires":[["b07e977a.bcdd5"]]},{"id":"83b0f6f8.6dae1","type":"function","z":"be250337.39add8","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1,\"url\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":288.73291015625,"y":304.233642578125,"wires":[["c1934019.af6178"]]},{"id":"b07e977a.bcdd5","type":"function","z":"be250337.39add8","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":578.73291015625,"y":346.56666564941406,"wires":[["b343ac9e.ea5428"]]},{"id":"b343ac9e.ea5428","type":"function","z":"be250337.39add8","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1,\"location\":1,\"ip\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":727.5662841796875,"y":284.89991760253906,"wires":[["c24dec8a.d8646"]]},{"id":"c24dec8a.d8646","type":"mongodb in","z":"be250337.39add8","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":853.5662841796875,"y":402.89991760253906,"wires":[["40b308a5.f39ad"]]},{"id":"40b308a5.f39ad","type":"function","z":"be250337.39add8","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1050.5662841796875,"y":324.89991760253906,"wires":[["bce92745.e713b"]]},{"id":"bce92745.e713b","type":"function","z":"be250337.39add8","name":"creator","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif(nodei.location==\"external\")\n{\n    \n    msg.url=nodei.ip+\":\"+taski.port_external+   \"/\"+taski.url;\n    msg.payload=\"echo '\"+ msg.url+\"'\";\n\n}\nelse\n    {\n    \n        \n        if (nodei.arch==\"x86\")\n        {\n            msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n        }\n        else    \n        {\n        \n        msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n        }\n    \n            msg.url=\"127.0.0.1\"+\":\"+taski.port_external+   \"/\"+taski.url;\n\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":1182.73291015625,"y":202.56668090820312,"wires":[["51eaa09e.93ee08"]]},{"id":"afb12951.9987d","type":"http response","z":"ec56a6c9.7576e8","name":"","x":801.63330078125,"y":610.88330078125,"wires":[]},{"id":"4eca34e6.d6511c","type":"function","z":"ec56a6c9.7576e8","name":"ecg_proc","func":"msg.taskname=\"ecg_processing\";\nmsg.payload=\"ecg_processing\";\nreturn msg;","outputs":1,"noerr":0,"x":305.63330078125,"y":629.1666259765625,"wires":[["5245ecfd.dc87bc"]]},{"id":"360bd99b.3bacd6","type":"mongodb in","z":"ba0bb15e.7354e8","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":529.566650390625,"y":220.56666564941406,"wires":[["f9727de4.652538"]]},{"id":"13fc2d2.dd3cf53","type":"function","z":"ba0bb15e.7354e8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload;\n\nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":298.73298263549805,"y":233.23370361328125,"wires":[["360bd99b.3bacd6"]]},{"id":"f9727de4.652538","type":"function","z":"ba0bb15e.7354e8","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nmsg.nodename=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":745.7414321899414,"y":228.75676345825195,"wires":[[]]},{"id":"a415c9e2.f3f36","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":630.4666748046875,"y":613.183349609375,"wires":[["afb12951.9987d"]]},{"id":"7eaaf9fc.24588","type":"function","z":"ec56a6c9.7576e8","name":"test_proc","func":"msg.taskname=\"test_processing\";\nmsg.payload=\"test_processing\";\nreturn msg;","outputs":1,"noerr":0,"x":334.566650390625,"y":459.20001220703125,"wires":[["870dbd4d.dad4f8"]]},{"id":"ea8cb5a6.22d298","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":722.566650390625,"y":491.20001220703125,"wires":[["715d5cd2.cbb50c"]]},{"id":"715d5cd2.cbb50c","type":"http response","z":"ec56a6c9.7576e8","name":"","x":940.63330078125,"y":491.88331604003906,"wires":[]},{"id":"93b2a61f.c6889","type":"http in","z":"ec56a6c9.7576e8","name":"","url":"/alloc_trop_p","method":"get","swaggerDoc":"","x":101.56666564941406,"y":769.2000122070312,"wires":[["8e72dba7.474ed"]]},{"id":"8e72dba7.474ed","type":"function","z":"ec56a6c9.7576e8","name":"trop_proc","func":"msg.taskname=\"troponin_processing\";\nmsg.payload=\"troponin_processing\";\nreturn msg;","outputs":1,"noerr":0,"x":352.5,"y":759.5333862304688,"wires":[[]]},{"id":"bf66b18.36a64d","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":718.5,"y":755.5333862304688,"wires":[["4d9cd95e.bf10c8"]]},{"id":"4d9cd95e.bf10c8","type":"http response","z":"ec56a6c9.7576e8","name":"","x":894.5666809082031,"y":770.2166900634766,"wires":[]},{"id":"57c3c556.6b310c","type":"http in","z":"ec56a6c9.7576e8","name":"","url":"/alloc_trop_db","method":"get","swaggerDoc":"","x":107.56666564941406,"y":856.2000122070312,"wires":[["31403a4a.cd3e66"]]},{"id":"31403a4a.cd3e66","type":"function","z":"ec56a6c9.7576e8","name":"trop_db","func":"msg.taskname=\"mongo_troponin\";\nmsg.payload=\"mongo_troponin\";\nreturn msg;","outputs":1,"noerr":0,"x":395.5,"y":833.5333862304688,"wires":[["b0630c40.bfa61"]]},{"id":"91b2b61e.5cd2","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":735.5000152587891,"y":862.5333862304688,"wires":[["1d59e079.a6701"]]},{"id":"1d59e079.a6701","type":"http response","z":"ec56a6c9.7576e8","name":"","x":900.5666809082031,"y":857.2166900634766,"wires":[]},{"id":"9c354738.8f3a7","type":"http in","z":"ec56a6c9.7576e8","name":"","url":"/alloc_ecg_db","method":"get","swaggerDoc":"","x":98,"y":932.2000122070312,"wires":[["3c3bd3af.f974cc"]]},{"id":"3c3bd3af.f974cc","type":"function","z":"ec56a6c9.7576e8","name":"ecg_db","func":"msg.taskname=\"mongo_ecg\";\nmsg.payload=\"mongo_ecg\";\nreturn msg;","outputs":1,"noerr":0,"x":351.50001525878906,"y":915.5333862304688,"wires":[["28f0ad70.6cca12"]]},{"id":"7d361d6b.1de1fc","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":727.5,"y":949.5333862304688,"wires":[["56d7c34e.6ea79c"]]},{"id":"56d7c34e.6ea79c","type":"http response","z":"ec56a6c9.7576e8","name":"","x":893.5666809082031,"y":923.2166900634766,"wires":[]},{"id":"956d5a95.0aef","type":"mongodb in","z":"18e20988.4c4aa6","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":422.8337211608887,"y":203.56666564941406,"wires":[["9d331a3a.ce709"]]},{"id":"e9eda326.c91c38","type":"function","z":"18e20988.4c4aa6","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":163.99998474121094,"y":192.23367643356323,"wires":[["956d5a95.0aef"]]},{"id":"9d331a3a.ce709","type":"function","z":"18e20988.4c4aa6","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":718.0002708435059,"y":184.2332248687744,"wires":[["66a09a7b.e90884"]]},{"id":"4d3fc3b.d53cabc","type":"mongodb in","z":"18e20988.4c4aa6","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":1624.9769706726074,"y":189.21014404296875,"wires":[["1d17024b.19d54e"]]},{"id":"4855e96d.799d38","type":"function","z":"18e20988.4c4aa6","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1458.1431007385254,"y":190.87741088867188,"wires":[["4d3fc3b.d53cabc"]]},{"id":"66a09a7b.e90884","type":"function","z":"18e20988.4c4aa6","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":951.5004539489746,"y":192.23333740234375,"wires":[["569551b2.129e1"]]},{"id":"569551b2.129e1","type":"mongodb in","z":"18e20988.4c4aa6","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1108.5002708435059,"y":192.2333369255066,"wires":[["b004b013.bebf1"]]},{"id":"b004b013.bebf1","type":"function","z":"18e20988.4c4aa6","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1260.0002784729004,"y":192.23348999023438,"wires":[["4855e96d.799d38"]]},{"id":"1d17024b.19d54e","type":"function","z":"18e20988.4c4aa6","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1793.476650238037,"y":189.70982551574707,"wires":[["634f55a5.f832c4"]]},{"id":"634f55a5.f832c4","type":"function","z":"18e20988.4c4aa6","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=[];\n\nvar keys = Object.keys(mapped);\n\n\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<keys.length;j++)\n    {\n        if (mapped[j].node==nodes[i])\n        {\n             result.push(mapped[keys[j]]);\n        }\n    }\n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1979.978515625,"y":192.7100372314453,"wires":[["284db5bb.d266ea"]]},{"id":"284db5bb.d266ea","type":"function","z":"18e20988.4c4aa6","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nmsg.nodename=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2193.04150390625,"y":184.7567596435547,"wires":[[]]},{"id":"5245ecfd.dc87bc","type":"subflow:18e20988.4c4aa6","z":"ec56a6c9.7576e8","x":458.63331604003906,"y":635.7166595458984,"wires":[["a415c9e2.f3f36"]]},{"id":"870dbd4d.dad4f8","type":"subflow:18e20988.4c4aa6","z":"ec56a6c9.7576e8","x":529.566650390625,"y":521.2000122070312,"wires":[["ea8cb5a6.22d298"]]},{"id":"b5539873.441c9","type":"mongodb in","z":"ae2b9df3.28132","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":367.566650390625,"y":165.56666564941406,"wires":[["17923248.267b46"]]},{"id":"55e9f4b4.13eca4","type":"function","z":"ae2b9df3.28132","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":231.73291015625,"y":91.23367309570312,"wires":[["b5539873.441c9"]]},{"id":"17923248.267b46","type":"function","z":"ae2b9df3.28132","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":662.7332000732422,"y":146.2332248687744,"wires":[["d314bf83.76ec3"]]},{"id":"996a000a.ced278","type":"mongodb in","z":"ae2b9df3.28132","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":1569.7098999023438,"y":151.21014404296875,"wires":[["e6d186f2.c787e8"]]},{"id":"65e63411.99447c","type":"function","z":"ae2b9df3.28132","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1402.8760299682617,"y":152.87741088867188,"wires":[["996a000a.ced278"]]},{"id":"d314bf83.76ec3","type":"function","z":"ae2b9df3.28132","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":896.2333831787109,"y":154.23333740234375,"wires":[["773d4300.2190ec"]]},{"id":"773d4300.2190ec","type":"mongodb in","z":"ae2b9df3.28132","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1053.2332000732422,"y":154.2333369255066,"wires":[["dfc8d46b.7e9a98"]]},{"id":"dfc8d46b.7e9a98","type":"function","z":"ae2b9df3.28132","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1204.7332077026367,"y":154.23348999023438,"wires":[["65e63411.99447c"]]},{"id":"e6d186f2.c787e8","type":"function","z":"ae2b9df3.28132","name":"max speed","func":"\n\nvar result = [];\nvar keys = Object.keys(msg.payload);\nvar max=0;\n\nfor(var i =0; i<keys.length;i++)\n{\n  if(msg.payload[keys[i]].processing_speed>max) \n  {\n      result.push(msg.payload[keys[i]]);\n  }\n}\n\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n\n","outputs":1,"noerr":0,"x":1728.2095794677734,"y":151.70982551574707,"wires":[["41710aa7.b9968c"]]},{"id":"41710aa7.b9968c","type":"function","z":"ae2b9df3.28132","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=[];\n\nvar keys = Object.keys(mapped);\n\n\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<keys.length;j++)\n    {\n        if (mapped[j].node==nodes[i])\n        {\n             result.push(mapped[keys[j]]);\n        }\n    }\n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1924.7114448547363,"y":154.7100372314453,"wires":[["e3cc0ea3.0eb178"]]},{"id":"e3cc0ea3.0eb178","type":"function","z":"ae2b9df3.28132","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nmsg.nodename=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2083.566650390625,"y":214.56666564941406,"wires":[[]]},{"id":"9454fb17.2b23b8","type":"subflow:15baf860.7fdb18","z":"ec56a6c9.7576e8","x":523.6333160400391,"y":760.4499969482422,"wires":[[]]},{"id":"3fd8b7cb.4ff558","type":"mongodb in","z":"15baf860.7fdb18","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":1732.8333740234375,"y":191.56666564941406,"wires":[["5c8e7b2.fcc5a84"]]},{"id":"242d8a29.f53196","type":"function","z":"15baf860.7fdb18","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1473.9996376037598,"y":180.23367643356323,"wires":[["3fd8b7cb.4ff558"]]},{"id":"5c8e7b2.fcc5a84","type":"function","z":"15baf860.7fdb18","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2027.9999237060547,"y":172.2332248687744,"wires":[["c520a119.68cdd8"]]},{"id":"70394676.b5ecd","type":"mongodb in","z":"15baf860.7fdb18","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":2934.9766235351562,"y":177.21014404296875,"wires":[["251cb309.2e5ee4"]]},{"id":"71f1a786.172cd","type":"function","z":"15baf860.7fdb18","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":2768.142753601074,"y":178.87741088867188,"wires":[["70394676.b5ecd"]]},{"id":"c520a119.68cdd8","type":"function","z":"15baf860.7fdb18","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par, arch:\"arm\"};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":2261.5001068115234,"y":180.23333740234375,"wires":[["9ee7f6f.8f8ba88"]]},{"id":"9ee7f6f.8f8ba88","type":"mongodb in","z":"15baf860.7fdb18","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":2418.4999237060547,"y":180.2333369255066,"wires":[["b78143d2.769f78"]]},{"id":"b78143d2.769f78","type":"function","z":"15baf860.7fdb18","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2569.999931335449,"y":180.23348999023438,"wires":[["71f1a786.172cd"]]},{"id":"251cb309.2e5ee4","type":"function","z":"15baf860.7fdb18","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":3103.476303100586,"y":177.70982551574707,"wires":[["52f20cc5.578e1c"]]},{"id":"52f20cc5.578e1c","type":"function","z":"15baf860.7fdb18","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=[];\n\nvar keys = Object.keys(mapped);\n\n\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<keys.length;j++)\n    {\n        if (mapped[j].node==nodes[i])\n        {\n             result.push(mapped[keys[j]]);\n        }\n    }\n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":3289.978168487549,"y":180.7100372314453,"wires":[["b2363d59.e3a61"]]},{"id":"b2363d59.e3a61","type":"function","z":"15baf860.7fdb18","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nmsg.nodename=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":3503.041156768799,"y":172.7567596435547,"wires":[[]]},{"id":"bf8aaa26.f3db2","type":"mongodb in","z":"f0da5b33.1135d8","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":483.566650390625,"y":203.56666564941406,"wires":[["368a282b.5b8d38"]]},{"id":"d98829f6.869b68","type":"function","z":"f0da5b33.1135d8","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":224.73291397094727,"y":192.23367643356323,"wires":[["bf8aaa26.f3db2"]]},{"id":"368a282b.5b8d38","type":"function","z":"f0da5b33.1135d8","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":778.7332000732422,"y":184.2332248687744,"wires":[["5354bd8c.c0b3dc"]]},{"id":"6213bef2.526a18","type":"mongodb in","z":"f0da5b33.1135d8","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":1685.7098999023438,"y":189.21014404296875,"wires":[["9b5ccc23.895fc8"]]},{"id":"4f2cd5da.f4cf84","type":"function","z":"f0da5b33.1135d8","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1518.8760299682617,"y":190.87741088867188,"wires":[["6213bef2.526a18"]]},{"id":"5354bd8c.c0b3dc","type":"function","z":"f0da5b33.1135d8","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par, arch:\"x86\"};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1012.2333831787109,"y":192.23333740234375,"wires":[["70c6e977.2b4a18"]]},{"id":"70c6e977.2b4a18","type":"mongodb in","z":"f0da5b33.1135d8","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1169.2332000732422,"y":192.2333369255066,"wires":[["58863764.c81c38"]]},{"id":"58863764.c81c38","type":"function","z":"f0da5b33.1135d8","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1320.7332077026367,"y":192.23348999023438,"wires":[["4f2cd5da.f4cf84"]]},{"id":"9b5ccc23.895fc8","type":"function","z":"f0da5b33.1135d8","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1854.2095794677734,"y":189.70982551574707,"wires":[["d9e58b28.ff7b58"]]},{"id":"d9e58b28.ff7b58","type":"function","z":"f0da5b33.1135d8","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=[];\n\nvar keys = Object.keys(mapped);\n\n\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<keys.length;j++)\n    {\n        if (mapped[j].node==nodes[i])\n        {\n             result.push(mapped[keys[j]]);\n        }\n    }\n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2040.7114448547363,"y":192.7100372314453,"wires":[["2a071559.d7b192"]]},{"id":"2a071559.d7b192","type":"function","z":"f0da5b33.1135d8","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nmsg.nodename=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2253.7744331359863,"y":184.7567596435547,"wires":[[]]},{"id":"28f0ad70.6cca12","type":"subflow:f0da5b33.1135d8","z":"ec56a6c9.7576e8","x":552.63330078125,"y":981.316650390625,"wires":[["7d361d6b.1de1fc"]]},{"id":"b0630c40.bfa61","type":"subflow:f0da5b33.1135d8","z":"ec56a6c9.7576e8","x":532.6333160400391,"y":900.3166656494141,"wires":[["91b2b61e.5cd2"]]},{"id":"2f0c47e2.7d922","type":"http in","z":"ec56a6c9.7576e8","name":"","url":"/mapper_first","method":"get","swaggerDoc":"","x":140.56666564941406,"y":1097.199951171875,"wires":[["dfd5e363.ed7ef8"]]},{"id":"dfd5e363.ed7ef8","type":"function","z":"ec56a6c9.7576e8","name":"test_proc","func":"var tsk=msg.req.query.task; \nmsg.taskname=tsk;\nmsg.payload=tsk;\nreturn msg;","outputs":1,"noerr":0,"x":383.5,"y":1153.5333251953125,"wires":[["4e916d6e.40d234"]]},{"id":"82137a44.7cd908","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":748.5,"y":1109.5333251953125,"wires":[["f33da6cb.6820e8"]]},{"id":"f33da6cb.6820e8","type":"http response","z":"ec56a6c9.7576e8","name":"","x":954.566650390625,"y":1066.2166137695312,"wires":[]},{"id":"4e916d6e.40d234","type":"subflow:18e20988.4c4aa6","z":"ec56a6c9.7576e8","x":551.5,"y":1105.5333251953125,"wires":[["82137a44.7cd908"]]},{"id":"b4e03813.233b","type":"subflow:15baf860.7fdb18","z":"ec56a6c9.7576e8","x":567.566650390625,"y":1221.86669921875,"wires":[["a8e74772.1d517"]]},{"id":"3f44992d.dcd976","type":"http in","z":"ec56a6c9.7576e8","name":"","url":"/mapper_arm","method":"get","swaggerDoc":"","x":136.56666564941406,"y":1247.86669921875,"wires":[["800314ac.0fb6e"]]},{"id":"800314ac.0fb6e","type":"function","z":"ec56a6c9.7576e8","name":"test_proc","func":"var tsk=msg.req.query.task; \nmsg.taskname=tsk;\nmsg.payload=tsk;\nreturn msg;","outputs":1,"noerr":0,"x":379.5,"y":1304.2000732421875,"wires":[["b4e03813.233b"]]},{"id":"a8e74772.1d517","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":744.5,"y":1260.2000732421875,"wires":[["86144532.6cb3d8"]]},{"id":"86144532.6cb3d8","type":"http response","z":"ec56a6c9.7576e8","name":"","x":946.566650390625,"y":1187.8833618164062,"wires":[]},{"id":"263b2667.b20d42","type":"http in","z":"ec56a6c9.7576e8","name":"","url":"/mapper_x86","method":"get","swaggerDoc":"","x":95,"y":1377.199951171875,"wires":[["c709ca7e.fab13"]]},{"id":"c709ca7e.fab13","type":"function","z":"ec56a6c9.7576e8","name":"test_proc","func":"var tsk=msg.req.query.task; \nmsg.taskname=tsk;\nmsg.payload=tsk;\nreturn msg;","outputs":1,"noerr":0,"x":337.93333435058594,"y":1433.5333251953125,"wires":[["9d6d2464.352c4"]]},{"id":"d481f855.4458b","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":702.9333343505859,"y":1389.5333251953125,"wires":[["ca4a6d52.fb6158"]]},{"id":"ca4a6d52.fb6158","type":"http response","z":"ec56a6c9.7576e8","name":"","x":917,"y":1338.2166290283203,"wires":[]},{"id":"9d6d2464.352c4","type":"subflow:f0da5b33.1135d8","z":"ec56a6c9.7576e8","x":526.566650390625,"y":1380.566650390625,"wires":[["d481f855.4458b"]]},{"id":"5d0468fa.2424d8","type":"subflow:ae2b9df3.28132","z":"ec56a6c9.7576e8","x":534.4666748046875,"y":1575.7499389648438,"wires":[["d6efe495.3004d8"]]},{"id":"4fdcf65d.237cb8","type":"http in","z":"ec56a6c9.7576e8","name":"","url":"/mapper_fastest","method":"get","swaggerDoc":"","x":174,"y":1589.1332397460938,"wires":[["7637ea9c.a3cfac"]]},{"id":"7637ea9c.a3cfac","type":"function","z":"ec56a6c9.7576e8","name":"test_proc","func":"var tsk=msg.req.query.task; \nmsg.taskname=tsk;\nmsg.payload=tsk;\nreturn msg;","outputs":1,"noerr":0,"x":337.93333435058594,"y":1656.466552734375,"wires":[["5d0468fa.2424d8"]]},{"id":"d6efe495.3004d8","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":702.9333343505859,"y":1612.466552734375,"wires":[["b0cbc75d.7385a8"]]},{"id":"b0cbc75d.7385a8","type":"http response","z":"ec56a6c9.7576e8","name":"","x":917,"y":1561.1498565673828,"wires":[]},{"id":"6bbc3ee6.9f0618","type":"switch","z":"ec56a6c9.7576e8","name":"algorithm","property":"alg","propertyType":"msg","rules":[{"t":"eq","v":"first","vt":"str"},{"t":"eq","v":"fastest","vt":"str"},{"t":"eq","v":"arm","vt":"str"},{"t":"eq","v":"x86","vt":"str"},{"t":"eq","v":"ram","vt":"str"}],"checkall":"true","outputs":5,"x":279.63330078125,"y":2096.166748046875,"wires":[["712cff4a.1d7bf"],["b8decc91.f65018"],["170397a4.98837"],["9cf962d9.ffeb6"],["72cfa0e0.cb4bd8"]]},{"id":"ead16c55.3c6f1","type":"http in","z":"ec56a6c9.7576e8","name":"","url":"/mapalg","method":"get","swaggerDoc":"","x":107.09999084472656,"y":1851.61669921875,"wires":[["f1ce2514.2a4138"]]},{"id":"f1ce2514.2a4138","type":"function","z":"ec56a6c9.7576e8","name":"test_proc","func":"var tsk=msg.req.query.task; \nvar alg=msg.req.query.algorithm; \nflow.set('tsk',tsk);\nflow.set('alg',alg);\nmsg.alg=alg;\n\nreturn msg;","outputs":1,"noerr":0,"x":301.0333251953125,"y":1767.949951171875,"wires":[["6bbc3ee6.9f0618"]]},{"id":"e147cfd1.bdc888","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":1044.0333251953125,"y":1763.949951171875,"wires":[["6b45ac96.c7490c"]]},{"id":"6b45ac96.c7490c","type":"http response","z":"ec56a6c9.7576e8","name":"","x":1208.0999755859375,"y":1782.63330078125,"wires":[]},{"id":"712cff4a.1d7bf","type":"function","z":"ec56a6c9.7576e8","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":712.566650390625,"y":1786.933349609375,"wires":[["2718cebe.8315d2"]]},{"id":"3ca0b282.92d02e","type":"subflow:ae2b9df3.28132","z":"ec56a6c9.7576e8","x":817.566650390625,"y":1925.933349609375,"wires":[["b1a4a78a.3858f"]]},{"id":"b1a4a78a.3858f","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":959.0333251953125,"y":1978.64990234375,"wires":[["b5c40fb6.cb8fd"]]},{"id":"b5c40fb6.cb8fd","type":"http response","z":"ec56a6c9.7576e8","name":"","x":1206.0999755859375,"y":1933.333267211914,"wires":[]},{"id":"b8decc91.f65018","type":"function","z":"ec56a6c9.7576e8","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":662.566650390625,"y":1913.63330078125,"wires":[["3ca0b282.92d02e"]]},{"id":"2718cebe.8315d2","type":"subflow:18e20988.4c4aa6","z":"ec56a6c9.7576e8","x":887.566650390625,"y":1785.566650390625,"wires":[["e147cfd1.bdc888"]]},{"id":"b7affebc.83e4e","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":910.0999755859375,"y":2089.0166015625,"wires":[["3065640b.b9f77c"]]},{"id":"3065640b.b9f77c","type":"http response","z":"ec56a6c9.7576e8","name":"","x":1157.1666259765625,"y":2043.699966430664,"wires":[]},{"id":"170397a4.98837","type":"function","z":"ec56a6c9.7576e8","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":651.63330078125,"y":1985,"wires":[["7b1873d8.bcc09c"]]},{"id":"e2fd15e8.6a7888","type":"subflow:f0da5b33.1135d8","z":"ec56a6c9.7576e8","x":757.63330078125,"y":2146.7996826171875,"wires":[["2af095e4.b09d3a"]]},{"id":"7b1873d8.bcc09c","type":"subflow:15baf860.7fdb18","z":"ec56a6c9.7576e8","x":815.63330078125,"y":2028.66650390625,"wires":[["b7affebc.83e4e"]]},{"id":"9cf962d9.ffeb6","type":"function","z":"ec56a6c9.7576e8","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":603.63330078125,"y":2109.66650390625,"wires":[["e2fd15e8.6a7888"]]},{"id":"2af095e4.b09d3a","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":921.63330078125,"y":2162.66650390625,"wires":[["fa9432a2.923778"]]},{"id":"fa9432a2.923778","type":"http response","z":"ec56a6c9.7576e8","name":"","x":1168.699951171875,"y":2117.349868774414,"wires":[]},{"id":"e10854ef.89ff48","type":"function","z":"a4c6f2a3.7f305","name":"command creator","func":"var task=msg.req.query.task;\nmsg.payload=\"sudo docker service rm \"+task;\nreturn msg;","outputs":1,"noerr":0,"x":434.566650390625,"y":180.56666564941406,"wires":[["2732fe8c.2c9e62"]]},{"id":"55528e5f.67045","type":"subflow:a4c6f2a3.7f305","z":"ec56a6c9.7576e8","x":521.63330078125,"y":201.5833282470703,"wires":[["2e19b07d.28ce78"]]},{"id":"fafe1c7b.1ed2c","type":"function","z":"ec56a6c9.7576e8","name":"input_format","func":"var task=msg.req.query.task;\nvar node=msg.req.query.node;\n\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":348,"y":310,"wires":[["76bd1f1d.00b62"]]},{"id":"d6159926.17b1c8","type":"http in","z":"ec56a6c9.7576e8","name":"","url":"/mapper","method":"get","swaggerDoc":"","x":140,"y":310,"wires":[["fafe1c7b.1ed2c"]]},{"id":"1ac6718e.b98b56","type":"http response","z":"ec56a6c9.7576e8","name":"","x":757,"y":356.9999694824219,"wires":[]},{"id":"76bd1f1d.00b62","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":517.4666748046875,"y":309.2833251953125,"wires":[["1ac6718e.b98b56"]]},{"id":"a4724511.7d1b3","type":"mongodb in","z":"3bf728d9.ffd948","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":1719.0999755859375,"y":309.566650390625,"wires":[["7d3a342f.f75484"]]},{"id":"9b1c7193.5d0a68","type":"function","z":"3bf728d9.ffd948","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1583.2662353515625,"y":235.23365783691406,"wires":[["a4724511.7d1b3"]]},{"id":"7d3a342f.f75484","type":"function","z":"3bf728d9.ffd948","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2014.2665252685547,"y":290.23320960998535,"wires":[["3c6228d2.d5e62"]]},{"id":"195c15aa.00673a","type":"mongodb in","z":"3bf728d9.ffd948","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":2918.2431640625,"y":397.21014404296875,"wires":[["f4044c23.aa709"]]},{"id":"422d612c.a88918","type":"function","z":"3bf728d9.ffd948","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":2754.409355163574,"y":296.8773956298828,"wires":[["195c15aa.00673a"]]},{"id":"3c6228d2.d5e62","type":"function","z":"3bf728d9.ffd948","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par};\nmsg.projection = {\"_id\":0, \"id\":1,\"ram\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":2247.7667083740234,"y":298.2333221435547,"wires":[["dd37652e.d8eaf8"]]},{"id":"dd37652e.d8eaf8","type":"mongodb in","z":"3bf728d9.ffd948","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":2404.7665252685547,"y":298.23332166671753,"wires":[["383cb90e.36fdb6"]]},{"id":"383cb90e.36fdb6","type":"function","z":"3bf728d9.ffd948","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2556.266532897949,"y":298.2334747314453,"wires":[["422d612c.a88918"]]},{"id":"f4044c23.aa709","type":"function","z":"3bf728d9.ffd948","name":"mapped","func":"\n\nvar result = [];\nvar keys = Object.keys(msg.payload);\n\n\nfor(var i =0; i<keys.length;i++)\n{\n \n      result.push(msg.payload[keys[i]]);\n}\n\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n\n","outputs":1,"noerr":0,"x":3102.742919921875,"y":366.70977783203125,"wires":[["55a07098.625ef"]]},{"id":"55a07098.625ef","type":"function","z":"3bf728d9.ffd948","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result={};\n\nvar keys2 = Object.keys(nodes);\nvar keys = Object.keys(mapped);\nvar max=0;\n\n\nfor(var i=0; i<keys.length;i++)\n{  \n    for(var j =0; j<keys2.length;j++)\n    {\n        if (mapped[keys[i]].node==nodes[keys2[j]].id)\n        {\n            if(nodes[keys2[j]].ram>max)\n            {\n             max=nodes[keys2[j]].ram;    \n             result=nodes[keys2[j]];\n            }\n                    \n        }\n    }\n    \n}\n\nmsg.payload=result.id;\nmsg.nodename=result.id;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":3362.244873046875,"y":317.71002197265625,"wires":[[]]},{"id":"72cfa0e0.cb4bd8","type":"function","z":"ec56a6c9.7576e8","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":584.566650390625,"y":2224.0001220703125,"wires":[["ba6cf206.0a2158"]]},{"id":"effbe897.225768","type":"subflow:be250337.39add8","z":"ec56a6c9.7576e8","x":932.566650390625,"y":2272,"wires":[["ef17ea6e.14db3"]]},{"id":"ef17ea6e.14db3","type":"http response","z":"ec56a6c9.7576e8","name":"","x":1149.63330078125,"y":2231.6834869384766,"wires":[]},{"id":"ba6cf206.0a2158","type":"subflow:3bf728d9.ffd948","z":"ec56a6c9.7576e8","name":"","x":740.4666748046875,"y":2303.11669921875,"wires":[["effbe897.225768"]]},{"id":"2732fe8c.2c9e62","type":"exec","z":"a4c6f2a3.7f305","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":627.6333160400391,"y":185.8666534423828,"wires":[[],[],[]]},{"id":"51eaa09e.93ee08","type":"exec","z":"be250337.39add8","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1273.633316040039,"y":269.46665954589844,"wires":[[],[],[]]},{"id":"951e89ef.1f2158","type":"function","z":"13320c0d.add27c","name":"input_format","func":"var task=\"test_processing\";\nvar node=\"rpi2\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":548.566650390625,"y":249.56666564941406,"wires":[["9db6d1ed.3eca7"]]},{"id":"9db6d1ed.3eca7","type":"subflow:be250337.39add8","z":"13320c0d.add27c","x":681.0333251953125,"y":156.84999084472656,"wires":[["db2f13d7.a275f"]]},{"id":"52247f36.ad8248","type":"inject","z":"13320c0d.add27c","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":157.63331604003906,"y":213.8666534423828,"wires":[["ce44085c.50b28"]]},{"id":"db2f13d7.a275f","type":"debug","z":"13320c0d.add27c","name":"","active":true,"console":"false","complete":"false","x":890.4666748046875,"y":236.2166290283203,"wires":[]},{"id":"9bd06d5f.b6df18","type":"function","z":"13320c0d.add27c","name":"input_format","func":"var task=\"ecg_processing\";\nvar node=\"pc1\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":375.566650390625,"y":495.566650390625,"wires":[["7aea47cf.9f413"]]},{"id":"7aea47cf.9f413","type":"subflow:be250337.39add8","z":"13320c0d.add27c","x":549.0333251953125,"y":380.84999084472656,"wires":[["89a0278b.077d9"]]},{"id":"2fe70f2f.afa7c8","type":"inject","z":"13320c0d.add27c","name":"bind ecg","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":125.63331604003906,"y":372.86663818359375,"wires":[["7000159d.7fc524"]]},{"id":"89a0278b.077d9","type":"debug","z":"13320c0d.add27c","name":"","active":true,"console":"false","complete":"false","x":884.4666748046875,"y":456.21661376953125,"wires":[]},{"id":"a0f36021.37bef8","type":"function","z":"13320c0d.add27c","name":"input_format","func":"var task=\"troponin_processing\";\nvar node=\"rpi1\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":457.566650390625,"y":690.566650390625,"wires":[["3a876d03.7202f2"]]},{"id":"3a876d03.7202f2","type":"subflow:be250337.39add8","z":"13320c0d.add27c","name":"","x":584.0333251953125,"y":587.8499755859375,"wires":[["cdd04253.97bda"]]},{"id":"89bd89c1.115f","type":"inject","z":"13320c0d.add27c","name":"bind troponin","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":154.63331604003906,"y":568.86669921875,"wires":[["9d25ad27.5e9438"]]},{"id":"cdd04253.97bda","type":"debug","z":"13320c0d.add27c","name":"","active":true,"console":"false","complete":"false","x":835.4666748046875,"y":601.2166748046875,"wires":[]},{"id":"ce44085c.50b28","type":"delay","z":"13320c0d.add27c","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":342.63330078125,"y":136.7666778564453,"wires":[["951e89ef.1f2158"]]},{"id":"7000159d.7fc524","type":"delay","z":"13320c0d.add27c","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":323.63330078125,"y":368.76666259765625,"wires":[["9bd06d5f.b6df18"]]},{"id":"9d25ad27.5e9438","type":"delay","z":"13320c0d.add27c","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320.63330078125,"y":621.7666625976562,"wires":[["a0f36021.37bef8"]]},{"id":"7ff879a0.dff78","type":"http request","z":"bc3468b7.122e3","name":"","method":"GET","ret":"txt","url":"","tls":"","x":939.566650390625,"y":503.566650390625,"wires":[[]]},{"id":"6b2a2e59.bcbcc8","type":"mongodb in","z":"bc3468b7.122e3","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":316.566650390625,"y":340.566650390625,"wires":[["566b2142.84e52"]]},{"id":"934c5ec9.6f8e8","type":"function","z":"bc3468b7.122e3","name":"query task","func":"msg.limit = 5;\n\nmsg.skip = 0;\nvar task=msg.payload;\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1,\"url\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":199.73292541503906,"y":447.233642578125,"wires":[["6b2a2e59.bcbcc8"]]},{"id":"566b2142.84e52","type":"function","z":"bc3468b7.122e3","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nmsg.payload=result;\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":489.73291015625,"y":408.566650390625,"wires":[["b5c84e58.d60e48"]]},{"id":"b5c84e58.d60e48","type":"function","z":"bc3468b7.122e3","name":"creator","func":"\nvar taski=msg.payload;\n\nmsg.url=\"127.0.0.1\"+\":\"+taski.port_external+   \"/\"+taski.url;\n\nreturn msg;","outputs":1,"noerr":0,"x":737.73291015625,"y":367.566650390625,"wires":[["7ff879a0.dff78"]]},{"id":"6f047a70.e7bb94","type":"http request","z":"473afc0d.5d627c","name":"","method":"GET","ret":"txt","url":"","tls":"","x":634.566650390625,"y":145.56666564941406,"wires":[[]]},{"id":"43f8466f.9817b","type":"function","z":"473afc0d.5d627c","name":"url_maker_troponin","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.req.query.patient; \nvar service_location=\"127.0.0.1:32767/t_value\"\nmsg.url=service_location+\"?patient=\"+patient;\nreturn msg;\n","outputs":1,"noerr":0,"x":366.066650390625,"y":178.56666564941406,"wires":[["6f047a70.e7bb94"]]},{"id":"e54017f1.41b3a","type":"http request","z":"7dd2ebc8.99663c","name":"","method":"GET","ret":"txt","url":"","tls":"","x":477.566650390625,"y":161.56666564941406,"wires":[[]]},{"id":"4ac5445f.677a54","type":"function","z":"7dd2ebc8.99663c","name":"url_maker_troponin","func":"msg.limit = 5;\nmsg.skip = 0;\nvar patient=msg.patient; \nvar service_location=\"127.0.0.1:32768/e_value\"\nmsg.url=service_location+\"?patient=\"+patient;\nreturn msg;\n","outputs":1,"noerr":0,"x":241.06666564941406,"y":164.56666564941406,"wires":[["e54017f1.41b3a"]]},{"id":"e23a4fc1.6467a8","type":"function","z":"13320c0d.add27c","name":"input_format","func":"var task=\"ecg_read\";\nvar node=\"rpi1\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":465.566650390625,"y":815.566650390625,"wires":[["90a17dd9.56eb"]]},{"id":"90a17dd9.56eb","type":"subflow:be250337.39add8","z":"13320c0d.add27c","name":"","x":600.0333251953125,"y":786.8499755859375,"wires":[["f30f67a1.c6182"]]},{"id":"908cafd1.b85f","type":"inject","z":"13320c0d.add27c","name":"bind e_read","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":142.63331604003906,"y":782.86669921875,"wires":[["5ac4e7a9.2e50e8"]]},{"id":"f30f67a1.c6182","type":"debug","z":"13320c0d.add27c","name":"","active":true,"console":"false","complete":"false","x":820.4666748046875,"y":781.2166748046875,"wires":[]},{"id":"5ac4e7a9.2e50e8","type":"delay","z":"13320c0d.add27c","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":310.63330078125,"y":788.7666625976562,"wires":[["e23a4fc1.6467a8"]]},{"id":"1fbf1bcf.ff2b44","type":"function","z":"13320c0d.add27c","name":"input_format","func":"var task=\"troponin_read\";\nvar node=\"rpi2\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":446.93333435058594,"y":932.5,"wires":[["f8150684.d2c678"]]},{"id":"f8150684.d2c678","type":"subflow:be250337.39add8","z":"13320c0d.add27c","name":"","x":621.4000244140625,"y":952.7833251953125,"wires":[["c90e8c59.1e1098"]]},{"id":"13b27ae.cc76685","type":"inject","z":"13320c0d.add27c","name":"bind t_read","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":134,"y":899.800048828125,"wires":[["639fad45.6beb0c"]]},{"id":"c90e8c59.1e1098","type":"debug","z":"13320c0d.add27c","name":"","active":true,"console":"false","complete":"false","x":801.8333587646484,"y":898.1500244140625,"wires":[]},{"id":"639fad45.6beb0c","type":"delay","z":"13320c0d.add27c","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":291.99998474121094,"y":905.7000122070312,"wires":[["1fbf1bcf.ff2b44"]]},{"id":"70097a9a.1165bc","type":"http in","z":"54fb866.f5f9078","name":"","url":"/t_test_final","method":"get","swaggerDoc":"","x":120,"y":213.56666564941406,"wires":[["461d36b3.6c51"]]},{"id":"948523d.b41a0e","type":"http response","z":"54fb866.f5f9078","name":"","x":1266.5,"y":245.566650390625,"wires":[]},{"id":"67f0e902.6b122","type":"function","z":"54fb866.f5f9078","name":"insert troponin_result","func":"var troponin=msg.payload;\nvar patient=msg.req.query.patient; \nmsg.topic=\"INSERT INTO troponin_result(patient,result) values('\"+patient+\"',\"+troponin+\") \";\nreturn msg;","outputs":1,"noerr":0,"x":899,"y":384.566650390625,"wires":[["82c86760.1391f8"]]},{"id":"82c86760.1391f8","type":"mysql","z":"54fb866.f5f9078","mydb":"b43efa28.b858b8","name":"troponin_result","x":1095.3330078125,"y":286.233154296875,"wires":[["948523d.b41a0e"]]},{"id":"461d36b3.6c51","type":"subflow:473afc0d.5d627c","z":"54fb866.f5f9078","name":"","x":384.63330078125,"y":284.1833190917969,"wires":[["ba0532b4.3119f8"]]},{"id":"f3b71e37.979ce8","type":"http request","z":"2e1eeacc.7da106","name":"","method":"GET","ret":"txt","url":"","tls":"","x":606.566650390625,"y":161.56666564941406,"wires":[[]]},{"id":"2f7b897d.f08916","type":"function","z":"2e1eeacc.7da106","name":"url_maker_troponin","func":"msg.limit = 5;\nmsg.skip = 0;\nvar troponin_value=msg.payload; \nvar service_location=\"127.0.0.1:82/troponin.php\"\nmsg.url=service_location+\"?troponin=\"+troponin_value;\nreturn msg;\n","outputs":1,"noerr":0,"x":370.06664276123047,"y":150.56666564941406,"wires":[["f3b71e37.979ce8"]]},{"id":"8bcd6e75.f60a28","type":"http response","z":"54fb866.f5f9078","name":"","x":560.63330078125,"y":376.88330078125,"wires":[]},{"id":"f5363192.81555","type":"http response","z":"54fb866.f5f9078","name":"","x":772.63330078125,"y":305.88330078125,"wires":[]},{"id":"7a828625.90cd5","type":"http request","z":"54fb866.f5f9078","name":"","method":"GET","ret":"txt","url":"","tls":"","x":309.63331604003906,"y":499.8999786376953,"wires":[[]]},{"id":"979a2b43.4acaf8","type":"debug","z":"54fb866.f5f9078","name":"","active":true,"console":"false","complete":"false","x":618.63330078125,"y":183.0166778564453,"wires":[]},{"id":"ba0532b4.3119f8","type":"subflow:2e1eeacc.7da106","z":"54fb866.f5f9078","x":598.63330078125,"y":284.91668701171875,"wires":[["979a2b43.4acaf8"]]},{"id":"9e75bc33.2c1fc","type":"function","z":"17e92000.a81af","name":"input_format","func":"var task=\"test_processing\";\nvar node=\"rpi2\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":530.9333343505859,"y":213.79998779296875,"wires":[["37df2be4.78d4d4"]]},{"id":"37df2be4.78d4d4","type":"subflow:be250337.39add8","z":"17e92000.a81af","x":663.4000091552734,"y":121.08331298828125,"wires":[["49e10502.8e704c"]]},{"id":"9129ae3e.4c3208","type":"inject","z":"17e92000.a81af","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":178.0999755859375,"wires":[["1989fc41.da548c"]]},{"id":"49e10502.8e704c","type":"debug","z":"17e92000.a81af","name":"","active":true,"console":"false","complete":"false","x":917.8333740234375,"y":172.449951171875,"wires":[]},{"id":"1989fc41.da548c","type":"delay","z":"17e92000.a81af","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":324.99998474121094,"y":101,"wires":[["9e75bc33.2c1fc"]]},{"id":"6f654a76.3e798c","type":"file in","z":"425623ca.056c84","name":"","filename":"C:\\Users\\Acer\\Documents\\BINDING","format":"utf8","x":379.765625,"y":175.75,"wires":[["ea775b59.cc5e9"]]},{"id":"6b852723.f4ca8","type":"inject","z":"425623ca.056c84","name":"","topic":"","payload":" ","payloadType":"str","repeat":"","crontab":"","once":false,"x":120.7656021118164,"y":244.08331680297852,"wires":[["6f654a76.3e798c"]]},{"id":"ba101639.ff4bd8","type":"function","z":"425623ca.056c84","name":"processing","func":"var result={};\n\nfor(var i =0; i<msg.payload.length;i++)\n{\n    if(msg.payload[i].name==\"input_format\")\n    {\n    msg.payload[i].func='var task=\\\"ecg3_processing\\\";\\nvar node=\\\"rp3i4\\\";\\nmsg.payload=\\\"\\\";\\nmsg.nodename=node;\\nmsg.taskname=task;\\n\\nreturn msg;';\n    result=msg.payload[i];\n    }\n}\n\nreturn msg;\n","outputs":1,"noerr":0,"x":782.2170639038086,"y":176.45156383514404,"wires":[["d5aa079f.e35088"]]},{"id":"ea775b59.cc5e9","type":"json","z":"425623ca.056c84","name":"","x":619.2135848999023,"y":243.5625991821289,"wires":[["ba101639.ff4bd8"]]},{"id":"d5aa079f.e35088","type":"file","z":"425623ca.056c84","name":"","filename":"C:\\Users\\Acer\\Documents\\BINDING22","appendNewline":true,"createDir":false,"overwriteFile":"true","x":1091.9323120117188,"y":228.59893822669983,"wires":[]},{"id":"19bd82fc.72494d","type":"http in","z":"425623ca.056c84","name":"","url":"/binding","method":"get","swaggerDoc":"","x":143.01173400878906,"y":450.6640930175781,"wires":[["f6a8e9f4.1ddf18"]]},{"id":"f6a8e9f4.1ddf18","type":"file in","z":"425623ca.056c84","name":"","filename":"C:\\Users\\Acer\\Documents\\BINDING","format":"utf8","x":447.765625,"y":403.75,"wires":[["5fe77e1a.a6702"]]},{"id":"5b7d550b.9afbd4","type":"function","z":"425623ca.056c84","name":"processing","func":"var result={};\nvar node=msg.req.query.node; \nvar task=msg.req.query.task;\n\n\nfor(var i =0; i<msg.payload.length;i++)\n{\n    if(msg.payload[i].name==\"input_format\")\n    {\n    msg.payload[i].func='var task=\\\"'+task+'\\\";\\nvar node=\\\"'+node+'\\\";\\nmsg.payload=\\\"\\\";\\nmsg.nodename=node;\\nmsg.taskname=task;\\n\\nreturn msg;';\n    result=msg.payload[i];\n    }\n}\n\nreturn msg;\n","outputs":1,"noerr":0,"x":850.2170639038086,"y":404.45156383514404,"wires":[["69342d9b.151b34","20a9034e.4ba5bc"]]},{"id":"5fe77e1a.a6702","type":"json","z":"425623ca.056c84","name":"","x":687.2135848999023,"y":471.5625991821289,"wires":[["5b7d550b.9afbd4"]]},{"id":"69342d9b.151b34","type":"file","z":"425623ca.056c84","name":"","filename":"C:\\Users\\Acer\\Documents\\BINDING234","appendNewline":true,"createDir":false,"overwriteFile":"true","x":1106.9322509765625,"y":500.59892654418945,"wires":[]},{"id":"20a9034e.4ba5bc","type":"http response","z":"425623ca.056c84","name":"","x":1092.8334045410156,"y":413.3333511352539,"wires":[]},{"id":"539c0521.eab1dc","type":"http request","z":"71066960.262a98","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1005.566650390625,"y":281.566650390625,"wires":[[]]},{"id":"94c7ff88.da474","type":"function","z":"71066960.262a98","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload;\nvar url_base=msg.url;\nvar final_url=url_base+\"?\";\n\n\n\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[["539c0521.eab1dc"]]},{"id":"27ef9e73.62b41a","type":"mongodb in","z":"71066960.262a98","mongodb":"a6de67d4.7656","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["b55b7945.402fd8"]]},{"id":"7aa20d2e.b17174","type":"function","z":"71066960.262a98","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"test_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["27ef9e73.62b41a"]]},{"id":"b55b7945.402fd8","type":"function","z":"71066960.262a98","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["94c7ff88.da474"]]},{"id":"bc07cb4.b7fe3b8","type":"http request","z":"f3dfe9b7.36946","name":"","method":"GET","ret":"txt","url":"","tls":"","x":490,"y":163,"wires":[[]]},{"id":"ab69faf0.b5883","type":"function","z":"f3dfe9b7.36946","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar ecg=msg.ec;\nvar troponin=msg.tr;\nvar service_location=\"127.0.0.1:83/test.php\";\nmsg.url=service_location+\"?ecg=\"+ecg+\"&troponin=\"+troponin;\nreturn msg;\n","outputs":1,"noerr":0,"x":287.5,"y":147,"wires":[["bc07cb4.b7fe3b8"]]},{"id":"5c611bd.96183e4","type":"mongodb in","z":"165bcb8.b1bba35","mongodb":"aa238f23.3e5d2","name":"tasks","collection":"tasks","operation":"find","x":437.566650390625,"y":239.56666564941406,"wires":[["2c79ac8b.81f334"]]},{"id":"d4c20650.77c19","type":"function","z":"165bcb8.b1bba35","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1,\"url\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":288.73291015625,"y":304.233642578125,"wires":[["5c611bd.96183e4"]]},{"id":"2c79ac8b.81f334","type":"function","z":"165bcb8.b1bba35","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":578.73291015625,"y":346.56666564941406,"wires":[["3fe6d7a2.1d157"]]},{"id":"3fe6d7a2.1d157","type":"function","z":"165bcb8.b1bba35","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1,\"location\":1,\"ip\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":727.5662841796875,"y":284.89991760253906,"wires":[["516582d9.45b264"]]},{"id":"516582d9.45b264","type":"mongodb in","z":"165bcb8.b1bba35","mongodb":"aa238f23.3e5d2","name":"nodes","collection":"nodes","operation":"find","x":853.5662841796875,"y":402.89991760253906,"wires":[["1f57628d.1a5215"]]},{"id":"1f57628d.1a5215","type":"function","z":"165bcb8.b1bba35","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1050.5662841796875,"y":324.89991760253906,"wires":[["61b602a0.c22abc"]]},{"id":"61b602a0.c22abc","type":"function","z":"165bcb8.b1bba35","name":"creator","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif(nodei.location==\"external\")\n{\n    \n    msg.url=nodei.ip+\":\"+taski.port_external+   \"/\"+taski.url;\n    msg.payload=\"echo '\"+ msg.url+\"'\";\n\n}\nelse\n    {\n    \n        \n        if (nodei.arch==\"x86\")\n        {\n            msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n        }\n        else    \n        {\n        \n        msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n        }\n    \n            msg.url=\"127.0.0.1\"+\":\"+taski.port_external+   \"/\"+taski.url;\n\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":1182.73291015625,"y":202.56668090820312,"wires":[["a978ff7f.95b938"]]},{"id":"a978ff7f.95b938","type":"exec","z":"165bcb8.b1bba35","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1273.633316040039,"y":269.46665954589844,"wires":[[],[],[]]},{"id":"163b5148.7199d7","type":"function","z":"270ec0a5.892f9","name":"input_format","func":"var task=\"test_processing\";\nvar node=\"rpi2\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":530.9333343505859,"y":213.79998779296875,"wires":[["ad08b793.5b1ed"]]},{"id":"ad08b793.5b1ed","type":"subflow:165bcb8.b1bba35","z":"270ec0a5.892f9","name":"","x":663.4000091552734,"y":121.08331298828125,"wires":[["f30844ab.9496a"]]},{"id":"799c2d9c.e3909c","type":"inject","z":"270ec0a5.892f9","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":178.0999755859375,"wires":[["ab83a2d0.02e338"]]},{"id":"f30844ab.9496a","type":"debug","z":"270ec0a5.892f9","name":"","active":true,"console":"false","complete":"false","x":917.8333740234375,"y":172.449951171875,"wires":[]},{"id":"ab83a2d0.02e338","type":"delay","z":"270ec0a5.892f9","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":324.99998474121094,"y":101,"wires":[["163b5148.7199d7"]]},{"id":"1b124a9.f972935","type":"mongodb in","z":"ee71f539.5b312","mongodb":"79c3a251.fae494","name":"tasks","collection":"tasks","operation":"find","x":437.566650390625,"y":239.56666564941406,"wires":[["bd3a25db.b5bbf8"]]},{"id":"ebec502f.344b3","type":"function","z":"ee71f539.5b312","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1,\"url\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":288.73291015625,"y":304.233642578125,"wires":[["1b124a9.f972935"]]},{"id":"bd3a25db.b5bbf8","type":"function","z":"ee71f539.5b312","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":578.73291015625,"y":346.56666564941406,"wires":[["bc6955e5.7d69"]]},{"id":"bc6955e5.7d69","type":"function","z":"ee71f539.5b312","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1,\"location\":1,\"ip\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":727.5662841796875,"y":284.89991760253906,"wires":[["c2b0563.c992da8"]]},{"id":"c2b0563.c992da8","type":"mongodb in","z":"ee71f539.5b312","mongodb":"79c3a251.fae494","name":"nodes","collection":"nodes","operation":"find","x":853.5662841796875,"y":402.89991760253906,"wires":[["50d17a4a.90cbc4"]]},{"id":"50d17a4a.90cbc4","type":"function","z":"ee71f539.5b312","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1050.5662841796875,"y":324.89991760253906,"wires":[["b6692522.758af"]]},{"id":"b6692522.758af","type":"function","z":"ee71f539.5b312","name":"creator","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif(nodei.location==\"external\")\n{\n    \n    msg.url=nodei.ip+\":\"+taskaaaaaai.port_external+   \"/\"+taski.url;\n    msg.payload=\"echo '\"+ msg.url+\"'\";\n\n}\nelse\n    {\n    \n        \n        if (nodei.arch==\"x86\")\n        {\n            msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n        }\n        else    \n        {\n        \n        msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n        }\n    \n            msg.url=\"127.0.0.1\"+\":\"+taski.port_external+   \"/\"+taski.url;\n\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":1182.73291015625,"y":202.56668090820312,"wires":[["7eb31306.0c1b4c"]]},{"id":"7eb31306.0c1b4c","type":"exec","z":"ee71f539.5b312","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1273.633316040039,"y":269.46665954589844,"wires":[[],[],[]]},{"id":"365ce449.3011ac","type":"function","z":"eb8d0c5a.8ab9e8","name":"input_format","func":"var task=\"trop_processing\";\nvar node=\"rpi3\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":530.9333419799805,"y":250.79998970031738,"wires":[["39988530.1c6932"]]},{"id":"39988530.1c6932","type":"subflow:ee71f539.5b312","z":"eb8d0c5a.8ab9e8","name":"","x":663.4000091552734,"y":121.08331298828125,"wires":[["cbadeb90.daa718"]]},{"id":"5c8b4fb9.3f6718","type":"inject","z":"eb8d0c5a.8ab9e8","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":178.0999755859375,"wires":[["8bfd8276.ed739"]]},{"id":"cbadeb90.daa718","type":"debug","z":"eb8d0c5a.8ab9e8","name":"","active":true,"console":"false","complete":"false","x":917.8333740234375,"y":172.449951171875,"wires":[]},{"id":"8bfd8276.ed739","type":"delay","z":"eb8d0c5a.8ab9e8","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":324.99998474121094,"y":101,"wires":[["365ce449.3011ac"]]},{"id":"18ad911a.4678bf","type":"file in","z":"3b713604.e73c82","name":"","filename":"C:\\Users\\Acer\\Documents\\BINDING","format":"utf8","x":365.8333930969238,"y":168.66671180725098,"wires":[["e074dd2c.2e5cf"]]},{"id":"413ea009.bd94d","type":"inject","z":"3b713604.e73c82","name":"","topic":"","payload":" ","payloadType":"str","repeat":"","crontab":"","once":false,"x":139.83336639404297,"y":258.00001525878906,"wires":[["18ad911a.4678bf"]]},{"id":"166add3e.77ee03","type":"function","z":"3b713604.e73c82","name":"processing","func":"var result={};\n\nfor(var i =0; i<msg.payload.length;i++)\n{\n    if(msg.payload[i].name==\"input_format\")\n    {\n    msg.payload[i].func='var task=\\\"ecg3_processing\\\";\\nvar node=\\\"rp3i4\\\";\\nmsg.payload=\\\"\\\";\\nmsg.nodename=node;\\nmsg.taskname=task;\\n\\nreturn msg;';\n    result=msg.payload[i];\n    }\n}\n\nreturn msg;\n","outputs":1,"noerr":0,"x":760.2848739624023,"y":155.36827278137207,"wires":[["6ad79710.50737"]]},{"id":"e074dd2c.2e5cf","type":"json","z":"3b713604.e73c82","name":"","x":605.2813720703125,"y":256.47930908203125,"wires":[["166add3e.77ee03"]]},{"id":"6ad79710.50737","type":"file","z":"3b713604.e73c82","name":"","filename":"C:\\Users\\Acer\\Documents\\BINDING22","appendNewline":true,"createDir":false,"overwriteFile":"true","x":1015.0000419616699,"y":253.51563929021358,"wires":[]},{"id":"2574470b.b0c74","type":"mongodb in","z":"8eeb0d6c.0053c8","mongodb":"5f2430b6.84e668","name":"tasks","collection":"tasks","operation":"find","x":437.566650390625,"y":239.56666564941406,"wires":[["a998baf7.8c1908"]]},{"id":"35646581.e63d9a","type":"function","z":"8eeb0d6c.0053c8","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1,\"url\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":288.73291015625,"y":304.233642578125,"wires":[["2574470b.b0c74"]]},{"id":"a998baf7.8c1908","type":"function","z":"8eeb0d6c.0053c8","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":578.73291015625,"y":346.56666564941406,"wires":[["356d4073.be9058"]]},{"id":"356d4073.be9058","type":"function","z":"8eeb0d6c.0053c8","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1,\"location\":1,\"ip\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":727.5662841796875,"y":284.89991760253906,"wires":[["4570a1c.422d76"]]},{"id":"4570a1c.422d76","type":"mongodb in","z":"8eeb0d6c.0053c8","mongodb":"5f2430b6.84e668","name":"nodes","collection":"nodes","operation":"find","x":853.5662841796875,"y":402.89991760253906,"wires":[["a672b1bb.78933"]]},{"id":"a672b1bb.78933","type":"function","z":"8eeb0d6c.0053c8","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1050.5662841796875,"y":324.89991760253906,"wires":[["54702367.6b1144"]]},{"id":"54702367.6b1144","type":"function","z":"8eeb0d6c.0053c8","name":"creator","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif(nodei.location==\"external\")\n{\n    \n    msg.url=nodei.ip+\":\"+taski.port_external+   \"/\"+taski.url;\n    msg.payload=\"echo '\"+ msg.url+\"'\";\n\n}\nelse\n    {\n    \n        \n        if (nodei.arch==\"x86\")\n        {\n            msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n        }\n        else    \n        {\n        \n        msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n        }\n    \n            msg.url=\"127.0.0.1\"+\":\"+taski.port_external+   \"/\"+taski.url;\n\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":1182.73291015625,"y":202.56668090820312,"wires":[["cd2d9e47.477a7"]]},{"id":"cd2d9e47.477a7","type":"exec","z":"8eeb0d6c.0053c8","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1273.633316040039,"y":269.46665954589844,"wires":[[],[],[]]},{"id":"6b69ab1a.1a7b0c","type":"function","z":"fe5d36ff.78a7d","name":"input_format","func":"var task=\"ecg3_processing\";\nvar node=\"rp3i4\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":530.9333343505859,"y":213.79998779296875,"wires":[["c465a37d.776c"]]},{"id":"c465a37d.776c","type":"subflow:8eeb0d6c.0053c8","z":"fe5d36ff.78a7d","x":663.4000091552734,"y":121.08331298828125,"wires":[["beb97668.abd718"]]},{"id":"d663634f.3242a","type":"inject","z":"fe5d36ff.78a7d","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":178.0999755859375,"wires":[["4f481db8.f93384"]]},{"id":"beb97668.abd718","type":"debug","z":"fe5d36ff.78a7d","name":"","active":true,"console":"false","complete":"false","x":917.8333740234375,"y":172.449951171875,"wires":[]},{"id":"4f481db8.f93384","type":"delay","z":"fe5d36ff.78a7d","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":324.99998474121094,"y":101,"wires":[["6b69ab1a.1a7b0c"]]},{"id":"bb0b9b31.e5e7c8","type":"mongodb in","z":"a6e93be1.9b7248","mongodb":"3b6435c9.85c04a","name":"tasks","collection":"tasks","operation":"find","x":437.566650390625,"y":239.56666564941406,"wires":[["14d3e072.65834"]]},{"id":"984b87c6.bb3218","type":"function","z":"a6e93be1.9b7248","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1,\"url\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":288.73291015625,"y":304.233642578125,"wires":[["bb0b9b31.e5e7c8"]]},{"id":"14d3e072.65834","type":"function","z":"a6e93be1.9b7248","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":578.73291015625,"y":346.56666564941406,"wires":[["908855fd.c40b38"]]},{"id":"908855fd.c40b38","type":"function","z":"a6e93be1.9b7248","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1,\"location\":1,\"ip\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":727.5662841796875,"y":284.89991760253906,"wires":[["63920b17.c3b5c4"]]},{"id":"63920b17.c3b5c4","type":"mongodb in","z":"a6e93be1.9b7248","mongodb":"3b6435c9.85c04a","name":"nodes","collection":"nodes","operation":"find","x":853.5662841796875,"y":402.89991760253906,"wires":[["d2fefd24.5a08c"]]},{"id":"d2fefd24.5a08c","type":"function","z":"a6e93be1.9b7248","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1050.5662841796875,"y":324.89991760253906,"wires":[["18d6f9f8.8bfcbe"]]},{"id":"18d6f9f8.8bfcbe","type":"function","z":"a6e93be1.9b7248","name":"creator","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif(nodei.location==\"external\")\n{\n    \n    msg.url=nodei.ip+\":\"+taski.port_external+   \"/\"+taski.url;\n    msg.payload=\"echo '\"+ msg.url+\"'\";\n\n}\nelse\n    {\n    \n        \n        if (nodei.arch==\"x86\")\n        {\n            msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n        }\n        else    \n        {\n        \n        msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n        }\n    \n            msg.url=\"127.0.0.1\"+\":\"+taski.port_external+   \"/\"+taski.url;\n\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":1182.73291015625,"y":202.56668090820312,"wires":[["f7643e29.aec95"]]},{"id":"f7643e29.aec95","type":"exec","z":"a6e93be1.9b7248","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1273.633316040039,"y":269.46665954589844,"wires":[[],[],[]]},{"id":"d29627ec.c066c8","type":"function","z":"c72edaff.6f6a68","name":"input_format","func":"var task=\"ecg3_processing\";\nvar node=\"rp3i4\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":530.9333343505859,"y":213.79998779296875,"wires":[["e72daa02.64b16"]]},{"id":"e72daa02.64b16","type":"subflow:a6e93be1.9b7248","z":"c72edaff.6f6a68","x":663.4000091552734,"y":121.08331298828125,"wires":[["a32e1c57.83736"]]},{"id":"8a00a2e4.6f76c","type":"inject","z":"c72edaff.6f6a68","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":178.0999755859375,"wires":[["a9c6e17d.ff206"]]},{"id":"a32e1c57.83736","type":"debug","z":"c72edaff.6f6a68","name":"","active":true,"console":"false","complete":"false","x":917.8333740234375,"y":172.449951171875,"wires":[]},{"id":"a9c6e17d.ff206","type":"delay","z":"c72edaff.6f6a68","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":324.99998474121094,"y":101,"wires":[["d29627ec.c066c8"]]},{"id":"d2f9748f.766318","type":"function","z":"4a234597.1adc84","name":"input_format","func":"var task=\"ecg3_processing\";\nvar node=\"rp3i4\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":492.765625,"y":230.75,"wires":[["e98e6236.3f654"]]},{"id":"e98e6236.3f654","type":"subflow:a6e93be1.9b7248","z":"4a234597.1adc84","x":625.2322998046875,"y":138.0333251953125,"wires":[["9f6c7ad2.c6c2b8"]]},{"id":"de57f5b0.08e73","type":"inject","z":"4a234597.1adc84","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":111.83229064941406,"y":195.04998779296875,"wires":[["aa4891cf.76c8f8"]]},{"id":"9f6c7ad2.c6c2b8","type":"debug","z":"4a234597.1adc84","name":"","active":true,"console":"false","complete":"false","x":879.6656646728516,"y":189.39996337890625,"wires":[]},{"id":"aa4891cf.76c8f8","type":"delay","z":"4a234597.1adc84","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":286.832275390625,"y":117.95001220703125,"wires":[["d2f9748f.766318"]]},{"id":"74a1cbc7.b2169c","type":"file in","z":"40347b9.eedc804","name":"","filename":"C:\\Users\\Acer\\Documents\\BINDING","format":"utf8","x":379.765625,"y":175.75,"wires":[["1babc28.af0fabe"]]},{"id":"9f24ab33.4881e8","type":"inject","z":"40347b9.eedc804","name":"","topic":"","payload":" ","payloadType":"str","repeat":"","crontab":"","once":false,"x":120.7656021118164,"y":244.08331680297852,"wires":[["74a1cbc7.b2169c"]]},{"id":"7f76620.0e92d2","type":"function","z":"40347b9.eedc804","name":"processing","func":"var result={};\n\nfor(var i =0; i<msg.payload.length;i++)\n{\n    if(msg.payload[i].name==\"input_format\")\n    {\n    msg.payload[i].func='var task=\\\"ecg3_processing\\\";\\nvar node=\\\"rp3i4\\\";\\nmsg.payload=\\\"\\\";\\nmsg.nodename=node;\\nmsg.taskname=task;\\n\\nreturn msg;';\n    result=msg.payload[i];\n    }\n}\n\nreturn msg;\n","outputs":1,"noerr":0,"x":782.2170639038086,"y":176.45156383514404,"wires":[["e6de8862.f3916"]]},{"id":"1babc28.af0fabe","type":"json","z":"40347b9.eedc804","name":"","x":619.2135848999023,"y":243.5625991821289,"wires":[["7f76620.0e92d2"]]},{"id":"e6de8862.f3916","type":"file","z":"40347b9.eedc804","name":"","filename":"C:\\Users\\Acer\\Documents\\BINDING22","appendNewline":true,"createDir":false,"overwriteFile":"true","x":1028.9322509765625,"y":272.59892654418945,"wires":[]},{"id":"2d84f49.4ab240c","type":"http in","z":"40347b9.eedc804","name":"","url":"/binding","method":"get","swaggerDoc":"","x":205.01172637939453,"y":404.6640901565552,"wires":[["eccba6ba.dc2b5"]]},{"id":"eccba6ba.dc2b5","type":"file in","z":"40347b9.eedc804","name":"","filename":"C:\\Users\\Acer\\Documents\\BINDING","format":"utf8","x":447.765625,"y":403.75,"wires":[["4113c8aa.9c9c58"]]},{"id":"8cbedacf.be91b8","type":"function","z":"40347b9.eedc804","name":"processing","func":"var result={};\nvar node=msg.req.query.node; \nvar task=msg.req.query.task;\n\n\nfor(var i =0; i<msg.payload.length;i++)\n{\n    if(msg.payload[i].name==\"input_format\")\n    {\n    msg.payload[i].func='var task=\\\"'+task+'\\\";\\nvar node=\\\"'+node+'\\\";\\nmsg.payload=\\\"\\\";\\nmsg.nodename=node;\\nmsg.taskname=task;\\n\\nreturn msg;';\n    result=msg.payload[i];\n    }\n}\n\nreturn msg;\n","outputs":1,"noerr":0,"x":850.2170639038086,"y":404.45156383514404,"wires":[["cce1681b.d17ce8","5f683527.19c514"]]},{"id":"4113c8aa.9c9c58","type":"json","z":"40347b9.eedc804","name":"","x":687.2135848999023,"y":471.5625991821289,"wires":[["8cbedacf.be91b8"]]},{"id":"cce1681b.d17ce8","type":"file","z":"40347b9.eedc804","name":"","filename":"C:\\Users\\Acer\\Documents\\BINDING234","appendNewline":true,"createDir":false,"overwriteFile":"true","x":1106.9322509765625,"y":500.59892654418945,"wires":[]},{"id":"5f683527.19c514","type":"http response","z":"40347b9.eedc804","name":"","x":1092.8334045410156,"y":413.3333511352539,"wires":[]},{"id":"8383ac1d.51d94","type":"http request","z":"83c04467.6d22a","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1015.566650390625,"y":296.566650390625,"wires":[[]]},{"id":"8652d8ac.67e778","type":"function","z":"83c04467.6d22a","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload;\nvar url_base=msg.url;\nvar final_url=url_base+\"?\";\n\n\n\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[["8383ac1d.51d94"]]},{"id":"17c4a2eb.e38f1d","type":"mongodb in","z":"83c04467.6d22a","mongodb":"860ee023.9915f","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["c7876b5b.ade2d8"]]},{"id":"6b6e5e8b.891f98","type":"function","z":"83c04467.6d22a","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"test_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["17c4a2eb.e38f1d"]]},{"id":"c7876b5b.ade2d8","type":"function","z":"83c04467.6d22a","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["8652d8ac.67e778"]]},{"id":"a9390c5b.99fa1","type":"http in","z":"40347b9.eedc804","name":"","url":"/rap","method":"get","swaggerDoc":"","x":155.50782775878906,"y":635.5234069824219,"wires":[["94bddda0.9f4398"]]},{"id":"94bddda0.9f4398","type":"file in","z":"40347b9.eedc804","name":"","filename":"C:\\Users\\Acer\\Documents\\fs2","format":"utf8","x":409.2617950439453,"y":661.6094951629639,"wires":[["15afd3f4.a4199c"]]},{"id":"da6afa4b.9b8f9","type":"function","z":"40347b9.eedc804","name":"processing","func":"var taskinfo=msg.payload;\nvar task=msg.req.query.task;\nvar url_maker_code=\"msg.limit = 5;\\nmsg.skip = 0;\\nvar result=msg.payload.url;\\nvar url_base=result;\\nvar final_url=url_base+\\\"?\\\";\\n\";\n\n\nfor(var k=0;k<taskinfo.parameters.length;k++)\n{\n    url_maker_code=url_maker_code+\"\\nvar \"+ taskinfo.parameters[k]+\"=msg.\"+taskinfo.parameters[k]+\";\\n\";\n}\n\nvar url_core=\"\";\nfor(var l=0;l<taskinfo.parameters.length;l++)\n{\n    url_core=url_core+'\\nfinal_url=final_url+'+'\"'+ taskinfo.parameters[l]+'=\"+'+taskinfo.parameters[l]+';\\n';\n    if(l!=taskinfo.parameters.length-1)\n    {\n        url_core=url_core+'\\nfinal_url=final_url+\"&\";\\n';\n    }\n}\n\n\nurl_maker_code=url_maker_code+\"\\n\"+url_core;\nurl_maker_code=url_maker_code+\"\\nmsg.payload=final_url;\\n\";\nurl_maker_code=url_maker_code+\"\\nmsg.url=final_url;\\nreturn msg;\\n\";\n\n\n\n\nfor(var i =0; i<msg.flowtemp.length;i++)\n{\n     if(msg.flowtemp[i].name==\"query_allocation\")\n     {\n     msg.flowtemp[i].func='msg.limit = 5;\\nmsg.skip = 0;\\nvar task=\\\"'+task+'\\\"; \\nmsg.payload={ task: task};\\nmsg.projection = {\\\"_id\\\":0, \\\"url\\\":1,\\\"parameters\\\":1}; \\nreturn msg;\\n'; \n     }\n    \n    \n    \n    if(msg.flowtemp[i].name==\"url_maker_test\")\n    {\n     msg.flowtemp[i].func=url_maker_code;\n    }\n    \n}\n\nmsg.payload=msg.flowtemp;\nreturn msg;\n","outputs":1,"noerr":0,"x":902.7131443023682,"y":627.3109493255615,"wires":[["24440d07.8b4b7a","d67b5e2.9f4aea"]]},{"id":"15afd3f4.a4199c","type":"json","z":"40347b9.eedc804","name":"","x":701.7096862792969,"y":660.4219837188721,"wires":[["81802a73.86027"]]},{"id":"24440d07.8b4b7a","type":"file","z":"40347b9.eedc804","name":"","filename":"C:\\Users\\Acer\\Documents\\BINdowi","appendNewline":true,"createDir":false,"overwriteFile":"true","x":1125.4284057617188,"y":710.4582939147949,"wires":[]},{"id":"d67b5e2.9f4aea","type":"http response","z":"40347b9.eedc804","name":"","x":1095.329490661621,"y":599.1926984786987,"wires":[]},{"id":"7cd8e4ad.5022f4","type":"mongodb in","z":"40347b9.eedc804","mongodb":"860ee023.9915f","name":"tasks","collection":"tasks","operation":"find","x":823.6666793823242,"y":868.6667165756226,"wires":[["b3639f09.fa7ff8"]]},{"id":"81802a73.86027","type":"function","z":"40347b9.eedc804","name":"query_task","func":"msg.limit = 5;\nmsg.skip = 0;\n\nmsg.flowtemp=msg.payload;\n\nvar task=msg.req.query.task;\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":635.8329277038574,"y":816.3337078094482,"wires":[["7cd8e4ad.5022f4"]]},{"id":"b3639f09.fa7ff8","type":"function","z":"40347b9.eedc804","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":849.666690826416,"y":775.0001335144043,"wires":[["da6afa4b.9b8f9"]]},{"id":"78cca8b0.640b5","type":"http request","z":"19705119.354137","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1005.566650390625,"y":281.566650390625,"wires":[[]]},{"id":"14e5d0c4.21cdcf","type":"function","z":"19705119.354137","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload;\nvar url_base=msg.url;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\nvar troponin=msg.troponin;\n\n\n\n\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[["78cca8b0.640b5"]]},{"id":"70c3083.aeab7f8","type":"mongodb in","z":"19705119.354137","mongodb":"6928c4d2.b31464","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["54124cdb.dab274"]]},{"id":"951a9d3b.f645d8","type":"function","z":"19705119.354137","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"test_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["70c3083.aeab7f8"]]},{"id":"54124cdb.dab274","type":"function","z":"19705119.354137","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["14e5d0c4.21cdcf"]]},{"id":"21ffc37c.99ae4c","type":"http request","z":"ea3f3c60.b142d8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1005.566650390625,"y":281.566650390625,"wires":[[]]},{"id":"5f58c880.c84108","type":"function","z":"ea3f3c60.b142d8","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload;\nvar url_base=msg.url;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\nvar troponin=msg.troponin;\n\n\n\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[["21ffc37c.99ae4c"]]},{"id":"7c014ffa.5ae538","type":"mongodb in","z":"ea3f3c60.b142d8","mongodb":"11c243dc.e27114","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["6a6d23c4.243a4c"]]},{"id":"df1dd255.4c4468","type":"function","z":"ea3f3c60.b142d8","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"test_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["7c014ffa.5ae538"]]},{"id":"6a6d23c4.243a4c","type":"function","z":"ea3f3c60.b142d8","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["5f58c880.c84108"]]},{"id":"8bcc6e23.b4aca8","type":"http request","z":"7fadc2e8.117a4c","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1005.566650390625,"y":281.566650390625,"wires":[[]]},{"id":"85002a7c.622dd8","type":"function","z":"7fadc2e8.117a4c","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload;\nvar url_base=msg.url;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\nvar troponin=msg.troponin;\n\n\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[["8bcc6e23.b4aca8"]]},{"id":"5a97f42.0ad298c","type":"mongodb in","z":"7fadc2e8.117a4c","mongodb":"21ce8d9c.9aa3e2","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["18d34a2f.da2e16"]]},{"id":"3e72f1ce.05065e","type":"function","z":"7fadc2e8.117a4c","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"test_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["5a97f42.0ad298c"]]},{"id":"18d34a2f.da2e16","type":"function","z":"7fadc2e8.117a4c","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["85002a7c.622dd8"]]},{"id":"f3e1b4e3.3b48a","type":"function","z":"21498d8a.668072","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload;\nvar url_base=msg.payload.url;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\nvar troponin=msg.troponin;\n\n\nfinal_url=final_url+\"ecg=\"+ecg;\n\nfinal_url=final_url+\"troponin=\"+troponin;\n\nmsg.url=final_url;\nmsg.payload=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[[]]},{"id":"f3bcee51.f3fc78","type":"mongodb in","z":"21498d8a.668072","mongodb":"2488ba70.4a3f2e","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["a6b328e9.3c7f5"]]},{"id":"7346b941.be46a","type":"function","z":"21498d8a.668072","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"test_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["f3bcee51.f3fc78"]]},{"id":"a6b328e9.3c7f5","type":"function","z":"21498d8a.668072","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["f3e1b4e3.3b48a"]]},{"id":"d65d86f6.60bab","type":"inject","z":"40347b9.eedc804","name":"","topic":"","payload":"","payloadType":"date","repeat":"10","crontab":"","once":false,"x":141.83334350585938,"y":832.333381652832,"wires":[[]]},{"id":"b1bb13a8.209c6","type":"debug","z":"40347b9.eedc804","name":"","active":true,"console":"false","complete":"false","x":676.8333740234375,"y":959.0001382827759,"wires":[]},{"id":"637ab8e9.808028","type":"function","z":"6bd42a30.ed4904","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload.url;\nvar url_base=msg.payload.url;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\nvar troponin=msg.troponin;\n\n\nfinal_url=final_url+\"ecg=\"+ecg;\n\nfinal_url=final_url+\"&\";\n\nfinal_url=final_url+\"troponin=\"+troponin;\n\nmsg.url=final_url;\nmsg.payload=msg.url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[[]]},{"id":"e80cce02.e75cd","type":"mongodb in","z":"6bd42a30.ed4904","mongodb":"ed7ef282.b66678","name":"allocations","collection":"allocations","operation":"find","x":434.56666564941406,"y":475.5666608810425,"wires":[["f4f90ef8.923d5"]]},{"id":"db158b64.8018a8","type":"function","z":"6bd42a30.ed4904","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"ecg_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["e80cce02.e75cd"]]},{"id":"f4f90ef8.923d5","type":"function","z":"6bd42a30.ed4904","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["637ab8e9.808028"]]},{"id":"54b25ada.91d54c","type":"http request","z":"833497e3.542838","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1005.566650390625,"y":281.566650390625,"wires":[[]]},{"id":"e1848921.1666b8","type":"function","z":"833497e3.542838","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload;\nvar url_base=msg.url;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\nvar troponin=msg.troponin;\n\n\nfinal_url=final_url+\"ecg=\"+ecg;\n\nfinal_url=final_url+\"&\";\n\nfinal_url=final_url+\"troponin=\"+troponin;\n\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[["54b25ada.91d54c"]]},{"id":"d5d30a03.e7d1e8","type":"mongodb in","z":"833497e3.542838","mongodb":"930eac2b.7280d","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["8f4a1516.edee5"]]},{"id":"646afbc1.166dfc","type":"function","z":"833497e3.542838","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"test_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["d5d30a03.e7d1e8"]]},{"id":"8f4a1516.edee5","type":"function","z":"833497e3.542838","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["e1848921.1666b8"]]},{"id":"b0cad03.35ec6b","type":"function","z":"aaffdbe5.cb86c","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload.url;\nvar url_base=result;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\n\nfinal_url=final_url+\"ecg=\"+ecg;\nmsg.payload=final_url;\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[[]]},{"id":"e1d13903.ac52b8","type":"mongodb in","z":"aaffdbe5.cb86c","mongodb":"7979e74f.afdd5","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["f7eb01ab.a9e6a"]]},{"id":"591a694a.c6f72","type":"function","z":"aaffdbe5.cb86c","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"ecg_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["e1d13903.ac52b8"]]},{"id":"f7eb01ab.a9e6a","type":"function","z":"aaffdbe5.cb86c","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["b0cad03.35ec6b"]]},{"id":"fc807ad8.457668","type":"function","z":"bf299af7.2f0f18","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload.url;\nvar url_base=msg.result;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\n\nfinal_url=final_url+\"ecg=\"+ecg;\n\nmsg.url=final_url;\nmsg.payload=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[[]]},{"id":"39292539.615872","type":"mongodb in","z":"bf299af7.2f0f18","mongodb":"fc745c17.71d56","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["e662918.47dcf7"]]},{"id":"a19744d7.21e37","type":"function","z":"bf299af7.2f0f18","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"ecg_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["39292539.615872"]]},{"id":"e662918.47dcf7","type":"function","z":"bf299af7.2f0f18","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["fc807ad8.457668"]]},{"id":"646d7d55.1d56f4","type":"subflow:bf299af7.2f0f18","z":"40347b9.eedc804","x":333.50000762939453,"y":917.3333854675293,"wires":[[]]},{"id":"c061f9b7.dcc1c","type":"function","z":"6a159280.568b7c","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload.url;\nvar url_base=result;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\n\nfinal_url=final_url+\"ecg=\"+ecg;\n\nmsg.payload=final_url;\n\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":794.066650390625,"y":573.5666198730469,"wires":[[]]},{"id":"32bb47e4.aa7ad8","type":"mongodb in","z":"6a159280.568b7c","mongodb":"da97d0f8.c4c3c","name":"allocations","collection":"allocations","operation":"find","x":462.566650390625,"y":566.5666198730469,"wires":[["4b653118.7f6c18"]]},{"id":"8fde5d1d.21e8e","type":"function","z":"6a159280.568b7c","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"ecg_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":284.7329864501953,"y":569.2336120605469,"wires":[["32bb47e4.aa7ad8"]]},{"id":"4b653118.7f6c18","type":"function","z":"6a159280.568b7c","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":631.566650390625,"y":691.566650390625,"wires":[["c061f9b7.dcc1c"]]},{"id":"494a9561.d6012c","type":"subflow:6a159280.568b7c","z":"40347b9.eedc804","x":386.50001525878906,"y":816.0000476837158,"wires":[["b1bb13a8.209c6"]]},{"id":"6498b1b5.3586d8","type":"http request","z":"8b34e9c3.b6805","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1005.566650390625,"y":281.566650390625,"wires":[[]]},{"id":"34131bf0.85b6b4","type":"function","z":"8b34e9c3.b6805","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload.url;\nvar url_base=result;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\nvar troponin=msg.troponin;\n\n\nfinal_url=final_url+\"ecg=\"+ecg;\n\nfinal_url=final_url+\"&\";\n\nfinal_url=final_url+\"troponin=\"+troponin;\n\nmsg.payload=final_url;\n\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":798.066650390625,"y":454.566650390625,"wires":[["6498b1b5.3586d8"]]},{"id":"aaf6942c.58fd88","type":"mongodb in","z":"8b34e9c3.b6805","mongodb":"a6de67d4.7656","name":"allocations","collection":"allocations","operation":"find","x":473.566650390625,"y":344.566650390625,"wires":[["d9faf2aa.176648"]]},{"id":"8d140929.7a39c","type":"function","z":"8b34e9c3.b6805","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"test_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["aaf6942c.58fd88"]]},{"id":"d9faf2aa.176648","type":"function","z":"8b34e9c3.b6805","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["34131bf0.85b6b4"]]},{"id":"1748e43f.a7bcac","type":"mongodb in","z":"a124b48b.51d33","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":437.566650390625,"y":239.56666564941406,"wires":[["22d51bc1.17ee5c"]]},{"id":"1aa5848c.c84a83","type":"function","z":"a124b48b.51d33","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1,\"url\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":288.73291015625,"y":304.233642578125,"wires":[["1748e43f.a7bcac"]]},{"id":"22d51bc1.17ee5c","type":"function","z":"a124b48b.51d33","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":578.73291015625,"y":346.56666564941406,"wires":[["bda4b414.68b2a"]]},{"id":"bda4b414.68b2a","type":"function","z":"a124b48b.51d33","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1,\"location\":1,\"ip\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":727.5662841796875,"y":284.89991760253906,"wires":[["ba5646c0.a149e"]]},{"id":"ba5646c0.a149e","type":"mongodb in","z":"a124b48b.51d33","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":853.5662841796875,"y":402.89991760253906,"wires":[["f2cad3b1.b92fe"]]},{"id":"f2cad3b1.b92fe","type":"function","z":"a124b48b.51d33","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1050.5662841796875,"y":324.89991760253906,"wires":[["d5bec6ef.f4e2e"]]},{"id":"d5bec6ef.f4e2e","type":"function","z":"a124b48b.51d33","name":"creator","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif(nodei.location==\"external\")\n{\n    \n    msg.url=nodei.ip+\":\"+taski.port_external+   \"/\"+taski.url;\n    msg.payload=\"echo '\"+ msg.url+\"'\";\n\n}\nelse\n    {\n    \n        \n        if (nodei.arch==\"x86\")\n        {\n            msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n        }\n        else    \n        {\n        \n        msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n        }\n    \n            msg.url=\"127.0.0.1\"+\":\"+taski.port_external+   \"/\"+taski.url;\n\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":1182.73291015625,"y":202.56668090820312,"wires":[["3c25f25c.3e797e"]]},{"id":"3c25f25c.3e797e","type":"exec","z":"a124b48b.51d33","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1273.633316040039,"y":269.46665954589844,"wires":[[],[],[]]},{"id":"dc7015dd.1a1638","type":"function","z":"43367d2.b055584","name":"input_format","func":"var task=\"test_processing\";\nvar node=\"rpi3\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":530.933349609375,"y":310.79998779296875,"wires":[["8e532502.0cc198"]]},{"id":"ce348654.40ea58","type":"subflow:a124b48b.51d33","z":"43367d2.b055584","x":671.4000244140625,"y":146.08331298828125,"wires":[[]]},{"id":"e3bad8f0.a1968","type":"inject","z":"43367d2.b055584","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":208,"y":320.0999755859375,"wires":[[]]},{"id":"fec7001e.08bf58","type":"debug","z":"43367d2.b055584","name":"","active":true,"console":"false","complete":"false","x":872.833251953125,"y":242.449951171875,"wires":[]},{"id":"a12e9a98.08b65","type":"delay","z":"43367d2.b055584","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":361,"y":289,"wires":[["dc7015dd.1a1638"]]},{"id":"a2bcc195.1f2d38","type":"http in","z":"43367d2.b055584","name":"","url":"/final_test","method":"get","swaggerDoc":"","x":317.5,"y":618.5,"wires":[["990bf561.451528"]]},{"id":"990bf561.451528","type":"function","z":"43367d2.b055584","name":"query_troponin","func":"var patient=msg.req.query.patient; \nmsg.topic=\"SELECT result from troponin_result where patient='\"+patient+\"'\";\nreturn msg;","outputs":1,"noerr":0,"x":471.5,"y":515.5,"wires":[["bce66c3c.4e88b"]]},{"id":"bce66c3c.4e88b","type":"mysql","z":"43367d2.b055584","mydb":"b43efa28.b858b8","name":"troponin_result","x":613.5,"y":612.5,"wires":[["7233a389.84187c"]]},{"id":"7233a389.84187c","type":"function","z":"43367d2.b055584","name":"troponin_result_format","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nmsg.payload=\"\";\nflow.set('tr',result[0].result);\nreturn msg;","outputs":1,"noerr":0,"x":822,"y":621.5,"wires":[["96ec8fea.0f2228"]]},{"id":"96ec8fea.0f2228","type":"function","z":"43367d2.b055584","name":"query_ecg","func":"var patient=msg.req.query.patient; \nmsg.topic=\"SELECT result from ecg_result where patient='\"+patient+\"'\";\nreturn msg;","outputs":1,"noerr":0,"x":1054.5,"y":637.5,"wires":[["c4e7fa4.257c308"]]},{"id":"c4e7fa4.257c308","type":"mysql","z":"43367d2.b055584","mydb":"b43efa28.b858b8","name":"ecg_result","x":1242.5,"y":866.5,"wires":[["6a3a97ed.c196f8"]]},{"id":"6a3a97ed.c196f8","type":"function","z":"43367d2.b055584","name":"ecg_result_extract","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nmsg.payload=\"\";\nflow.set('ec',result[0].result);\nreturn msg;","outputs":1,"noerr":0,"x":1525,"y":869.5,"wires":[["2fd3f3b3.22ee14"]]},{"id":"341e45b8.09b33a","type":"subflow:ec360aba.4d64d","z":"43367d2.b055584","name":"","x":1761.5,"y":854.5,"wires":[["5f6e26c8.18b9c"]]},{"id":"2fd3f3b3.22ee14","type":"function","z":"43367d2.b055584","name":"test_input","func":"msg.tr=flow.get(\"tr\");\nmsg.ec=flow.get(\"ec\");\nreturn msg;","outputs":1,"noerr":0,"x":1591.5,"y":696.5,"wires":[["341e45b8.09b33a"]]},{"id":"5f6e26c8.18b9c","type":"function","z":"43367d2.b055584","name":"insert troponin_result","func":"var final=msg.payload;\nvar patient=msg.req.query.patient; \nmsg.topic=\"INSERT INTO final_result(patient,result) values('\"+patient+\"',\"+final+\") \";\nreturn msg;","outputs":1,"noerr":0,"x":1942.5,"y":721.5,"wires":[["19ce3222.a14b06"]]},{"id":"19ce3222.a14b06","type":"mysql","z":"43367d2.b055584","mydb":"b43efa28.b858b8","name":"final_result","x":2139.5,"y":751.5,"wires":[["946d8e13.3fee8"]]},{"id":"946d8e13.3fee8","type":"http response","z":"43367d2.b055584","name":"","x":2258,"y":646.5,"wires":[]},{"id":"8edfc206.927c1","type":"http in","z":"43367d2.b055584","name":"","url":"/final_result","method":"get","swaggerDoc":"","x":313.5,"y":788.5,"wires":[["109e19e3.ae2c16"]]},{"id":"109e19e3.ae2c16","type":"function","z":"43367d2.b055584","name":"query_final","func":"var patient=msg.req.query.patient; \nmsg.topic=\"SELECT result from final_result where patient='\"+patient+\"'\";\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":876.5,"wires":[["7bac1de6.2cf394"]]},{"id":"7c3470d1.00b378","type":"http response","z":"43367d2.b055584","name":"","x":1020,"y":809.5,"wires":[]},{"id":"7bac1de6.2cf394","type":"mysql","z":"43367d2.b055584","mydb":"b43efa28.b858b8","name":"final_result","x":620,"y":786.5,"wires":[["98a94a83.d58918"]]},{"id":"98a94a83.d58918","type":"function","z":"43367d2.b055584","name":"final_result_extract","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nmsg.payload=result[0].result;\nreturn msg;","outputs":1,"noerr":0,"x":797.5,"y":830.5,"wires":[["7c3470d1.00b378"]]},{"id":"e5eceba7.4119f8","type":"mongodb in","z":"90fe7935.af7ab","mongodb":"3b6435c9.85c04a","name":"tasks","collection":"tasks","operation":"find","x":278.75,"y":186.75,"wires":[["cc3cdee0.fa9ff"]]},{"id":"e7716749.e6df18","type":"function","z":"90fe7935.af7ab","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1,\"url\":1, \"parameters\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":175.916259765625,"y":322.4169921875,"wires":[["e5eceba7.4119f8"]]},{"id":"cc3cdee0.fa9ff","type":"function","z":"90fe7935.af7ab","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":419.916259765625,"y":293.75,"wires":[["c8a906d4.1e251"]]},{"id":"c8a906d4.1e251","type":"function","z":"90fe7935.af7ab","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1,\"location\":1,\"ip\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":568.7496337890625,"y":232.083251953125,"wires":[["8d76e413.00e908"]]},{"id":"8d76e413.00e908","type":"mongodb in","z":"90fe7935.af7ab","mongodb":"3b6435c9.85c04a","name":"nodes","collection":"nodes","operation":"find","x":704.7496337890625,"y":371.083251953125,"wires":[["4ff6ed66.11ccf4"]]},{"id":"4ff6ed66.11ccf4","type":"function","z":"90fe7935.af7ab","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":831.7496337890625,"y":246.083251953125,"wires":[["165de60d.257792"]]},{"id":"165de60d.257792","type":"function","z":"90fe7935.af7ab","name":"creator","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif(nodei.location==\"external\")\n{\n    \n    msg.url=nodei.ip+\":\"+taski.port_external+   \"/\"+taski.url;\n    msg.payload=\"echo '\"+ msg.url+\"'\";\n\n}\nelse\n    {\n    \n        \n        if (nodei.arch==\"x86\")\n        {\n            msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n        }\n        else    \n        {\n        \n        msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n        }\n    \n            msg.url=\"127.0.0.1\"+\":\"+taski.port_external+   \"/\"+taski.url;\n\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":1022.916259765625,"y":231.75001525878906,"wires":[["227569b1.237d3e"]]},{"id":"227569b1.237d3e","type":"exec","z":"90fe7935.af7ab","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1143.816650390625,"y":312.6500244140625,"wires":[["60b45a55.f3935c"],[],[]]},{"id":"baaadcf3.bfae28","type":"mongodb out","z":"90fe7935.af7ab","mongodb":"f03ed1a4.b25e5","name":"insert_allocation","collection":"allocations","payonly":true,"upsert":false,"multi":false,"operation":"insert","x":1434.75,"y":284.29998779296875,"wires":[]},{"id":"60b45a55.f3935c","type":"function","z":"90fe7935.af7ab","name":"insert_set","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nvar task=flow.get('taskname');\nvar tinfo=flow.get('taskinfo');\nmsg.payload={ node: node, task:task, port_external:tinfo.port_external,port_internal:tinfo.port_internal,parameters:tinfo.parameters,url:msg.url, image_arm:tinfo.image_arm};\n\n\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1213,"y":207.75,"wires":[["baaadcf3.bfae28"]]},{"id":"8e532502.0cc198","type":"subflow:90fe7935.af7ab","z":"43367d2.b055584","name":"","x":716.75,"y":323.1333312988281,"wires":[]},{"id":"470ad728.39bc18","type":"function","z":"43367d2.b055584","name":"insert_set","func":"msg.limit = 5;\n\nvar node=\"n1\"; \nvar task=\"t1\";\nmsg.payload={ node: node, task:task}\n\nreturn msg;","outputs":1,"noerr":0,"x":360.75,"y":1086.75,"wires":[["ea6edf89.96528"]]},{"id":"ea6edf89.96528","type":"mongodb out","z":"43367d2.b055584","mongodb":"f03ed1a4.b25e5","name":"insert_prova","collection":"prova","payonly":false,"upsert":false,"multi":false,"operation":"insert","x":578.5,"y":1132.300048828125,"wires":[]},{"id":"f2b446cc.bdfff","type":"inject","z":"43367d2.b055584","name":"","topic":"","payload":" ","payloadType":"str","repeat":"10","crontab":"","once":true,"x":169.75,"y":1091.5166625976562,"wires":[[]]},{"id":"e293f9e3.e1f9f8","type":"subflow:8b34e9c3.b6805","z":"43367d2.b055584","x":1590.75,"y":288.13336181640625,"wires":[["9d98c87d.e3fed8"]]},{"id":"8ff62cb.2b87ad","type":"function","z":"43367d2.b055584","name":"test_input","func":"var troponin=msg.req.query.troponin; \nvar ecg=msg.req.query.ecg; \nmsg.ecg=ecg;\nmsg.troponin=troponin;\nreturn msg;","outputs":1,"noerr":0,"x":1423.5,"y":289.7500305175781,"wires":[["e293f9e3.e1f9f8"]]},{"id":"4b121a53.f8d8ac","type":"http in","z":"43367d2.b055584","name":"","url":"/test_import","method":"get","swaggerDoc":"","x":1205,"y":339.5166931152344,"wires":[["8ff62cb.2b87ad"]]},{"id":"9d98c87d.e3fed8","type":"http response","z":"43367d2.b055584","name":"","x":1718,"y":394.9000244140625,"wires":[]},{"id":"60cd04f.9e64ffc","type":"http request","z":"9fbd62ed.065678","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1005.566650390625,"y":281.566650390625,"wires":[[]]},{"id":"8f5a06da.55d6e","type":"function","z":"9fbd62ed.065678","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload.url;\nvar url_base=result;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\n\nfinal_url=final_url+\"ecg=\"+ecg;\n\nmsg.payload=final_url;\n\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[["60cd04f.9e64ffc"]]},{"id":"40a9fe0a.68e15","type":"mongodb in","z":"9fbd62ed.065678","mongodb":"a6de67d4.7656","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["f8d2599c.8a16c8"]]},{"id":"3fbd58f8.8539b","type":"function","z":"9fbd62ed.065678","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"ecg_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["40a9fe0a.68e15"]]},{"id":"f8d2599c.8a16c8","type":"function","z":"9fbd62ed.065678","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["8f5a06da.55d6e"]]},{"id":"6967c534.3aa314","type":"mongodb in","z":"3b87031f.7136b4","mongodb":"a38c993e.77baa","name":"tasks","collection":"tasks","operation":"find","x":278.75,"y":186.75,"wires":[["c5e08edf.82cf08"]]},{"id":"4330a1f1.9d8e9","type":"function","z":"3b87031f.7136b4","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1,\"url\":1, \"parameters\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":175.916259765625,"y":322.4169921875,"wires":[["6967c534.3aa314"]]},{"id":"c5e08edf.82cf08","type":"function","z":"3b87031f.7136b4","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":419.916259765625,"y":293.75,"wires":[["8a60e3d6.f4f9a"]]},{"id":"8a60e3d6.f4f9a","type":"function","z":"3b87031f.7136b4","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1,\"location\":1,\"ip\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":568.7496337890625,"y":232.083251953125,"wires":[["37838e0e.52d7a2"]]},{"id":"37838e0e.52d7a2","type":"mongodb in","z":"3b87031f.7136b4","mongodb":"a38c993e.77baa","name":"nodes","collection":"nodes","operation":"find","x":704.7496337890625,"y":371.083251953125,"wires":[["ba1799ad.c725f"]]},{"id":"ba1799ad.c725f","type":"function","z":"3b87031f.7136b4","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":831.7496337890625,"y":246.083251953125,"wires":[["6d6e1ee7.24242"]]},{"id":"6d6e1ee7.24242","type":"function","z":"3b87031f.7136b4","name":"creator","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif(nodei.location==\"external\")\n{\n    \n    msg.url=nodei.ip+\":\"+taski.port_external+   \"/\"+taski.url;\n    msg.payload=\"echo '\"+ msg.url+\"'\";\n\n}\nelse\n    {\n    \n        \n        if (nodei.arch==\"x86\")\n        {\n            msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n        }\n        else    \n        {\n        \n        msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n        }\n    \n            msg.url=\"127.0.0.1\"+\":\"+taski.port_external+   \"/\"+taski.url;\n\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":1022.916259765625,"y":231.75001525878906,"wires":[["b80af42.7659408"]]},{"id":"b80af42.7659408","type":"exec","z":"3b87031f.7136b4","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1143.816650390625,"y":312.6500244140625,"wires":[["ae7b0ac2.a26de"],[],[]]},{"id":"5325a23f.f41924","type":"mongodb out","z":"3b87031f.7136b4","mongodb":"6daf288f.08ccf8","name":"insert_allocation","collection":"allocations","payonly":true,"upsert":false,"multi":false,"operation":"insert","x":1434.75,"y":284.29998779296875,"wires":[]},{"id":"ae7b0ac2.a26de","type":"function","z":"3b87031f.7136b4","name":"insert_set","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nvar task=flow.get('taskname');\nvar tinfo=flow.get('taskinfo');\nmsg.payload={ node: node, task:task, port_external:tinfo.port_external,port_internal:tinfo.port_internal,parameters:tinfo.parameters,url:msg.url, image_arm:tinfo.image_arm};\n\n\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1213,"y":207.75,"wires":[["5325a23f.f41924"]]},{"id":"7a9546b2.d0aea8","type":"function","z":"489a23e7.80926c","name":"input_format","func":"var task=\"troponin_processing\";\nvar node=\"rpi1\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":530.9333343505859,"y":213.79998779296875,"wires":[["975b4e8e.baa188"]]},{"id":"6cfcbcb0.9a70a4","type":"inject","z":"489a23e7.80926c","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":150,"y":178.0999755859375,"wires":[["9c5c8d8f.33f3f8"]]},{"id":"9c5c8d8f.33f3f8","type":"delay","z":"489a23e7.80926c","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":324.99998474121094,"y":101,"wires":[["7a9546b2.d0aea8"]]},{"id":"975b4e8e.baa188","type":"subflow:3b87031f.7136b4","z":"489a23e7.80926c","x":760.5,"y":129.66668701171875,"wires":[]},{"id":"ddb9f820.1651b8","type":"subflow:9fbd62ed.065678","z":"43367d2.b055584","name":"","x":1550.75,"y":480.63336181640625,"wires":[["79b256a.c497ea8"]]},{"id":"ff7c2bde.222e7","type":"http in","z":"43367d2.b055584","name":"","url":"/ecg_import","method":"get","swaggerDoc":"","x":1217,"y":513.5166778564453,"wires":[["1cd02f97.647578"]]},{"id":"1cd02f97.647578","type":"function","z":"43367d2.b055584","name":"test_input","func":"\nvar ecg=msg.req.query.ecg; \nmsg.ecg=ecg;\n\nreturn msg;","outputs":1,"noerr":0,"x":1364,"y":453.7500305175781,"wires":[["ddb9f820.1651b8"]]},{"id":"79b256a.c497ea8","type":"http response","z":"43367d2.b055584","name":"","x":1696,"y":460.9000244140625,"wires":[]},{"id":"ccf210cc.19c69","type":"switch","z":"4488f8a4.67143","name":"algorithm","property":"alg","propertyType":"msg","rules":[{"t":"eq","v":"first","vt":"str"},{"t":"eq","v":"fastest","vt":"str"},{"t":"eq","v":"arm","vt":"str"},{"t":"eq","v":"x86","vt":"str"},{"t":"eq","v":"ram","vt":"str"}],"checkall":"true","outputs":5,"x":459.33331298828125,"y":397.2168273925781,"wires":[["f87f3bed.3ec108"],["d928a436.8c693"],["a50942d5.bcd37"],["5bf57b0d.29ab4c"],["6041baf4.b455dc"]]},{"id":"28a27a4e.44edbe","type":"function","z":"4488f8a4.67143","name":"test_proc","func":"var tsk=msg.req.query.task; \nvar alg=msg.req.query.algorithm; \nflow.set('tsk',tsk);\nflow.set('alg',alg);\nmsg.alg=alg;\n\nreturn msg;","outputs":1,"noerr":0,"x":347.73333740234375,"y":533.9999694824219,"wires":[["ccf210cc.19c69"]]},{"id":"f87f3bed.3ec108","type":"function","z":"4488f8a4.67143","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":707.2666625976562,"y":201.9833984375,"wires":[["e05637a3.d18308"]]},{"id":"e55eef07.1ad2c8","type":"subflow:ae2b9df3.28132","z":"4488f8a4.67143","x":864.2666625976562,"y":332.9833984375,"wires":[["b5f86aac.0060b8"]]},{"id":"d928a436.8c693","type":"function","z":"4488f8a4.67143","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":697.2666625976562,"y":312.683349609375,"wires":[["e55eef07.1ad2c8"]]},{"id":"e05637a3.d18308","type":"subflow:18e20988.4c4aa6","z":"4488f8a4.67143","x":884.2666625976562,"y":201.61669921875,"wires":[["8561e109.fb8098"]]},{"id":"a50942d5.bcd37","type":"function","z":"4488f8a4.67143","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":692.3333129882812,"y":409.050048828125,"wires":[["1ac1879a.ed75d8"]]},{"id":"49b24947.a4eb6","type":"subflow:f0da5b33.1135d8","z":"4488f8a4.67143","x":804.3333129882812,"y":553.8497314453125,"wires":[["d96b4667.6dd9a"]]},{"id":"1ac1879a.ed75d8","type":"subflow:15baf860.7fdb18","z":"4488f8a4.67143","x":862.3333129882812,"y":435.716552734375,"wires":[["fa386374.a205d8"]]},{"id":"5bf57b0d.29ab4c","type":"function","z":"4488f8a4.67143","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":650.3333129882812,"y":516.716552734375,"wires":[["49b24947.a4eb6"]]},{"id":"6041baf4.b455dc","type":"function","z":"4488f8a4.67143","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":631.2666625976562,"y":631.0501708984375,"wires":[["30e86cf0.ba9744"]]},{"id":"30e86cf0.ba9744","type":"subflow:3bf728d9.ffd948","z":"4488f8a4.67143","name":"","x":787.1666870117188,"y":710.166748046875,"wires":[["143964af.36a5a3"]]},{"id":"8561e109.fb8098","type":"subflow:90fe7935.af7ab","z":"4488f8a4.67143","x":1095.8333740234375,"y":200.16665649414062,"wires":[]},{"id":"b5f86aac.0060b8","type":"subflow:90fe7935.af7ab","z":"4488f8a4.67143","x":1080.8333740234375,"y":329.1666259765625,"wires":[]},{"id":"fa386374.a205d8","type":"subflow:90fe7935.af7ab","z":"4488f8a4.67143","x":1060.8333740234375,"y":439.1666259765625,"wires":[]},{"id":"d96b4667.6dd9a","type":"subflow:90fe7935.af7ab","z":"4488f8a4.67143","x":960.8333282470703,"y":554.1666412353516,"wires":[]},{"id":"143964af.36a5a3","type":"subflow:90fe7935.af7ab","z":"4488f8a4.67143","x":953.8333282470703,"y":707.1666412353516,"wires":[]},{"id":"b41c9aa9.77e208","type":"inject","z":"4488f8a4.67143","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":97,"y":733.3333129882812,"wires":[["36de569.de98aaa"]]},{"id":"36de569.de98aaa","type":"delay","z":"4488f8a4.67143","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":187.99998474121094,"y":594.2333374023438,"wires":[["28a27a4e.44edbe"]]},{"id":"119a0ea7.a79031","type":"switch","z":"751e1e72.95dc1","name":"algorithm","property":"alg","propertyType":"msg","rules":[{"t":"eq","v":"first","vt":"str"},{"t":"eq","v":"fastest","vt":"str"},{"t":"eq","v":"arm","vt":"str"},{"t":"eq","v":"x86","vt":"str"},{"t":"eq","v":"ram","vt":"str"}],"checkall":"true","outputs":5,"x":516.3333129882812,"y":533.216796875,"wires":[["92b007d9.42cfe8"],["2201d25a.c0f696"],["a891a02a.75132"],["3e491d49.38968a"],["8a99c8e8.141c68"]]},{"id":"92b007d9.42cfe8","type":"function","z":"751e1e72.95dc1","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":949.2666625976562,"y":223.9833984375,"wires":[["f6190694.6e5618"]]},{"id":"e5ee7172.e1f438","type":"subflow:ae2b9df3.28132","z":"751e1e72.95dc1","x":1054.2666625976562,"y":362.9833984375,"wires":[["4f656276.62830c"]]},{"id":"2201d25a.c0f696","type":"function","z":"751e1e72.95dc1","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":899.2666625976562,"y":350.683349609375,"wires":[["e5ee7172.e1f438"]]},{"id":"f6190694.6e5618","type":"subflow:18e20988.4c4aa6","z":"751e1e72.95dc1","x":1102.2666015625,"y":175.61669921875,"wires":[["d1875540.9515b8"]]},{"id":"a891a02a.75132","type":"function","z":"751e1e72.95dc1","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":888.3333129882812,"y":422.050048828125,"wires":[["3c108df6.c992ca"]]},{"id":"f945681b.463d2","type":"subflow:f0da5b33.1135d8","z":"751e1e72.95dc1","x":994.3333129882812,"y":583.8497314453125,"wires":[["91c2b477.b11588"]]},{"id":"3c108df6.c992ca","type":"subflow:15baf860.7fdb18","z":"751e1e72.95dc1","x":1052.3333129882812,"y":465.716552734375,"wires":[["1cfa8556.e5850b"]]},{"id":"3e491d49.38968a","type":"function","z":"751e1e72.95dc1","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":840.3333129882812,"y":546.716552734375,"wires":[["f945681b.463d2"]]},{"id":"8a99c8e8.141c68","type":"function","z":"751e1e72.95dc1","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":821.2666625976562,"y":661.0501708984375,"wires":[["f06a54e2.39483"]]},{"id":"f06a54e2.39483","type":"subflow:3bf728d9.ffd948","z":"751e1e72.95dc1","name":"","x":977.1666870117188,"y":740.166748046875,"wires":[["9ff702da.a4d628"]]},{"id":"d1875540.9515b8","type":"subflow:90fe7935.af7ab","z":"751e1e72.95dc1","x":1286.8333740234375,"y":222.16665649414062,"wires":[]},{"id":"4f656276.62830c","type":"subflow:90fe7935.af7ab","z":"751e1e72.95dc1","x":1270.8333740234375,"y":359.1666259765625,"wires":[]},{"id":"1cfa8556.e5850b","type":"subflow:90fe7935.af7ab","z":"751e1e72.95dc1","x":1250.8333740234375,"y":469.1666259765625,"wires":[]},{"id":"91c2b477.b11588","type":"subflow:90fe7935.af7ab","z":"751e1e72.95dc1","x":1150.8333282470703,"y":584.1666412353516,"wires":[]},{"id":"9ff702da.a4d628","type":"subflow:90fe7935.af7ab","z":"751e1e72.95dc1","x":1143.8333282470703,"y":737.1666412353516,"wires":[]},{"id":"4f3fecb5.13bf7c","type":"inject","z":"751e1e72.95dc1","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":245,"y":356.3333435058594,"wires":[["1c61fa22.f3bbd6"]]},{"id":"1c61fa22.f3bbd6","type":"delay","z":"751e1e72.95dc1","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":377,"y":221.23336791992188,"wires":[["e86b57de.917d48"]]},{"id":"59d1e6bd.a0666","type":"function","z":"ef218db9.bc2e9","name":"input_format","func":"var task=\"ecg_processing\";\nvar node=\"pc1\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":774.9333343505859,"y":258.3333435058594,"wires":[["d5df1037.347fd8"]]},{"id":"c5f6659f.dec1a8","type":"inject","z":"ef218db9.bc2e9","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":394,"y":222.63333129882812,"wires":[["8c0734d0.31d8c"]]},{"id":"8c0734d0.31d8c","type":"delay","z":"ef218db9.bc2e9","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":568.9999847412109,"y":145.53335571289062,"wires":[["59d1e6bd.a0666"]]},{"id":"d5df1037.347fd8","type":"subflow:3b87031f.7136b4","z":"ef218db9.bc2e9","x":1004.5,"y":174.20004272460938,"wires":[]},{"id":"5dbb253a.aff18c","type":"function","z":"30a31ce6.80785c","name":"input_format","func":"var task=\"\";\nvar node=\"\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":561.3333129882812,"y":241.33334350585938,"wires":[["60359f63.36716"]]},{"id":"7a962f3a.96d11","type":"inject","z":"30a31ce6.80785c","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":180.3999786376953,"y":205.63333129882812,"wires":[["7c0231e4.5d37a"]]},{"id":"7c0231e4.5d37a","type":"delay","z":"30a31ce6.80785c","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":355.39996337890625,"y":128.53335571289062,"wires":[["5dbb253a.aff18c"]]},{"id":"60359f63.36716","type":"subflow:3b87031f.7136b4","z":"30a31ce6.80785c","x":815.8999633789062,"y":161.20004272460938,"wires":[]},{"id":"e86b57de.917d48","type":"function","z":"751e1e72.95dc1","name":"input_format","func":"var tsk=\"\";\nvar alg=\"\";\n\nflow.set('tsk',tsk);\nflow.set('alg',alg);\nmsg.alg=alg;\n\n\nmsg.payload=\"\";\n\n\nreturn msg;","outputs":1,"noerr":0,"x":468.33331298828125,"y":335.3333435058594,"wires":[["119a0ea7.a79031"]]},{"id":"f930829a.452dd","type":"mongodb in","z":"43424bb0.09203c","mongodb":"a38c993e.77baa","name":"tasks","collection":"tasks","operation":"find","x":278.75,"y":186.75,"wires":[["9efac6f9.ed27b"]]},{"id":"b4a4ccb.d3641b","type":"function","z":"43424bb0.09203c","name":"query task","func":"msg.limit = 5;\nflow.set('taskname',msg.taskname);\nflow.set('nodename',msg.nodename);\nmsg.skip = 0;\nvar task=flow.get('taskname'); \nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0,\"id\":1,\"url\":1, \"parameters\":1, \"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_external\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":175.916259765625,"y":322.4169921875,"wires":[["f930829a.452dd"]]},{"id":"9efac6f9.ed27b","type":"function","z":"43424bb0.09203c","name":"task_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('taskinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":419.916259765625,"y":293.75,"wires":[["f0ae3755.fd91f8"]]},{"id":"f0ae3755.fd91f8","type":"function","z":"43424bb0.09203c","name":"query node","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nmsg.payload={ id: node};\nmsg.projection = {\"_id\":0, \"id\":1, \"arch\":1,\"location\":1,\"ip\":1};\nreturn msg;\n","outputs":1,"noerr":0,"x":568.7496337890625,"y":232.083251953125,"wires":[["d76b70ba.017dd8"]]},{"id":"d76b70ba.017dd8","type":"mongodb in","z":"43424bb0.09203c","mongodb":"a38c993e.77baa","name":"nodes","collection":"nodes","operation":"find","x":704.7496337890625,"y":371.083251953125,"wires":[["9237b9e3.3f82d8"]]},{"id":"9237b9e3.3f82d8","type":"function","z":"43424bb0.09203c","name":"node_info","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\nflow.set('nodeinfo',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":831.7496337890625,"y":246.083251953125,"wires":[["9d98c0d1.66fdb"]]},{"id":"9d98c0d1.66fdb","type":"function","z":"43424bb0.09203c","name":"creator","func":"var nodei=flow.get('nodeinfo');\nvar taski=flow.get('taskinfo');\n\nif(nodei.location==\"external\")\n{\n    \n    msg.url=nodei.ip+\":\"+taski.port_external+   \"/\"+taski.url;\n    msg.payload=\"echo '\"+ msg.url+\"'\";\n\n}\nelse\n    {\n    \n        \n        if (nodei.arch==\"x86\")\n        {\n            msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_x86;\n        }\n        else    \n        {\n        \n        msg.payload=\"sudo docker service create -p \"+taski.port_external+\":\"+taski.port_internal+\" --replicas 1 --network my-net --name \"+ taski.id+ \" --constraint 'node.labels.alias==\"+ nodei.id+ \"' \"+taski.image_arm;\n        }\n    \n            msg.url=\"127.0.0.1\"+\":\"+taski.port_external+   \"/\"+taski.url;\n\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":1022.916259765625,"y":231.75001525878906,"wires":[["602b0a3e.8a9a6c"]]},{"id":"602b0a3e.8a9a6c","type":"exec","z":"43424bb0.09203c","command":" ","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":1143.816650390625,"y":312.6500244140625,"wires":[["da9bb6ba.7f6b1"],[],[]]},{"id":"1c401cfb.832f7b","type":"mongodb out","z":"43424bb0.09203c","mongodb":"6daf288f.08ccf8","name":"insert_allocation","collection":"allocations","payonly":true,"upsert":false,"multi":false,"operation":"insert","x":1434.75,"y":284.29998779296875,"wires":[]},{"id":"da9bb6ba.7f6b1","type":"function","z":"43424bb0.09203c","name":"insert_set","func":"msg.limit = 5;\n\nvar node=flow.get('nodename'); \nvar task=flow.get('taskname');\nvar tinfo=flow.get('taskinfo');\nmsg.payload={ node: node, task:task, port_external:tinfo.port_external,port_internal:tinfo.port_internal,parameters:tinfo.parameters,url:msg.url, image_arm:tinfo.image_arm};\n\n\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1213,"y":207.75,"wires":[["1c401cfb.832f7b"]]},{"id":"425a507e.859b9","type":"function","z":"902690ba.66ce9","name":"input_format","func":"var task=\"troponin_processing\";\nvar node=\"rpi1\";\nmsg.payload=\"\";\nmsg.nodename=node;\nmsg.taskname=task;\n\nreturn msg;","outputs":1,"noerr":0,"x":641.3333129882812,"y":276.3333435058594,"wires":[["cd2ca15e.a6c49"]]},{"id":"ce0b365.5a2a0c8","type":"inject","z":"902690ba.66ce9","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":190.3999786376953,"y":203.63333129882812,"wires":[["8729a323.6c8aa8"]]},{"id":"8729a323.6c8aa8","type":"delay","z":"902690ba.66ce9","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":380.39996337890625,"y":206.53335571289062,"wires":[["425a507e.859b9"]]},{"id":"cd2ca15e.a6c49","type":"subflow:43424bb0.09203c","z":"902690ba.66ce9","name":"","x":868.8999633789062,"y":273.2000427246094,"wires":[]},{"id":"e743f440.a671f","type":"http request","z":"19ee3191.099ef6","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1005.566650390625,"y":281.566650390625,"wires":[[]]},{"id":"2fd3c1d2.de43fe","type":"function","z":"19ee3191.099ef6","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload.url;\nvar url_base=result;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\nvar troponin=msg.troponin;\n\n\nfinal_url=final_url+\"ecg=\"+ecg;\n\nfinal_url=final_url+\"&\";\n\nfinal_url=final_url+\"troponin=\"+troponin;\n\nmsg.payload=final_url;\n\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[["e743f440.a671f"]]},{"id":"6810531a.b8abac","type":"mongodb in","z":"19ee3191.099ef6","mongodb":"a6de67d4.7656","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["cc082dff.3a1a7"]]},{"id":"42421c2a.71cd9c","type":"function","z":"19ee3191.099ef6","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"test_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["6810531a.b8abac"]]},{"id":"cc082dff.3a1a7","type":"function","z":"19ee3191.099ef6","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["2fd3c1d2.de43fe"]]},{"id":"bedec47f.b8ccb","type":"http request","z":"a5f2e70.3b98f18","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1005.566650390625,"y":281.566650390625,"wires":[[]]},{"id":"3d30fc97.ea438c","type":"function","z":"a5f2e70.3b98f18","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload.url;\nvar url_base=result;\nvar final_url=url_base+\"?\";\n\nvar ecg=msg.ecg;\n\nvar troponin=msg.troponin;\n\n\nfinal_url=final_url+\"ecg=\"+ecg;\n\nfinal_url=final_url+\"&\";\n\nfinal_url=final_url+\"troponin=\"+troponin;\n\nmsg.payload=final_url;\n\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[["bedec47f.b8ccb"]]},{"id":"bf5342ef.b993f","type":"mongodb in","z":"a5f2e70.3b98f18","mongodb":"a6de67d4.7656","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["fce775fd.6f271"]]},{"id":"34279326.a3e9a4","type":"function","z":"a5f2e70.3b98f18","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"test_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["bf5342ef.b993f"]]},{"id":"fce775fd.6f271","type":"function","z":"a5f2e70.3b98f18","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["3d30fc97.ea438c"]]},{"id":"ad4364e5.871f3","type":"http request","z":"f7d6c10a.a5abe8","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1005.566650390625,"y":281.566650390625,"wires":[[]]},{"id":"85409fbc.7d19a","type":"function","z":"f7d6c10a.a5abe8","name":"url_maker_test","func":"msg.limit = 5;\nmsg.skip = 0;\nvar result=msg.payload.url;\nvar url_base=result;\nvar final_url=url_base+\"?\";\n\nvar troponin=msg.troponin;\n\n\nfinal_url=final_url+\"troponin=\"+troponin;\n\nmsg.payload=final_url;\n\nmsg.url=final_url;\nreturn msg;\n","outputs":1,"noerr":0,"x":773.066650390625,"y":391.566650390625,"wires":[["ad4364e5.871f3"]]},{"id":"8d00f9fe.58fba8","type":"mongodb in","z":"f7d6c10a.a5abe8","mongodb":"a6de67d4.7656","name":"allocations","collection":"allocations","operation":"find","x":445.566650390625,"y":396.566650390625,"wires":[["9cebf1b3.2dc78"]]},{"id":"29a6bf10.21844","type":"function","z":"f7d6c10a.a5abe8","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=\"troponin_processing\"; \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"url\":1,\"parameters\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":254.73297119140625,"y":397.233642578125,"wires":[["8d00f9fe.58fba8"]]},{"id":"9cebf1b3.2dc78","type":"function","z":"f7d6c10a.a5abe8","name":"take_one","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\nmsg.payload=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":597.566650390625,"y":459.566650390625,"wires":[["85409fbc.7d19a"]]},{"id":"58b1fe47.fabf1","type":"subflow:9fbd62ed.065678","z":"43367d2.b055584","name":"","x":1599,"y":580.3333129882812,"wires":[["a90640e.e704bc"]]},{"id":"7ad01efd.a54b4","type":"http in","z":"43367d2.b055584","name":"","url":"/trop_import","method":"get","swaggerDoc":"","x":1265.25,"y":613.2166290283203,"wires":[["6906db9.f4e6b24"]]},{"id":"6906db9.f4e6b24","type":"function","z":"43367d2.b055584","name":"test_input","func":"\nvar troponin=msg.req.query.troponin; \nmsg.troponin=troponin;\n\nreturn msg;","outputs":1,"noerr":0,"x":1412.25,"y":553.4499816894531,"wires":[["58b1fe47.fabf1"]]},{"id":"a90640e.e704bc","type":"http response","z":"43367d2.b055584","name":"","x":1744.25,"y":560.5999755859375,"wires":[]},{"id":"2b84a3f4.c7ce34","type":"subflow:902690ba.66ce9","z":"489a23e7.80926c","name":"","x":289.83331298828125,"y":365.5000305175781,"wires":[]},{"id":"69fe5fe7.381fa","type":"switch","z":"e8e29b8f.f685e","name":"algorithm","property":"alg","propertyType":"msg","rules":[{"t":"eq","v":"first","vt":"str"},{"t":"eq","v":"fastest","vt":"str"},{"t":"eq","v":"arm","vt":"str"},{"t":"eq","v":"x86","vt":"str"},{"t":"eq","v":"ram","vt":"str"}],"checkall":"true","outputs":5,"x":667.3333129882812,"y":342.0501708984375,"wires":[["738506b1.b8e5d8"],["20452b09.d3fc14"],["349dc31.04676bc"],["dfdd0cce.25e528"],["8e993554.a50418"]]},{"id":"c8c5ebeb.22aef8","type":"function","z":"e8e29b8f.f685e","name":"test_proc","func":"var tsk=\"test_processing\"; \nvar alg=\"arm\"; \nflow.set('tsk',tsk);\nflow.set('alg',alg);\nmsg.alg=alg;\n\nreturn msg;","outputs":1,"noerr":0,"x":515.7333374023438,"y":496.8333435058594,"wires":[["69fe5fe7.381fa"]]},{"id":"738506b1.b8e5d8","type":"function","z":"e8e29b8f.f685e","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":915.2666625976562,"y":146.81674194335938,"wires":[["a6ff2036.2f495"]]},{"id":"b213838b.835378","type":"subflow:ae2b9df3.28132","z":"e8e29b8f.f685e","x":1072.2666625976562,"y":277.8167419433594,"wires":[["157aa8e1.19e3ff"]]},{"id":"20452b09.d3fc14","type":"function","z":"e8e29b8f.f685e","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":905.2666625976562,"y":257.5166931152344,"wires":[["b213838b.835378"]]},{"id":"a6ff2036.2f495","type":"subflow:18e20988.4c4aa6","z":"e8e29b8f.f685e","x":1092.2666625976562,"y":146.45004272460938,"wires":[["3b7e8ad6.40d706"]]},{"id":"349dc31.04676bc","type":"function","z":"e8e29b8f.f685e","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":900.3333129882812,"y":353.8833923339844,"wires":[["454f881b.f2f918"]]},{"id":"71e140a6.12c678","type":"subflow:f0da5b33.1135d8","z":"e8e29b8f.f685e","x":1012.3333129882812,"y":498.6830749511719,"wires":[["a5cc3d52.803fc"]]},{"id":"454f881b.f2f918","type":"subflow:15baf860.7fdb18","z":"e8e29b8f.f685e","name":"","x":1070.3333129882812,"y":380.5498962402344,"wires":[["4d909bce.d00ca4"]]},{"id":"dfdd0cce.25e528","type":"function","z":"e8e29b8f.f685e","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":858.3333129882812,"y":461.5498962402344,"wires":[["71e140a6.12c678"]]},{"id":"8e993554.a50418","type":"function","z":"e8e29b8f.f685e","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":839.2666625976562,"y":575.8835144042969,"wires":[["127753d6.8c7a4c"]]},{"id":"127753d6.8c7a4c","type":"subflow:3bf728d9.ffd948","z":"e8e29b8f.f685e","name":"","x":995.1666870117188,"y":655.0000915527344,"wires":[["7e5581f3.ac2fc8"]]},{"id":"3b7e8ad6.40d706","type":"subflow:90fe7935.af7ab","z":"e8e29b8f.f685e","x":1430.8333740234375,"y":140,"wires":[]},{"id":"157aa8e1.19e3ff","type":"subflow:90fe7935.af7ab","z":"e8e29b8f.f685e","x":1444.8333740234375,"y":270.9999694824219,"wires":[]},{"id":"4d909bce.d00ca4","type":"subflow:90fe7935.af7ab","z":"e8e29b8f.f685e","x":1459.8333740234375,"y":395.9999694824219,"wires":[]},{"id":"a5cc3d52.803fc","type":"subflow:90fe7935.af7ab","z":"e8e29b8f.f685e","x":1483.8333740234375,"y":501.0000305175781,"wires":[]},{"id":"7e5581f3.ac2fc8","type":"subflow:90fe7935.af7ab","z":"e8e29b8f.f685e","x":1462.8333740234375,"y":655,"wires":[]},{"id":"2d12b804.8ab818","type":"inject","z":"e8e29b8f.f685e","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":315,"y":678.1666564941406,"wires":[["a819731b.f006a"]]},{"id":"a819731b.f006a","type":"delay","z":"e8e29b8f.f685e","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":361,"y":300.0666809082031,"wires":[["c8c5ebeb.22aef8"]]},{"id":"7893b3b5.e8c2e4","type":"mongodb in","z":"8439eaa8.01c9a","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":467.33331298828125,"y":333.3333435058594,"wires":[["fbaf5057.e2c45"]]},{"id":"909d86bc.0a869","type":"function","z":"8439eaa8.01c9a","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":208.49957656860352,"y":322.00035429000854,"wires":[["7893b3b5.e8c2e4"]]},{"id":"fbaf5057.e2c45","type":"function","z":"8439eaa8.01c9a","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":762.4998626708984,"y":313.9999027252197,"wires":[["648f96d4.9c2d18"]]},{"id":"94a5aa2.d741fd8","type":"mongodb in","z":"8439eaa8.01c9a","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":1669.4765625,"y":318.97682189941406,"wires":[["c230e9e6.0cf06"]]},{"id":"c19a68b1.23c3b8","type":"function","z":"8439eaa8.01c9a","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1502.642692565918,"y":320.6440887451172,"wires":[["94a5aa2.d741fd8"]]},{"id":"648f96d4.9c2d18","type":"function","z":"8439eaa8.01c9a","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par, arch:\"arm\"};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":996.0000457763672,"y":322.00001525878906,"wires":[["dc8e706.c48cb9"]]},{"id":"dc8e706.c48cb9","type":"mongodb in","z":"8439eaa8.01c9a","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1152.9998626708984,"y":322.0000147819519,"wires":[["52b90811.91e678"]]},{"id":"52b90811.91e678","type":"function","z":"8439eaa8.01c9a","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1304.499870300293,"y":322.0001678466797,"wires":[["c19a68b1.23c3b8"]]},{"id":"c230e9e6.0cf06","type":"function","z":"8439eaa8.01c9a","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1837.9762420654297,"y":319.4765033721924,"wires":[["67b780b9.a3b4d"]]},{"id":"67b780b9.a3b4d","type":"function","z":"8439eaa8.01c9a","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=[];\n\nvar keys = Object.keys(mapped);\n\n\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<mapped.length;j++)\n    {\n        if (mapped[j].node==nodes[i])\n        {\n             result.push(mapped[j]);\n        }\n    }\n    \n}\n\nflow.set('filter1',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1963.478271484375,"y":406.4767150878906,"wires":[["82e4c8f4.280c98"]]},{"id":"d79db8ca.14fef8","type":"function","z":"8439eaa8.01c9a","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nmsg.nodename=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2799.5408935546875,"y":372.5234680175781,"wires":[[]]},{"id":"784541e1.f45a58","type":"mongodb in","z":"8439eaa8.01c9a","mongodb":"a6de67d4.7656","name":"allocations","collection":"allocations","operation":"find","x":2316.3336181640625,"y":590.3333129882812,"wires":[["3202dcf7.36c06c"]]},{"id":"82e4c8f4.280c98","type":"function","z":"8439eaa8.01c9a","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload=\"\";\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":2133.4998168945312,"y":556.0003051757812,"wires":[["784541e1.f45a58"]]},{"id":"3202dcf7.36c06c","type":"function","z":"8439eaa8.01c9a","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('allocated',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2458.666748046875,"y":702.3333129882812,"wires":[["bf572b5a.f74ef"]]},{"id":"bf572b5a.f74ef","type":"function","z":"8439eaa8.01c9a","name":"filter ","func":"var mapped=flow.get('filter1');\nvar allocated=flow.get('allocated');\nvar result=[];\n\n\nfor(var i=0; i<mapped.length;i++)\n{  \n    var aux=1;\n    for(var j =0; j<allocated.length;j++)\n    {\n        if (mapped[i].node==allocated[j].node)\n        {\n            aux=2;\n        }\n     \n    }\n    \n       \n        if(aux==1)\n        {\n          result.push(mapped[i]);\n\n        }\n    \n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2668.6668701171875,"y":732.3333129882812,"wires":[["d79db8ca.14fef8"]]},{"id":"7e037f29.3dced","type":"http in","z":"a626622d.9d5f9","name":"","url":"/rtrt","method":"get","swaggerDoc":"","x":504.1666259765625,"y":529.3332824707031,"wires":[["df6468e6.ea2c3"]]},{"id":"df6468e6.ea2c3","type":"function","z":"a626622d.9d5f9","name":"msgtask","func":"msg.payload=msg.req.query.task;\nreturn msg;","outputs":1,"noerr":0,"x":689.1666259765625,"y":417.33331298828125,"wires":[["e57401ce.f10388"]]},{"id":"d75a9b7c.92aac8","type":"http response","z":"a626622d.9d5f9","name":"","x":1068.166748046875,"y":438.1666259765625,"wires":[]},{"id":"bc84a335.e9a178","type":"mongodb in","z":"9fbd61ac.7482f","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":446.833740234375,"y":284.3333435058594,"wires":[["b6d1bfc5.2b5928"]]},{"id":"d0d5d072.bef3e","type":"function","z":"9fbd61ac.7482f","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":332,"y":398.0003662109375,"wires":[["bc84a335.e9a178"]]},{"id":"b6d1bfc5.2b5928","type":"function","z":"9fbd61ac.7482f","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":619.0002861022949,"y":246.99990272521973,"wires":[["341740f7.316398"]]},{"id":"195ea60c.0b430a","type":"mongodb in","z":"9fbd61ac.7482f","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":1525.9769859313965,"y":251.97682189941406,"wires":[["3e0d3943.43b6d6"]]},{"id":"48795436.957f74","type":"function","z":"9fbd61ac.7482f","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1359.1431159973145,"y":253.6440887451172,"wires":[["195ea60c.0b430a"]]},{"id":"341740f7.316398","type":"function","z":"9fbd61ac.7482f","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par, arch:\"arm\"};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":852.5004692077637,"y":255.00001525878906,"wires":[["858c26c3.e63ed8"]]},{"id":"858c26c3.e63ed8","type":"mongodb in","z":"9fbd61ac.7482f","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1009.5002861022949,"y":255.0000147819519,"wires":[["d7b8e165.3eb498"]]},{"id":"d7b8e165.3eb498","type":"function","z":"9fbd61ac.7482f","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1161.0002937316895,"y":255.0001678466797,"wires":[["48795436.957f74"]]},{"id":"3e0d3943.43b6d6","type":"function","z":"9fbd61ac.7482f","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1694.4766654968262,"y":252.47650337219238,"wires":[["17cd531c.23ad0d"]]},{"id":"17cd531c.23ad0d","type":"function","z":"9fbd61ac.7482f","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=[];\n\nvar keys = Object.keys(mapped);\n\n\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<mapped.length;j++)\n    {\n        if (mapped[j].node==nodes[i])\n        {\n             result.push(mapped[j]);\n        }\n    }\n    \n}\n\nflow.set('filter1',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1819.9786949157715,"y":339.4767150878906,"wires":[["8aac2dc4.fdd4d"]]},{"id":"5c94f96.c936c88","type":"function","z":"9fbd61ac.7482f","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nmsg.nodename=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2656.041316986084,"y":305.5234680175781,"wires":[[]]},{"id":"5f5bef89.764f9","type":"mongodb in","z":"9fbd61ac.7482f","mongodb":"a6de67d4.7656","name":"allocations","collection":"allocations","operation":"find","x":2172.834041595459,"y":523.3333129882812,"wires":[["edb2e50b.dfd92"]]},{"id":"8aac2dc4.fdd4d","type":"function","z":"9fbd61ac.7482f","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload=\"\";\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1990.0002403259277,"y":489.00030517578125,"wires":[["5f5bef89.764f9"]]},{"id":"edb2e50b.dfd92","type":"function","z":"9fbd61ac.7482f","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('allocated',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2315.1671714782715,"y":635.3333129882812,"wires":[["836f5a33.eb7a78"]]},{"id":"836f5a33.eb7a78","type":"function","z":"9fbd61ac.7482f","name":"filter ","func":"var mapped=flow.get('filter1');\nvar allocated=flow.get('allocated');\nvar result=[];\n\n\nfor(var i=0; i<mapped.length;i++)\n{  \n    var aux=1;\n    for(var j =0; j<allocated.length;j++)\n    {\n        if (mapped[i].node==allocated[j].node)\n        {\n            aux=2;\n        }\n     \n    }\n    \n       \n        if(aux==1)\n        {\n          result.push(mapped[i]);\n\n        }\n    \n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2525.167293548584,"y":665.3333129882812,"wires":[["5c94f96.c936c88"]]},{"id":"cc166685.f24528","type":"mongodb in","z":"bd538ff1.ae6a08","mongodb":"f03ed1a4.b25e5","name":"tasks","collection":"tasks","operation":"find","x":363.83373641967773,"y":283.3333435058594,"wires":[["88230c95.4ffa8"]]},{"id":"1b623a45.18abb6","type":"function","z":"bd538ff1.ae6a08","name":"query task","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nflow.set(\"taskid\",task);\nmsg.payload={ id: task};\nmsg.projection = {\"_id\":0, \"id\":1,\"image_arm\":1,\"image_x86\":1,\"execution\":1,\"port_internal\":1,\"port_exeternal\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":105,"y":272.00035429000854,"wires":[["cc166685.f24528"]]},{"id":"88230c95.4ffa8","type":"function","z":"bd538ff1.ae6a08","name":"location_policy","func":"var result = {};\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result=msg.payload[keys[i]];\n}\n\n\nflow.set('location',result.execution);\n\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":659.0002861022949,"y":263.9999027252197,"wires":[["dca82ac8.74708"]]},{"id":"4dd7776b.721eb8","type":"mongodb in","z":"bd538ff1.ae6a08","mongodb":"f03ed1a4.b25e5","name":"mappings","collection":"mappings","operation":"find","x":1565.9769859313965,"y":268.97682189941406,"wires":[["8f65ef1f.093eb"]]},{"id":"e07175f7.1278d8","type":"function","z":"bd538ff1.ae6a08","name":"query node","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload={ task: task};\nmsg.projection = {\"_id\":0, \"node\":1,\"processing_speed\":1,\"network_delay\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":1399.1431159973145,"y":270.6440887451172,"wires":[["4dd7776b.721eb8"]]},{"id":"dca82ac8.74708","type":"function","z":"bd538ff1.ae6a08","name":"find nodes","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=msg.payload; \nvar location_par=flow.get('location');\nmsg.payload={location:location_par, arch:\"x86\"};\nmsg.projection = {\"_id\":0, \"id\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":892.5004692077637,"y":272.00001525878906,"wires":[["87a639e.fe3c3c8"]]},{"id":"87a639e.fe3c3c8","type":"mongodb in","z":"bd538ff1.ae6a08","mongodb":"f03ed1a4.b25e5","name":"nodes","collection":"nodes","operation":"find","x":1049.500286102295,"y":272.0000147819519,"wires":[["c70574f8.5578e"]]},{"id":"c70574f8.5578e","type":"function","z":"bd538ff1.ae6a08","name":"nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].id);\n}\nflow.set('nodes',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1201.0002937316895,"y":272.0001678466797,"wires":[["e07175f7.1278d8"]]},{"id":"8f65ef1f.093eb","type":"function","z":"bd538ff1.ae6a08","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('mapped',result);\nmsg.payload=flow.get('mapped');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1734.4766654968262,"y":269.4765033721924,"wires":[["4be720a1.1fd67"]]},{"id":"4be720a1.1fd67","type":"function","z":"bd538ff1.ae6a08","name":"filter ","func":"var nodes=flow.get('nodes');\nvar mapped=flow.get('mapped');\nvar result=[];\n\nvar keys = Object.keys(mapped);\n\n\n\nfor(var i=0; i<nodes.length;i++)\n{  \n    for(var j =0; j<mapped.length;j++)\n    {\n        if (mapped[j].node==nodes[i])\n        {\n             result.push(mapped[j]);\n        }\n    }\n    \n}\n\nflow.set('filter1',result);\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1859.9786949157715,"y":356.4767150878906,"wires":[["a2f283d5.f3bc7"]]},{"id":"258bd6fc.d34d9a","type":"function","z":"bd538ff1.ae6a08","name":"first_policy","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]].node);\n}\nmsg.payload=result[0];\nmsg.nodename=result[0];\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2696.041316986084,"y":322.5234680175781,"wires":[[]]},{"id":"496b7caa.321e94","type":"mongodb in","z":"bd538ff1.ae6a08","mongodb":"a6de67d4.7656","name":"allocations","collection":"allocations","operation":"find","x":2212.834041595459,"y":540.3333129882812,"wires":[["2b15f81e.645c9"]]},{"id":"a2f283d5.f3bc7","type":"function","z":"bd538ff1.ae6a08","name":"query_allocation","func":"msg.limit = 5;\nmsg.skip = 0;\nvar task=flow.get('taskid'); \nmsg.payload=\"\";\nmsg.projection = {\"_id\":0, \"node\":1}; \nreturn msg;\n","outputs":1,"noerr":0,"x":2030.0002403259277,"y":506.00030517578125,"wires":[["496b7caa.321e94"]]},{"id":"2b15f81e.645c9","type":"function","z":"bd538ff1.ae6a08","name":"mapped nodes","func":"var result = [];\nvar keys = Object.keys(msg.payload);\nfor(var i =0; i<keys.length;i++)\n{  \n  result.push(msg.payload[keys[i]]);\n}\n\nflow.set('allocated',result);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2355.1671714782715,"y":652.3333129882812,"wires":[["dd60b9d0.d37c68"]]},{"id":"dd60b9d0.d37c68","type":"function","z":"bd538ff1.ae6a08","name":"filter ","func":"var mapped=flow.get('filter1');\nvar allocated=flow.get('allocated');\nvar result=[];\n\n\nfor(var i=0; i<mapped.length;i++)\n{  \n    var aux=1;\n    for(var j =0; j<allocated.length;j++)\n    {\n        if (mapped[i].node==allocated[j].node)\n        {\n            aux=2;\n        }\n     \n    }\n    \n       \n        if(aux==1)\n        {\n          result.push(mapped[i]);\n\n        }\n    \n    \n}\n\nmsg.payload=result;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2565.167293548584,"y":682.3333129882812,"wires":[["258bd6fc.d34d9a"]]},{"id":"e57401ce.f10388","type":"subflow:bd538ff1.ae6a08","z":"a626622d.9d5f9","x":900.1667022705078,"y":516.1666412353516,"wires":[["d75a9b7c.92aac8"]]},{"id":"cd249955.d675d","type":"switch","z":"3f28fc4e.fee994","name":"algorithm","property":"alg","propertyType":"msg","rules":[{"t":"eq","v":"first","vt":"str"},{"t":"eq","v":"fastest","vt":"str"},{"t":"eq","v":"arm","vt":"str"},{"t":"eq","v":"x86","vt":"str"},{"t":"eq","v":"ram","vt":"str"}],"checkall":"true","outputs":5,"x":701.3333129882812,"y":345.3333435058594,"wires":[["bbbd7566.8162a8"],["928380b6.802a58"],["ebc34f42.29078"],["21e613e4.c6bf0c"],["31f8abad.744434"]]},{"id":"e76691ca.ccb928","type":"function","z":"3f28fc4e.fee994","name":"set_parameters","func":"var tsk=\"test_processing\"; \nvar alg=\"arm\"; \nflow.set('tsk',tsk);\nflow.set('alg',alg);\nmsg.alg=alg;\n\nreturn msg;","outputs":1,"noerr":0,"x":569.7333374023438,"y":500.11651611328125,"wires":[["cd249955.d675d"]]},{"id":"bbbd7566.8162a8","type":"function","z":"3f28fc4e.fee994","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":949.2666625976562,"y":150.09991455078125,"wires":[["a41398ce.1a217"]]},{"id":"ea928ff7.fcc578","type":"subflow:ae2b9df3.28132","z":"3f28fc4e.fee994","x":1106.2666625976562,"y":281.09991455078125,"wires":[["59f4060c.b7991"]]},{"id":"928380b6.802a58","type":"function","z":"3f28fc4e.fee994","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":939.2666625976562,"y":260.79986572265625,"wires":[["ea928ff7.fcc578"]]},{"id":"a41398ce.1a217","type":"subflow:18e20988.4c4aa6","z":"3f28fc4e.fee994","x":1126.2666625976562,"y":149.73321533203125,"wires":[["f7e75fca.80fc68"]]},{"id":"ebc34f42.29078","type":"function","z":"3f28fc4e.fee994","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":934.3333129882812,"y":357.16656494140625,"wires":[["b1bf8daa.d902f"]]},{"id":"21e613e4.c6bf0c","type":"function","z":"3f28fc4e.fee994","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":892.3333129882812,"y":464.83306884765625,"wires":[["2e60cbb4.dc7494"]]},{"id":"31f8abad.744434","type":"function","z":"3f28fc4e.fee994","name":"test_proc","func":"var tsk1=flow.get('tsk'); \nmsg.taskname=tsk1;\nmsg.payload=tsk1;\nreturn msg;","outputs":1,"noerr":0,"x":873.2666625976562,"y":579.1666870117188,"wires":[["284574e.22ba38c"]]},{"id":"284574e.22ba38c","type":"subflow:3bf728d9.ffd948","z":"3f28fc4e.fee994","name":"","x":1029.1666870117188,"y":658.2832641601562,"wires":[["d2b970ac.36ae1"]]},{"id":"f7e75fca.80fc68","type":"subflow:90fe7935.af7ab","z":"3f28fc4e.fee994","x":1464.8333740234375,"y":143.28317260742188,"wires":[]},{"id":"59f4060c.b7991","type":"subflow:90fe7935.af7ab","z":"3f28fc4e.fee994","x":1478.8333740234375,"y":274.28314208984375,"wires":[]},{"id":"47dc55b7.fa9f14","type":"subflow:90fe7935.af7ab","z":"3f28fc4e.fee994","x":1493.8333740234375,"y":399.28314208984375,"wires":[]},{"id":"e9eb1baa.dd5688","type":"subflow:90fe7935.af7ab","z":"3f28fc4e.fee994","x":1517.8333740234375,"y":504.283203125,"wires":[]},{"id":"d2b970ac.36ae1","type":"subflow:90fe7935.af7ab","z":"3f28fc4e.fee994","x":1496.8333740234375,"y":658.2831726074219,"wires":[]},{"id":"3cb99ec7.133a4a","type":"inject","z":"3f28fc4e.fee994","name":"bind test","topic":" ","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":349,"y":681.4498291015625,"wires":[["959167e2.bfe62"]]},{"id":"959167e2.bfe62","type":"delay","z":"3f28fc4e.fee994","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":392,"y":330.349853515625,"wires":[["e76691ca.ccb928"]]},{"id":"b1bf8daa.d902f","type":"subflow:9fbd61ac.7482f","z":"3f28fc4e.fee994","x":1139.1667022705078,"y":366.8333282470703,"wires":[["47dc55b7.fa9f14"]]},{"id":"2e60cbb4.dc7494","type":"subflow:bd538ff1.ae6a08","z":"3f28fc4e.fee994","x":1182.166748046875,"y":492.1666564941406,"wires":[["e9eb1baa.dd5688"]]}]
